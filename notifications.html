<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Alerts – Vynix</title>

  <!-- Google Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg:#ffffff;--card:#ffffff;--text:#0f1419;--text2:#536471;--border:#cfd9de;
      --accent:#ff2a6d;--hover-accent:rgba(255,42,109,.08);--radius:16px;--trans:.18s cubic-bezier(.4,0,.2,1);
    }
    [data-theme="dark"]{
      --bg:#000000;--card:#000000;--text:#e7e9ea;--text2:#71767b;--border:#2f3336;
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);color:var(--text);margin:0;padding-bottom:80px;
    }
    *{box-sizing:border-box}
    .notification-item{
      display:flex;gap:16px;padding:14px 16px;align-items:flex-start;
      border-bottom:1px solid var(--border);cursor:pointer;transition:background var(--trans);
    }
    .notification-item:hover{background:var(--hover-accent)}
    .notification-item.unread{background:rgba(255,42,109,.06);font-weight:600}
    .notif-avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;flex-shrink:0}
    .notif-icon{
      width:40px;height:40px;border-radius:50%;background:var(--accent);color:#fff;
      display:grid;place-items:center;font-size:22px;flex-shrink:0;
    }
    .notif-body{flex:1;min-width:0}
    .notif-title{font-weight:700;font-size:15px;line-height:1.3}
    .notif-message{color:var(--text2);font-size:14px;margin-top:3px;white-space:pre-wrap;
                   overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
    .notif-time{color:var(--text2);font-size:12px;margin-top:6px}
    .skeleton{height:72px;background:linear-gradient(90deg,var(--border)25%,rgba(255,255,255,.3)50%,var(--border)75%);
              background-size:200% 100%;animation:shimmer 1.8s infinite}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .empty-state{text-align:center;padding:60px 20px;color:var(--text2)}
    .empty-state .material-icons{font-size:72px;margin-bottom:16px;opacity:.3}
  </style>
</head>
<body class="min-h-screen">

  <div id="notifications-list" class="max-w-600 mx-auto"></div>

  <div id="empty-state" class="empty-state hidden">
    <span class="material-icons">notifications_off</span>
    <h2 class="text-xl font-bold">All caught up!</h2>
    <p class="mt-2">You'll see likes, comments, and reposts here.</p>
  </div>

  <!-- Bottom Navigation -->
  <nav id="navbar" class="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800 z-40">
    <div class="h-full flex items-center justify-around text-gray-500">
      <a href="index.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">home</span>
        <span class="text-xs mt-0.5">Home</span>
      </a>
      <a href="chat.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">chat_bubble_outline</span>
        <span class="text-xs mt-0.5">Chat</span>
      </a>
      <a href="search.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">search</span>
        <span class="text-xs mt-0.5">Search</span>
      </a>
      <a href="ai.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">auto_awesome</span>
        <span class="text-xs mt-0.5">AI</span>
      </a>
      <a href="notifications.html" class="flex flex-col items-center justify-center h-full w-full text-[#ff2a6d]">
        <span class="material-icons text-24">notifications</span>
        <span class="text-xs mt-0.5">Alerts</span>
      </a>
      <a href="profile.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">person</span>
        <span class="text-xs mt-0.5">Profile</span>
      </a>
    </div>
  </nav>

<!-- Firebase -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
import { getAuth, onAuthStateChanged, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
import { getDatabase, ref, onValue, get, serverTimestamp, set } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
  authDomain: "fire-b-a8878.firebaseapp.com",
  databaseURL: "https://fire-b-a8878.firebaseio.com",
  projectId: "fire-b-a8878",
  storageBucket: "fire-b-a8878.firebasestorage.app",
  messagingSenderId: "658673187627",
  appId: "1:658673187627:web:6e4c29af661785f0afa36e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getDatabase(app);

let uid = null;
const $   = s => document.querySelector(s);
const list = $('#notifications-list');
const empty = $('#empty-state');

if (window.matchMedia?.('(prefers-color-scheme: dark)')?.matches)
  document.body.setAttribute('data-theme', 'dark');

onAuthStateChanged(auth, user => {
  if (!user) signInAnonymously(auth);
  else { uid = user.uid; loadNotifications(); }
});

function showSkeleton() {
  list.innerHTML = Array(10).fill().map(() => `<div class="skeleton"></div>`).join('');
}

async function loadNotifications() {
  showSkeleton();
  const notifRef = ref(db, `notifications/${uid}`);
  onValue(notifRef, async snap => {
    const data = snap.val();
    if (!data || !Object.keys(data).length) {
      list.innerHTML = ''; empty.classList.remove('hidden'); return;
    }
    empty.classList.add('hidden');
    const notifications = Object.entries(data)
      .map(([k,v]) => ({id:k,...v}))
      .sort((a,b) => (b.timestamp||0) - (a.timestamp||0));

    list.innerHTML = '';
    for (const n of notifications) {
      const actor = await getUserMeta(n.from);
      list.appendChild(createNotificationElement(n, actor));
    }
    // mark read
    notifications.forEach(n => { if (!n.read) set(ref(db,`notifications/${uid}/${n.id}/read`),true); });
  });
}

async function getUserMeta(uid) {
  if (!uid) return { name:'Someone', avatar:'https://ui-avatars.com/api/?background=ff2a6d&color=fff&name=?' };
  const snap = await get(ref(db, `users/${uid}/profile`));
  const p = snap.val() || {};
  return {
    name: p.displayName || 'User',
    avatar: p.avatar || `https://ui-avatars.com/api/?background=ff2a6d&color=fff&name=${encodeURIComponent(p.displayName||'User')}`
  };
}

function createNotificationElement(n, actor) {
  const div = document.createElement('div');
  div.className = `notification-item ${n.read ? '' : 'unread'}`;

  let icon = 'notifications', title = 'New activity';
  switch (n.type) {
    case 'like':    icon = 'favorite';      title = `${actor.name} liked your post`; break;
    case 'comment': icon = 'chat_bubble';   title = `${actor.name} commented on your post`; break;
    case 'repost':  icon = 'repeat';        title = `${actor.name} reposted your post`; break;
  }
  const preview = n.text
    ? `"${n.text.substring(0,80)}${n.text.length>80?'…':''}"`
    : n.commentText
    ? `"${n.commentText.substring(0,80)}${n.commentText.length>80?'…':''}"`
    : '';

  div.innerHTML = `
    <div class="notif-icon"><span class="material-icons">${icon}</span></div>
    <img src="${actor.avatar}" class="notif-avatar" loading="lazy" alt="">
    <div class="notif-body">
      <div class="notif-title">${title}</div>
      ${preview ? `<div class="notif-message">${preview}</div>`:''}
      <div class="notif-time">${timeAgo(n.timestamp)}</div>
    </div>`;

  div.onclick = () => { if (n.postId) location.href = `index.html#post-${n.postId}`; };
  return div;
}

function timeAgo(ts) {
  if (!ts) return 'just now';
  const s = Math.floor((Date.now() - ts) / 1000);
  if (s < 60) return `${s}s`;
  if (s < 3600) return `${Math.floor(s/60)}m`;
  if (s < 86400) return `${Math.floor(s/3600)}h`;
  return `${Math.floor(s/86400)}d`;
}
</script>
</body>
</html>
