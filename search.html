<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <meta name="theme-color" content="#ff2a6d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Search â€¢ Vynix</title>

  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVnluaXgiLCJzaG9ydF9uYW1lIjoiVnluaXgiLCJkZXNjcmlwdGlvbiI6IkNvbm5lY3Qgd2l0aCBmcmllbmRzIC0gZmFzdCwgYmVhdXRpZnVsLCBwcml2YXRlIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZjJhNmQiLCJ0aGVtZV9jb2xvciI6IiNmZjJhNmQiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0LXByaW1hcnkiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9pLnBvc3RpbWcuY2MvSzhZV0tHMHovR2VtaW5pLUdlbmVyYXRlZC1JbWFnZS1qNHpuMGpqNHpuMGpqNHpuLTEtcmVtb3ZlYmctcHJldmlldy5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9LHsic3JjIjoiaHR0cHM6Ly9pLnBvc3RpbWcuY2MvSzhZV0tHMHovR2VtaW5pLUdlbmVyYXRlZC1JbWFnZS1qNHpuMGpqNHpuMGpqNHpuLTEtcmVtb3ZlYmctcHJldmlldy5wbmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
  <link rel="apple-touch-icon" href="https://i.postimg.cc/K8YWKG0z/Gemini-Generated-Image-j4zn0jj4zn0jj4zn-1-removebg-preview.png">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --accent: #ff2a6d; --bg: #ffffff; --text: #0f1419; --text2: #536471; --border: #eff3f4; }
    [data-theme="dark"] { --bg: #000000; --text: #e7e9ea; --text2: #71767b; --border: #2f3336; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding-bottom: 80px; }
    .search-bar { position: sticky; top: 0; background: var(--bg); padding: 12px 16px; border-bottom: 1px solid var(--border); z-index: 10; }
    .search-input { width: 100%; padding: 12px 44px; background: rgba(128,128,128,0.1); border: none; border-radius: 999px; font-size: 17px; outline: none; }
    .results { padding: 8px; }
    .user-result, .post-result { display: flex; gap: 12px; padding: 12px; border-radius: 12px; transition: background 0.2s; }
    .user-result:hover, .post-result:hover { background: rgba(255,42,109,0.08); }
    .avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
    .username { font-weight: 700; }
    .handle { color: var(--text2); font-size: 14px; }
    .post-text { font-size: 15px; line-height: 1.4; margin-top: 4px; }
    .hashtag { color: var(--accent); font-weight: 600; }
    .empty { text-align: center; padding: 60px 20px; color: var(--text2); font-size: 16px; }
    .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--accent); border-radius: 50%; width: 32px; height: 32px; animation: spin 1s linear infinite; margin: 40px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- Search Bar -->
  <div class="search-bar">
    <div class="relative">
      <span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">search</span>
      <input type="text" id="searchInput" class="search-input" placeholder="Search users, posts, #hashtags..." autocomplete="off">
      <span id="clearBtn" class="material-icons absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer hidden">close</span>
    </div>
  </div>

  <!-- Results -->
  <div id="results" class="results">
    <div class="empty">Start typing to search Vynix</div>
  </div>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800 z-40">
    <div class="h-full flex items-center justify-around text-gray-500">
      <a href="feed.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">home</span>
        <span class="text-xs mt-0.5">Home</span>
      </a>
      <a href="chat.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">chat_bubble_outline</span>
        <span class="text-xs mt-0.5">Chat</span>
      </a>
      <a href="search.html" class="flex flex-col items-center justify-center h-full w-full text-[#ff2a6d]">
        <span class="material-icons text-24">search</span>
        <span class="text-xs mt-0.5 font-bold">Search</span>
      </a>
      <a href="ai.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">auto_awesome</span>
        <span class="text-xs mt-0.5">AI</span>
      </a>
      <a href="profile.html" class="flex flex-col items-center justify-center h-full w-full">
        <span class="material-icons-outlined text-24">person</span>
        <span class="text-xs mt-0.5">Profile</span>
      </a>
    </div>
  </nav>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.14/firebase-auth.js';
import { getDatabase, ref, get, query, orderByChild, startAt, endAt, limitToFirst } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

const app = initializeApp({
  apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
  authDomain: "fire-b-a8878.firebaseapp.com",
  databaseURL: "https://fire-b-a8878.firebaseio.com",
  projectId: "fire-b-a8878",
  storageBucket: "fire-b-a8878.firebasestorage.app",
  messagingSenderId: "658673187627",
  appId: "1:658673187627:web:6e4c29af661785f0afa36e"
});
const db = getDatabase(app);
let currentUser = null;

onAuthStateChanged(getAuth(), user => currentUser = user);

const input = document.getElementById('searchInput');
const results = document.getElementById('results');
const clearBtn = document.getElementById('clearBtn');

let debounceTimer;
input.addEventListener('input', () => {
  clearTimeout(debounceTimer);
  const q = input.value.trim();
  clearBtn.classList.toggle('hidden', !q);

  if (!q) {
    results.innerHTML = '<div class="empty">Start typing to search Vynix</div>';
    return;
  }

  debounceTimer = setTimeout(() => search(q), 300);
});

clearBtn.onclick = () => {
  input.value = ''; input.focus();
  clearBtn.classList.add('hidden');
  results.innerHTML = '<div class="empty">Start typing to search Vynix</div>';
};

async function search(query) {
  results.innerHTML = '<div class="loader"></div>';

  const lower = query.toLowerCase();
  const isHashtag = lower.startsWith('#');
  const cleanQuery = isHashtag ? lower.slice(1) : lower;

  try {
    // Search Users
    const usersSnap = await get(ref(db, 'users'));
    const userMatches = [];
    users.forEach(u => {
      const data = u.val();
      const name = (data.displayName || '').toLowerCase();
      const handle = (data.handle || '').toLowerCase();
      if (name.includes(cleanQuery) || handle.includes(cleanQuery)) {
        userMatches.push({ type: 'user', key: u.key, ...data });
      }
    });

    // Search Posts (text + hashtags)
    const postsSnap = await get(ref(db, 'posts'));
    const postMatches = [];
    postsSnap.forEach(p => {
      const data = p.val();
      const text = (data.text || '').toLowerCase();
      if (text.includes(lower) || text.includes(cleanQuery)) {
        postMatches.push({ type: 'post', key: p.key, ...data });
      }
    });

    // Combine & sort by relevance
    const all = [...userMatches, ...postMatches].slice(0, 20);

    if (all.length === 0) {
      results.innerHTML = `<div class="empty">No results found for "${query}"</div>`;
      return;
    }

    results.innerHTML = all.map(item => {
      if (item.type === 'user') {
        return `
          <a href="profile.html?uid=${item.key}" class="user-result block">
            <img src="${item.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(item.displayName || 'User') + '&background=ff2a6d&color=fff'}" class="avatar">
            <div>
              <div class="username">${escapeHtml(item.displayName || 'User')}</div>
              <div class="handle">@${item.handle || item.key.slice(0,8)}</div>
            </div>
          </a>`;
      } else {
        return `
          <a href="feed.html#post-${item.key}" class="post-result block">
            <img src="${item.authorAvatar || 'https://ui-avatars.com/api/?background=ff2a6d&color=fff'}" class="avatar">
            <div class="flex-1">
              <div class="username">${escapeHtml(item.authorName)}</div>
              <div class="post-text">${highlight(escapeHtml(item.text || ''), query)}</div>
            </div>
          </a>`;
      }
    }).join('');

  } catch (e) {
    results.innerHTML = '<div class="empty">Search error. Try again.</div>';
  }
}

function highlight(text, query) {
  if (!query) return text;
  const regex = new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]^{}]/g, '\\$&')})`, 'gi');
  return text.replace(regex, '<span class="hashtag">$1</span>');
}

function escapeHtml(text) {
  return text.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

// Auto-focus on load
input.focus();
</script>

</body>
</html>
