<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vynix Community</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">

    <style>
        :root {
            --accent-purple: #d946ef;
            --logo-gradient: linear-gradient(135deg, #000, var(--accent-purple));
            --text-dim: #71717a;
            --border-color: #f4f4f5;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; }
        input { -webkit-user-select: text; user-select: text; }
        body { margin: 0; font-family: 'Poppins', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- Shimmer --- */
        .shimmer { background: #f6f7f8; background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%); background-repeat: no-repeat; background-size: 800px 100%; animation: shim 1.5s infinite linear; }
        @keyframes shim { 0% { background-position: -468px 0; } 100% { background-position: 468px 0; } }

        /* --- Components --- */
        header { padding: 16px; background: #fff; border-bottom: 1px solid var(--border-color); }
        .brand { font-size: 24px; font-weight: 700; background: var(--logo-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .page { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .friend-card { background: #faf5ff; margin: 15px; padding: 15px; border-radius: 20px; display: flex; align-items: center; border: 1px solid #f0e7ff; }
        .chat-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); }
        .avatar { width: 50px; height: 50px; border-radius: 15px; background: #eee; margin-right: 15px; object-fit: cover; }

        /* --- Spinner & Alerts --- */
        #global-spinner { position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); visibility: hidden; opacity: 0; transition: 0.3s; }
        #global-spinner.active { visibility: visible; opacity: 1; }
        .loader { width: 35px; height: 35px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent-purple); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        #vynix-alert { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #000; color: #fff; padding: 12px 25px; border-radius: 12px; z-index: 10000; transition: 0.4s; }
        #vynix-alert.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

<div id="global-spinner"><div class="loader"></div></div>
<div id="vynix-alert"></div>

<header>
    <div class="brand">Vynix</div>
</header>

<main class="page">
    <div id="shimmer-container">
        <div class="chat-item"><div class="avatar shimmer"></div><div style="flex:1"><div class="shimmer" style="width:40%;height:15px;margin-bottom:10px;"></div><div class="shimmer" style="width:70%;height:10px;"></div></div></div>
    </div>
    <div id="owner-card-container"></div>
    <div id="conversations-list"></div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
        authDomain: "fire-b-a8878.firebaseapp.com",
        projectId: "fire-b-a8878",
        appId: "1:658673187627:web:6e4c29af661785f0afa36e",
        databaseURL: "https://fire-b-a8878-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // --- Safety Spinner Logic ---
    window.toggleLoading = (show) => {
        const s = document.getElementById('global-spinner');
        show ? s.classList.add('active') : s.classList.remove('active');
    };

    window.vynixNotify = (msg) => {
        const el = document.getElementById('vynix-alert');
        el.innerText = msg; el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 3000);
    };

    // --- Main Logic ---
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            toggleLoading(true);
            try {
                // Save user data
                await update(ref(db, 'users/' + user.uid), {
                    uid: user.uid,
                    name: user.displayName,
                    photo: user.photoURL,
                    email: user.email
                });
                loadApp(user.uid);
            } catch (err) {
                vynixNotify("Auth Error");
                toggleLoading(false);
            }
        } else {
            signInWithPopup(auth, provider);
        }
    });

    function loadApp(uid) {
        // Set a 5-second max timeout for the spinner just in case
        const safety = setTimeout(() => toggleLoading(false), 5000);

        // Load Personal Card
        onValue(ref(db, 'users/' + uid), snap => {
            document.getElementById('shimmer-container').style.display = 'none';
            const d = snap.val();
            document.getElementById('owner-card-container').innerHTML = `
                <div class="friend-card">
                    <img src="${d.photo}" class="avatar">
                    <div><div style="font-weight:600">Me</div><div style="font-size:12px;color:var(--text-dim)">${d.name}</div></div>
                </div>`;
            toggleLoading(false);
            clearTimeout(safety);
        });

        // Load Chats
        onValue(ref(db, 'chats'), snap => {
            const list = document.getElementById('conversations-list');
            list.innerHTML = '';
            if (snap.exists()) {
                snap.forEach(c => {
                    const data = c.val();
                    list.innerHTML += `<div class="chat-item"><img src="${data.photo}" class="avatar"><div>${data.name}</div></div>`;
                });
            }
        });
    }
</script>
</body>
</html>
