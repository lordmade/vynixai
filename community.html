<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vynix Chats</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">

    <style>
        :root {
            --accent-purple: #d946ef;
            --accent-green: #10b981;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --bg-color: #ffffff;
            --hover-bg: #f3f4f6;
            --divider: #e5e7eb;
            --logo-gradient: linear-gradient(135deg, #000000 0%, var(--accent-purple) 50%, var(--accent-green) 100%);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
        }

        /* --- Header --- */
        header {
            position: fixed; top: 0; left: 0; right: 0;
            height: 70px;
            background: #fff;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            border-bottom: 1px solid var(--divider);
        }

        .user-profile {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: #eee;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
        }

        .app-title {
            font-size: 22px; font-weight: 700;
            background: var(--logo-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Chat List --- */
        main { padding-top: 80px; }

        .chat-item {
            display: flex; align-items: center;
            padding: 14px 20px;
            cursor: pointer;
            transition: 0.2s;
        }

        .chat-item:active { background: var(--hover-bg); }

        .avatar {
            width: 55px; height: 55px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .chat-info { flex: 1; border-bottom: 1px solid #f9f9f9; padding-bottom: 10px; }
        .chat-row { display: flex; justify-content: space-between; align-items: center; }
        .name { font-weight: 600; font-size: 16px; }
        .time { font-size: 12px; color: var(--text-secondary); }
        .msg { font-size: 14px; color: var(--text-secondary); margin-top: 2px; }

        /* --- FAB --- */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px; border-radius: 20px;
            background: #000; color: #fff; border: none;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <header>
        <img id="myPhoto" class="user-profile" src="" alt="Me" onclick="logout()">
        <div class="app-title">Vynix</div>
        <span class="material-symbols-rounded">search</span>
    </header>

    <main id="chatList">
        </main>

    <button class="fab" onclick="createNewChat()">
        <span class="material-symbols-rounded">add_comment</span>
    </button>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
            authDomain: "fire-b-a8878.firebaseapp.com",
            databaseURL: "https://fire-b-a8878.firebaseio.com",
            projectId: "fire-b-a8878",
            storageBucket: "fire-b-a8878.firebasestorage.app",
            messagingSenderId: "658673187627",
            appId: "1:658673187627:web:6e4c29af661785f0afa36e"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('myPhoto').src = user.photoURL || 'https://via.placeholder.com/40';
                loadChats(user.uid);
            } else {
                window.location.href = "login.html";
            }
        });

        function loadChats(uid) {
            db.ref(`users/${uid}/chats`).on('value', snapshot => {
                const list = document.getElementById('chatList');
                list.innerHTML = '';
                snapshot.forEach(child => {
                    const chat = child.val();
                    list.innerHTML += `
                        <div class="chat-item" onclick="location.href='chat.html?id=${child.key}'">
                            <img class="avatar" src="${chat.photo || 'https://via.placeholder.com/55'}">
                            <div class="chat-info">
                                <div class="chat-row">
                                    <span class="name">${chat.name}</span>
                                    <span class="time">${chat.lastTime || ''}</span>
                                </div>
                                <div class="msg">${chat.lastMsg || 'No messages yet'}</div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        function createNewChat() {
            const email = prompt("Enter friend's email to chat:");
            if (email) {
                alert("Searching for " + email + "...");
                // In a real app, you'd search the DB for this email's UID
            }
        }

        function logout() {
            if(confirm("Log out?")) auth.signOut();
        }
    </script>
</body>
</html>
