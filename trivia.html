<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Vynix AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --card-bg: #f7f9fa;
      --text-primary: #0f1419;
      --text-secondary: #536471;
      --border: #e1e8ed;
      --accent: #ff2a6d;
      --header-bg: #ffffff;
      --chat-bubble-sent: #ff2a6d;
      --chat-bubble-received: #f7f9fa;
      --status-online: #22c55e;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --glow: 0 0 12px rgba(255,42,109,.35);
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      margin: 0; padding: 0; height: 100dvh;
      overflow: hidden;
    }
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      background: var(--header-bg); z-index: 100;
      padding: 12px 20px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      height: 64px; box-shadow: var(--shadow-sm);
    }
    .back-btn {
      background: none; border: none; color: var(--text-primary);
      font-size: 24px; cursor: pointer; padding: 8px; border-radius: 50%;
    }
    .back-btn:hover { background: rgba(255,42,109,0.1); }
    .profile-header { display: flex; align-items: center; gap: 12px; flex: 1; }
    .avatar-wrapper { position: relative; }
    .profile-pic-header {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--accent); color: #fff;
      font-weight: bold; font-size: 18px;
      display: flex; align-items: center; justify-content: center;
    }
    .status-dot-header {
      position: absolute; bottom: 2px; right: 2px;
      width: 12px; height: 12px; background: var(--status-online);
      border-radius: 50%; border: 2px solid var(--header-bg);
    }
    .profile-details { display: flex; flex-direction: column; gap: 2px; }
    .profile-name-header { font-weight: 700; font-size: 16px; color: var(--text-primary); }
    .profile-timestamp-header { font-size: 12px; color: var(--text-secondary); }

    .main-content {
      padding: 84px 20px 100px; max-width: 600px; margin: 0 auto;
      height: calc(100dvh - 164px); overflow-y: auto;
    }
    .messages-container {
      padding-bottom: 20px;
    }
    .message-item {
      display: flex; margin-bottom: 16px;
      animation: fadeIn 0.35s ease-out;
    }
    .message-received { flex-direction: row; }
    .message-sent { flex-direction: row-reverse; }
    .message-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--accent); color: #fff;
      font-weight: bold; font-size: 18px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .message-bubble {
      max-width: 74%; padding: 12px 16px;
      border-radius: 20px; word-wrap: break-word; line-height: 1.45;
    }
    .message-received .message-bubble {
      background: var(--chat-bubble-received); color: var(--text-primary);
      border-bottom-left-radius: 4px; margin-left: 12px;
      border: 1px solid var(--border);
    }
    .message-sent .message-bubble {
      background: var(--chat-bubble-sent); color: #ffffff;
      border-bottom-right-radius: 4px; margin-right: 12px;
      box-shadow: var(--glow);
    }
    .message-time {
      font-size: 12px; color: var(--text-secondary);
      margin-top: 4px; text-align: right;
    }
    .message-sent .message-time { color: rgba(255,255,255,0.8); }

    .input-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--card-bg); border-top: 1px solid var(--border);
      padding: 12px 20px; display: flex; align-items: center; gap: 12px;
      z-index: 10; box-shadow: var(--shadow-sm);
    }
    .input-group {
      flex: 1; display: flex;
      background: var(--card-bg); border: 1px solid var(--border);
      border-radius: 24px; overflow: hidden;
    }
    .input-group textarea {
      flex: 1; background: none; border: none; outline: none;
      padding: 12px 20px; color: var(--text-primary);
      font-size: 16px; resize: none; max-height: 120px;
    }
    .input-group textarea::placeholder { color: var(--text-secondary); }
    .send-btn {
      background: var(--accent); color: #fff;
      border: none; border-radius: 50%;
      width: 44px; height: 44px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 20px;
      box-shadow: var(--glow);
    }
    .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .typing-indicator {
      padding: 8px 12px; background: var(--chat-bubble-received);
      border-radius: 20px; border-bottom-left-radius: 4px;
      border: 1px solid var(--border); margin-left: 52px;
    }
    .dot {
      width: 8px; height: 8px; background: var(--accent);
      border-radius: 50%; display: inline-block;
      animation: pulse 1.4s infinite;
    }
    .dot:nth-child(2) { animation-delay: .2s; }
    .dot:nth-child(3) { animation-delay: .4s; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    @keyframes pulse { 0%,100% { opacity:.4 } 50% { opacity:1 } }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-left">
      <button class="back-btn material-icons" onclick="history.back()">arrow_back</button>
      <div class="profile-header">
        <div class="avatar-wrapper">
          <div class="profile-pic-header">VAI</div>
          <span class="status-dot-header"></span>
        </div>
        <div class="profile-details">
          <div class="profile-name-header">Vynix AI</div>
          <div class="profile-timestamp-header">Always online â€¢ Here to help</div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="messages-container" id="messages-container"></div>
  </main>

  <div class="input-bar">
    <div class="input-group">
      <textarea id="message-input" placeholder="Message Vynix AI..." rows="1"></textarea>
    </div>
    <button class="send-btn material-icons" id="send-btn">send</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getRemoteConfig, fetchAndActivate, getString } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js";

    const app = initializeApp({
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
    });

    const rc = getRemoteConfig(app);
    rc.settings.minimumFetchIntervalMillis = 3600000;
    await fetchAndActivate(rc);
    const xaiKey = getString(rc, 'xai_api_key').trim();

    if (!xaiKey) {
      alert("Vynix AI is not configured yet. Missing API key.");
      document.getElementById('send-btn').disabled = true;
    }

    const container = document.getElementById('messages-container');
    const input = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');

    let history = [{
      role: "system",
      content: `You are Vynix AI â€“ the official smart assistant for Vynix social app. 
You are witty, helpful, confident, and speak like a cool Gen-Z friend. Keep replies short, fun and natural. Use emojis where it fits.`
    }];

    function addMessage(text, type) { // type: 'user' or 'ai'
      const isUser = type === 'user';
      const div = document.createElement('div');
      div.className = `message-item ${isUser ? 'message-sent' : 'message-received'}`;
      div.innerHTML = `
        <div class="message-avatar">${isUser ? 'You' : 'VAI'}</div>
        <div class="message-bubble">
          ${text.replace(/\n/g, '<br>')}
          <div class="message-time">${new Date().toLocaleTimeString('en-ZA', {hour:'2-digit', minute:'2-digit'})}</div>
        </div>
      `;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function showTyping() {
      const typing = document.createElement('div');
      typing.id = 'typing';
      typing.className = 'message-item message-received';
      typing.innerHTML = `
        <div class="message-avatar">V</div>
        <div class="message-bubble typing-indicator">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      `;
      container.appendChild(typing);
      container.scrollTop = container.scrollHeight;
    }

    function hideTyping() {
      document.getElementById('typing')?.remove();
    }

    async function sendMessage() {
      const msg = input.value.trim();
      if (!msg || sendBtn.disabled) return;

      addMessage(msg, 'user');
      history.push({ role: "user", content: msg });
      input.value = '';
      input.style.height = 'auto';
      sendBtn.disabled = true;

      showTyping();

      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${xaiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "grok-4-1-fast-non-reasoning",
            messages: history,
            temperature: 0.85,
            max_tokens: 500
          })
        });

        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "Hmm, something went wrongâ€¦";

        hideTyping();
        addMessage(reply, 'ai');
        history.push({ role: "assistant", content: reply });
      } catch (e) {
        hideTyping();
        addMessage("Network error â€“ check your connection and try again.", 'ai');
        console.error(e);
      }

      sendBtn.disabled = false;
    }

    // Auto-resize input
    input.addEventListener('input', () => {
      input.style.height = 'auto';
      input.style.height = Math.min(input.scrollHeight, 120) + 'px';
    });

    // Send on Enter (not Shift+Enter)
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    sendBtn.addEventListener('click', sendMessage);

    // Welcome message
    setTimeout(() => {
      addMessage("Hey! I'm Vynix AI â€“ your smart sidekick. Ask me anything ðŸ”¥", 'ai');
    }, 600);
  </script>
</body>
</html>
