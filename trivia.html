<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Vynix AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --card-bg: #f7f9fa;
      --text-primary: #0f1419;
      --text-secondary: #536471;
      --border: #e1e8ed;
      --accent: #ff2a6d;
      --header-bg: #ffffff;
      --chat-bubble-sent: #ff2a6d;
      --chat-bubble-received: #f7f9fa;
      --status-online: #22c55e;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --glow: 0 0 12px rgba(255,42,109,.35);
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      margin: 0; padding: 0;
      overflow-x: hidden;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
      line-height: 1.4;
    }
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      background: var(--header-bg);
      z-index: 100;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      height: 64px;
      box-shadow: var(--shadow-sm);
    }
    .back-btn {
      background: none; border: none; color: var(--text-primary);
      font-size: 24px; cursor: pointer; padding: 8px; border-radius: 50%;
      transition: background 0.2s ease;
    }
    .back-btn:hover { background: rgba(255,42,109,0.1); }
    .profile-header { display: flex; align-items: center; gap: 12px; flex: 1; }
    .avatar-wrapper { position: relative; }
    .profile-pic-header {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--accent); color: #fff;
      font-weight: bold; font-size: 18px;
      display: flex; align-items: center; justify-content: center;
    }
    .status-dot-header {
      position: absolute; bottom: 2px; right: 2px;
      width: 12px; height: 12px; background: var(--status-online);
      border-radius: 50%; border: 2px solid var(--header-bg);
    }
    .profile-details { display: flex; flex-direction: column; gap: 2px; }
    .profile-name-header { font-weight: 700; font-size: 16px; color: var(--text-primary); }
    .profile-timestamp-header { font-size: 12px; color: var(--text-secondary); }
    .main-content { padding: 84px 20px 120px; max-width: 600px; margin: 0 auto; }
    .messages-container { overflow-y: auto; padding-bottom: 20px; min-height: calc(100vh - 204px); }
    .message-item {
      display: flex; margin-bottom: 16px;
      animation: fadeIn 0.35s ease-out;
    }
    .message-received { flex-direction: row; }
    .message-sent { flex-direction: row-reverse; }
    .message-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--accent); color: #fff;
      font-weight: bold; font-size: 18px;
      display: flex; align-items: center; justify-content: center;
      margin-left: 12px; flex-shrink: 0;
    }
    .message-bubble {
      max-width: 74%; padding: 12px 16px;
      border-radius: 20px; word-wrap: break-word;
      line-height: 1.45;
    }
    .message-received .message-bubble {
      background: var(--chat-bubble-received);
      color: var(--text-primary);
      border-bottom-left-radius: 4px;
      margin-left: 12px;
      border: 1px solid var(--border);
    }
    .message-sent .message-bubble {
      background: var(--chat-bubble-sent);
      color: #ffffff;
      border-bottom-right-radius: 4px;
      margin-right: 12px;
      box-shadow: var(--glow);
    }
    .message-time {
      font-size: 12px; color: var(--text-secondary);
      margin-top: 4px; text-align: right;
      display: flex; align-items: center; justify-content: flex-end; gap: 4px;
    }
    .message-sent .message-time { color: rgba(255,255,255,0.8); }
    .input-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--card-bg);
      border-top: 1px solid var(--border);
      padding: 12px 20px;
      display: flex; align-items: center; gap: 12px;
      z-index: 10; box-shadow: var(--shadow-sm);
    }
    .input-group {
      flex: 1; display: flex;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 24px; overflow: hidden;
    }
    .input-group textarea {
      flex: 1; background: none; border: none; outline: none;
      padding: 12px 20px; color: var(--text-primary);
      font-size: 16px; resize: none; max-height: 120px;
    }
    .input-group textarea::placeholder { color: var(--text-secondary); }
    .send-btn {
      background: var(--accent); color: #fff;
      border: none; border-radius: 50%;
      width: 44px; height: 44px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 20px;
      box-shadow: var(--glow); transition: all .2s;
    }
    .send-btn:hover { transform: scale(1.06); }
    .typing-indicator {
      font-style: italic; color: var(--accent);
      font-size: 14px; padding: 8px 12px;
      background: var(--chat-bubble-received);
      border-radius: 20px; max-width: 70%;
      margin-left: 52px; border-bottom-left-radius: 4px;
      border: 1px solid var(--border);
    }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    @keyframes pulse { 0%,100% { opacity:.4 } 50% { opacity:1 } }
    .thinking .dot {
      width: 8px; height: 8px; background: var(--accent);
      border-radius: 50%; display: inline-block;
      animation: pulse 1.4s infinite;
    }
    .thinking .dot:nth-child(2) { animation-delay: .2s; }
    .thinking .dot:nth-child(3) { animation-delay: .4s; }
  </style>
</head>
<body class="light">

  <header class="header">
    <div class="header-left">
      <button class="back-btn material-icons" onclick="history.back()">arrow_back</button>
      <div class="profile-header">
        <div class="avatar-wrapper">
          <div class="profile-pic-header">VAI</div>
          <span class="status-dot-header"></span>
        </div>
        <div class="profile-details">
          <div class="profile-name-header">Vynix AI</div>
          <div class="profile-timestamp-header">Always online • Here to help</div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="messages-container" id="messages-container"></div>
  </main>

  <div class="input-bar">
    <div class="input-group">
      <textarea id="message-input" placeholder="Message Vynix AI..." rows="1"></textarea>
    </div>
    <button class="send-btn material-icons" id="send-btn">send</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getRemoteConfig, fetchAndActivate, getString } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js";

    const app = initializeApp({
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
    });

    const rc = getRemoteConfig(app);
    rc.settings.minimumFetchIntervalMillis = 3600000;
    await fetchAndActivate(rc);
    const xaiKey = getString(rc, 'xai_api_key');

    if (!xaiKey || xaiKey.trim() === '') {
      alert("Vynix AI not ready – missing API key");
    }

    const messagesContainer = document.getElementById('messages-container');
    const input = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');

    let history = [
      { role: "system", content: `You are Vynix AI – the official smart assistant for the Vynix social platform.
You are witty, helpful, confident, and speak like a cool Gen-Z friend. Keep replies short, fun, and natural. Use emojis where it fits. Today is ${new Date().toLocaleDateString('en-ZA')}.` }
    ];

    function addMessage(content, sender) {
      const isSent = sender === 'user';
      const bubbleClass = isSent ? 'message-sent' : 'message-received';
      const avatar = isSent ? 'You' : 'VAI';

      const div = document.createElement('div');
      div.className = `message-item ${bubbleClass}`;
      div.innerHTML = `
        <div class="message-avatar">${avatar[0]}</div>
        <div class="message-bubble">
          ${content.replace(/\n/g, '<br>')}
          <div class="message-time">${new Date().toLocaleTimeString('en-ZA',{hour:'2-digit',minute:'2-digit'})}</div>
        </div>
      `;
      messagesContainer.appendChild(div);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function addTyping() {
      const typing = document.createElement('div');
      typing.id = 'typing-indicator';
      typing.className = 'message-item message-received';
      typing.innerHTML = `
        <div class="message-avatar">V</div>
        <div class="message-bubble typing-indicator thinking">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      `;
      messagesContainer.appendChild(typing);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function removeTyping() {
      document.getElementById('typing-indicator')?.remove();
    }

    async function getReply(userMsg) {
      addTyping();
      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${xaiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "grok-4-1-fast-non-reasoning",
            messages: [...history, { role: "user", content: userMsg }],
            temperature: 0.85,
            max_tokens: 500
          })
        });

        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "Hmm, something went wrong… try again?";
        return reply;
      } catch (err) {
        console.error(err);
        return "Network acting up, give me a sec…";
      } finally {
        removeTyping();
      }
    }

    async function send() {
      const msg = input.value.trim();
      if (!msg) return;

      addMessage(msg, 'user');
      history.push({ role: "user", content: msg });
      input.value = '';
      input.style.height = 'auto';

      const reply = await getReply(msg);
      addMessage(reply, 'ai');
      history.push({ role: "assistant", content: reply });

      if (history.length > 40) history = [history[0], ...history.slice(-30)];
    }

    input.addEventListener('input', () => {
      input.style.height = 'auto';
      input.style.height = Math.min(input.scrollHeight, 120) + 'px';
    });

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    sendBtn.addEventListener('click', send);

    // Welcome message
    setTimeout(() => {
      addMessage("Hey there! I'm Vynix AI – your smart sidekick on Vynix. Ask me anything, from trends to tips, I've got you", 'ai');
    }, 700);
  </script>
</body>
</html>
