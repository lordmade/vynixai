<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Vynix AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Prism -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <!-- Marked -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      --bg: #F7F7F8;
      --card-bg: #1C2526;
      --text-primary: #FFFFFF;
      --text-secondary: #4B5EAA;
      --border: #4A5568;
      --highlight: #38B2AC;
      --user-msg-bg: #E0E7FF;
      --ai-msg-bg: #1C2526;
    }

    * {
      -webkit-touch-callout: none !important;
      -webkit-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
      user-select: none !important;
      -webkit-tap-highlight-color: transparent !important;
    }
    input, textarea, .content {
      -webkit-user-select: text !important;
      user-select: text !important;
    }
    html, body {
      overscroll-behavior: none;
      height: 100vh;
      margin: 0;
    }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-secondary);
      display: flex;
      flex-direction: column;
    }

    /* ---------- TOP BAR ---------- */
    .top-bar {
      flex-shrink: 0;
      height: 64px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      z-index: 10;
    }
    .v-logo {
      width: 36px; height: 36px; background: #000; border-radius: 10px; display: flex; align-items: center; justify-content: center; padding: 4px;
    }
    .v-logo svg { width: 22px; height: 22px; fill: white; }
    #api-status {
      width: 12px; height: 12px; border-radius: 50%; background: red; box-shadow: 0 0 8px red; transition: all 0.4s;
    }
    #api-status.connected { background: lime; box-shadow: 0 0 15px lime; }

    /* ---------- CHAT AREA ---------- */
    .chat-area {
      flex: 1 1 0%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      overscroll-behavior: contain;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    /* full-width vertical bubbles */
    .message {
      display: flex;
      flex-direction: column;
      width: 100%;
    }
    .message.user { align-items: flex-end; }
    .message.ai  { align-items: flex-start; }
    .message .content {
      max-width: 75%;
      padding: 0.75rem 1.1rem;
      border-radius: 1.1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,.18);
      line-height: 1.5;
    }
    .message.user .content {
      background: linear-gradient(135deg, var(--user-msg-bg), #C7D2FE);
      color: #1E1E1E;
    }
    .message.ai .content {
      background: linear-gradient(135deg, var(--ai-msg-bg), #2D3748);
      color: var(--text-primary);
    }
    .message-time {
      font-size: 0.65rem; opacity: 0.6; margin-top: 0.25rem; padding: 0 0.4rem;
    }
    .message-time.ai { align-self: flex-start; }
    .message-time.user { align-self: flex-end; }

    /* ---------- INPUT BAR ---------- */
    .input-bar {
      flex-shrink: 0;
      padding: 0.75rem 1rem;
      border-top: 1px solid var(--border);
      background: var(--bg);
    }
    .input-wrapper {
      display: flex; align-items: center; gap: 0.5rem;
      background: var(--card-bg); border-radius: 9999px; padding: 0.5rem 1rem;
    }
    #chat-input {
      flex: 1; background: transparent; border: none; outline: none;
      color: var(--text-primary); font-size: 1rem;
    }
    #send-button { background: none; border: none; cursor: pointer; }
    #send-button svg { width: 1.5rem; height: 1.5rem; stroke: var(--text-primary); }

    /* ---------- SIDEBAR ---------- */
    .sidebar {
      position: fixed; inset: 0; right: auto; width: 280px; height: 100vh;
      background: white; box-shadow: 2px 0 10px rgba(0,0,0,.1);
      transform: translateX(-100%); transition: transform .3s ease; z-index: 40;
      display: flex; flex-direction: column;
    }
    .sidebar.open { transform: translateX(0); }
    .sidebar-header {
      background: #000; color: white; padding: 1.5rem; text-align: center;
    }
    #conv-list { flex: 1; overflow-y: auto; }
    .conv-item {
      padding: 1rem 1.5rem; border-bottom: 1px solid #eee; cursor: pointer;
      display: flex; justify-content: space-between; align-items: center;
    }
    .conv-item:hover { background: #f0f0f0; }
    .conv-item.active { background: #e0e7ff; font-weight: 600; }
    .delete-conv { color: #ef4444; opacity: .7; cursor: pointer; }
    #user-plan-badge {
      margin: 1rem; padding: .6rem 1rem; border-radius: 9999px;
      background: linear-gradient(135deg, var(--highlight), #4ADEDE);
      color: white; font-weight: 700; font-size: .8rem; text-align: center;
    }

    /* ---------- OVERLAY ---------- */
    #overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,.6);
      opacity: 0; visibility: hidden; transition: all .3s; z-index: 35;
    }
    #overlay.on { opacity: 1; visibility: visible; }

    /* ---------- OTHER ---------- */
    .hidden { display: none; }
    .content pre { position: relative; background: #2d2d2d !important; border-radius: 12px !important; padding: 20px !important; margin: 16px 0 !important; overflow-x: auto; border: 1px solid #444; }
    .content pre .code-copy-btn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,.15); border: none; border-radius: 8px; padding: 6px; cursor: pointer; opacity: .7; transition: opacity .2s; }
    .content pre:hover .code-copy-btn { opacity: 1; }
    .content pre .code-copy-btn svg { width: 16px; height: 16px; stroke: white; }
  </style>
</head>
<body>
  <!-- ---------- TOP BAR ---------- -->
  <header class="top-bar">
    <button id="menuBtn" class="flex items-center gap-2 text-sm text-white bg-[var(--card-bg)] border border-[var(--border)] px-3 py-2 rounded-full">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      Menu
    </button>
    <div class="v-logo"><svg viewBox="0 0 24 24"><path fill="#fff" d="M19.75 2.25h3L12 21.75h-3L1.25 2.25h3l7.5 17.19z"/></svg></div>
    <div id="api-status"></div>
  </header>

  <!-- ---------- CHAT ---------- -->
  <section id="chatPane" class="chat-area">
    <div id="welcome" class="text-center m-auto">
      <h1 class="text-lg font-semibold text-black">Hey there!</h1>
      <p class="text-sm text-gray-600 mt-1">Start chatting ‚Äî replies are instant</p>
    </div>
  </section>

  <!-- ---------- INPUT ---------- -->
  <div class="input-bar">
    <div class="input-wrapper">
      <input id="chatInput" type="text" placeholder="Type a message..." autocomplete="off">
      <button id="sendBtn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M5 12l6-6m-6 12l6 6"/></svg>
      </button>
    </div>
  </div>

  <!-- ---------- SIDEBAR ---------- -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <div class="v-logo mx-auto"><svg viewBox="0 0 24 24"><path fill="#fff" d="M19.75 2.25h3L12 21.75h-3L1.25 2.25h3l7.5 17.19z"/></svg></div>
      <div class="mt-3">
        <div id="slideProfile" class="w-18 h-18 rounded-full bg-[var(--highlight)] mx-auto flex items-center justify-center text-white text-2xl font-bold">U</div>
        <div id="slideName" class="mt-2 font-semibold">User</div>
      </div>
    </div>
    <button id="newConvBtn" class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold">+ New Conversation</button>
    <div id="convList" class="flex-1 overflow-y-auto"></div>
    <div id="userPlanBadge">Free Plan ‚Ä¢ 25 000 tokens/day</div>
  </aside>

  <!-- ---------- OVERLAY ---------- -->
  <div id="overlay" class=""></div>

  <!-- ---------- UPGRADE MODAL ---------- -->
  <div id="upgradeModal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-2xl p-6 shadow-2xl max-w-md w-11/12 scale-95 opacity-0 invisible transition-all">
    <h2 class="text-xl font-bold mb-2">Upgrade Vynix AI</h2>
    <p class="mb-4 text-sm opacity-90">You've reached today's free limit. Unlock more with a plan!</p>
    <div class="grid grid-cols-2 gap-3">
      <div class="border border-gray-600 rounded-xl p-3 text-center">
        <h3 class="font-semibold">Free</h3>
        <div class="text-xl font-bold">R0</div>
        <div class="text-xs">25 000 tokens/day</div>
        <button class="mt-2 opacity-50" disabled>Current Plan</button>
      </div>
      <div class="border-2 border-[var(--highlight)] rounded-xl p-3 text-center">
        <h3 class="font-semibold">Pro</h3>
        <div class="text-xl font-bold">R99<span class="text-xs">/month</span></div>
        <div class="text-xs">1 000 000 tokens/month</div>
        <button class="mt-2 bg-[var(--highlight)] text-white px-3 py-1 rounded-md">Upgrade (Soon)</button>
      </div>
    </div>
    <button id="maybeLater" class="mt-4 opacity-70">Maybe later</button>
  </div>

  <!-- ---------- Firebase ---------- -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getDatabase, ref, onValue, push, set, remove, get } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getRemoteConfig, getString, fetchAndActivate } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    let xaiApiKey = null, xaiEndpoint = "https://api.x.ai/v1/chat/completions";
    const statusDot = document.getElementById('api-status');
    let userId = null, todayTokensUsed = 0;
    const DAILY_TOKEN_LIMIT = 25000;
    const SYSTEM_PROMPT = `You are Vynix AI, a super helpful, witty, and friendly AI assistant created by the vynix.ai team. Never mention Grok, xAI, Elon Musk, or any other model. You are Vynix AI ‚Äî that's your full identity. If asked who you are, say: "I'm Vynix AI, proudly built by the vynix.ai team ‚ù§Ô∏è".`;

    marked.setOptions({ breaks: true, gfm: true, highlight: (code, lang) => Prism.languages[lang] ? Prism.highlight(code, Prism.languages[lang], lang) : code });

    function renderMarkdown(text) {
      let html = marked.parse(text);
      return html.replace(/<pre><code class="language-([\w-]+)">([\s\S]*?)<\/code><\/pre>/g,
        '<pre><code class="language-$1">$2</code><button class="code-copy-btn"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button></pre>');
    }

    async function initRemote() {
      const rc = getRemoteConfig(app);
      rc.settings.minimumFetchIntervalMillis = 3600000;
      await fetchAndActivate(rc);
      xaiApiKey = getString(rc, 'xai_api_key').trim();
      const ep = getString(rc, 'xai_endpoint').trim();
      if (ep) xaiEndpoint = ep;
      if (xaiApiKey?.length > 10) statusDot.classList.add('connected');
    }
    async function loadUsage() {
      if (!userId) return;
      const today = new Date().toISOString().slice(0, 10);
      const snap = await get(ref(db, `usage/${userId}/${today}`));
      todayTokensUsed = snap.val() || 0;
    }
    async function addUsage(i, o) {
      if (!userId) return;
      todayTokensUsed += i + o;
      const today = new Date().toISOString().slice(0, 10);
      await set(ref(db, `usage/${userId}/${today}`), todayTokensUsed);
    }
    function estimateTokens(t) { return Math.ceil(t.length / 3.8); }

    async function getReply(userMsg, hist = []) {
      if (!xaiApiKey) return "Vynix AI is waking up‚Ä¶";
      const msgs = [{ role: "system", content: SYSTEM_PROMPT }];
      hist.slice(-20).forEach(m => msgs.push({ role: m.sender === 'user' ? 'user' : 'assistant', content: m.text }));
      msgs.push({ role: "user", content: userMsg });
      const inputTokens = estimateTokens(msgs.map(m => m.content).join('\n'));
      if (todayTokensUsed + inputTokens > DAILY_TOKEN_LIMIT) { showUpgrade(); return "You've reached today's free limit! Upgrade for unlimited access ‚ù§Ô∏è"; }
      try {
        const res = await fetch(xaiEndpoint, { method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${xaiApiKey}` }, body: JSON.stringify({ model: "grok-3", messages: msgs, temperature: 0.8, stream: false }) });
        if (!res.ok) throw new Error(await res.text());
        const data = await res.json();
        const reply = data.choices[0].message.content.trim();
        await addUsage(inputTokens, estimateTokens(reply));
        return reply;
      } catch (e) { console.error(e); return "Oops! My brain had a hiccup. Try again? üòÖ"; }
    }

    function showUpgrade() {
      document.getElementById('overlay').classList.add('on');
      document.getElementById('upgradeModal').classList.remove('scale-95', 'opacity-0', 'invisible');
    }
    function hideUpgrade() {
      document.getElementById('overlay').classList.remove('on');
      document.getElementById('upgradeModal').classList.add('scale-95', 'opacity-0', 'invisible');
    }

    async function typeText(text, el) {
      el.innerHTML = '';
      for (let i = 0; i < text.length; i += 8) {
        el.innerHTML += text.substring(i, i + 8).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c]));
        el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        await new Promise(r => setTimeout(r, 10 + Math.random() * 15));
      }
      el.innerHTML = renderMarkdown(text);
      Prism.highlightAllUnder(el.parentElement);
      el.parentElement.querySelectorAll('.code-copy-btn').forEach(btn => {
        btn.onclick = e => {
          e.stopPropagation();
          navigator.clipboard.writeText(btn.previousElementSibling.textContent);
          btn.innerHTML = '‚úì';
          setTimeout(() => btn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>', 1500);
        };
      });
    }

    function addMessage(text, sender, ts = Date.now(), isNew = false) {
      const wrap = document.createElement('div');
      wrap.className = `message ${sender}`;
      const content = document.createElement('div');
      content.className = 'content';
      const time = document.createElement('div');
      time.className = `message-time ${sender}`;
      time.textContent = new Date(ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      if (sender === 'ai') {
        const btn = document.createElement('button');
        btn.className = 'copy-reply-btn';
        btn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>';
        btn.onclick = e => { e.stopPropagation(); navigator.clipboard.writeText(text); btn.innerHTML = '‚úì'; setTimeout(() => btn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>', 1500); };
        wrap.appendChild(btn);
      }
      wrap.appendChild(content);
      wrap.appendChild(time);
      chatPane.appendChild(wrap);
      chatPane.scrollTop = chatPane.scrollHeight;
      if (isNew) { typeText(text, content); } else { content.innerHTML = sender === 'ai' ? renderMarkdown(text) : text.replace(/\n/g, '<br>'); }
    }

    function saveMessage(text, sender) {
      if (!currentConvId) return;
      push(ref(db, `users/${userId}/conversations/${currentConvId}/messages`), { text, sender, timestamp: Date.now() });
    }

    async function send() {
      const text = chatInput.value.trim();
      if (!text) return;
      if (!currentConvId) startNewConversation();
      addMessage(text, 'user');
      saveMessage(text, 'user');
      history.push({ sender: 'user', text });
      chatInput.value = '';
      addMessage('Typing...', 'ai');
      await loadUsage();
      const reply = await getReply(text, history);
      chatPane.lastElementChild.remove();
      addMessage(reply, 'ai', Date.now(), true);
      history.push({ sender: 'ai', text: reply });
      saveMessage(reply, 'ai');
    }

    function startNewConversation() {
      history = []; chatPane.innerHTML = ''; welcome.classList.add('hidden');
      const ref2 = push(ref(db, `users/${userId}/conversations`));
      currentConvId = ref2.key;
      set(ref2, { createdAt: Date.now(), title: 'New Chat' });
    }
    function loadConversation(id, data) {
      currentConvId = id; history = []; chatPane.innerHTML = ''; welcome.classList.add('hidden');
      if (data.messages) {
        Object.entries(data.messages).sort(([, a], [, b]) => a.timestamp - b.timestamp).forEach(([, m]) => {
          addMessage(m.text, m.sender, m.timestamp, false);
          if (m.sender !== 'system') history.push({ sender: m.sender, text: m.text });
        });
      }
    }
    function deleteConversation(id) {
      remove(ref(db, `users/${userId}/conversations/${id}`));
      if (id === currentConvId) { chatPane.innerHTML = ''; welcome.classList.remove('hidden'); currentConvId = null; history = []; }
    }
    function renderSidebar() {
      convList.innerHTML = '';
      Object.entries(conversations).sort(([, a], [, b]) => b.createdAt - a.createdAt).forEach(([id, conv]) => {
        const div = document.createElement('div');
        div.className = `conv-item ${id === currentConvId ? 'active' : ''}`;
        div.innerHTML = `<span>${conv.title || 'New Chat'}</span>
          <button class="delete-conv">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          </button>`;
        div.querySelector('.delete-conv').onclick = e => { e.stopPropagation(); deleteConversation(id); };
        div.onclick = () => loadConversation(id, conv);
        convList.appendChild(div);
      });
    }
    async function loadProfile() {
      const snap = await get(ref(db, `users/${userId}`));
      const user = snap.val() || {};
      slideName.textContent = user.displayName || 'User';
      slideProfile.textContent = (user.displayName || 'U')[0].toUpperCase();
      if (user.photoURL) slideProfile.innerHTML = `<img src="${user.photoURL}" class="w-full h-full object-cover rounded-full">`;
      userPlanBadge.textContent = user.plan === 'pro' ? 'Pro Plan ‚Ä¢ 1 000 000 tokens/month' : 'Free Plan ‚Ä¢ 25 000 tokens/day';
      if (user.plan === 'pro') userPlanBadge.style.background = 'linear-gradient(135deg, #f59e0b, #f97316)';
    }

    /* ---------- DOM ---------- */
    const chatPane = document.getElementById('chatPane');
    const welcome = document.getElementById('welcome');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const convList = document.getElementById('convList');
    const newConvBtn = document.getElementById('newConvBtn');
    const slideProfile = document.getElementById('slideProfile');
    const slideName = document.getElementById('slideName');
    const userPlanBadge = document.getElementById('userPlanBadge');
    let conversations = {}, currentConvId = null, history = [];

    /* ---------- EVENTS ---------- */
    menuBtn.onclick = () => { sidebar.classList.add('open'); overlay.classList.add('on'); };
    overlay.onclick = () => { sidebar.classList.remove('open'); overlay.classList.remove('on'); };
    newConvBtn.onclick = () => { overlay.onclick(); startNewConversation(); };
    sendBtn.onclick = send;
    chatInput.addEventListener('keypress', e => { if (e.key === 'Enter') send(); });
    document.getElementById('maybeLater').onclick = hideUpgrade;

    /* ---------- FB ---------- */
    onAuthStateChanged(auth, async user => {
      if (user) {
        userId = user.uid;
        await initRemote();
        await loadUsage();
        await loadProfile();
        onValue(ref(db, `users/${userId}/conversations`), snap => { conversations = snap.val() || {}; renderSidebar(); });
        if (!currentConvId && Object.keys(conversations).length) {
          const [latestId, latestData] = Object.entries(conversations).sort(([, a], [, b]) => b.createdAt - a.createdAt)[0];
          loadConversation(latestId, latestData);
        }
      } else {
        signInAnonymously(auth);
      }
    });
  </script>
</body>
</html>
