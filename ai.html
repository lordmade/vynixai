<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Vynix Buddy</title>

  <!-- PWA + Icons -->
  <link rel="manifest" href="data:application/manifest+json,{
    &quot;name&quot;:&quot;Vynix Buddy&quot;,&quot;short_name&quot;:&quot;Vynix&quot;,&quot;description&quot;:&quot;Your CAPS AI Tutor&quot;,
    &quot;start_url&quot;:&quot;/&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#8b5cf6&quot;,
    &quot;icons&quot;:[{&quot;src&quot;:&quot;https://api.dicebear.com/7.x/shapes/svg?seed=Vynix&backgroundColor=8b5cf6&size=192&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;},
    {&quot;src&quot;:&quot;https://api.dicebear.com/7.x/shapes/svg?seed=Vynix&backgroundColor=8b5cf6&size=512&quot;,&quot;sizes&quot;:&quot;512x512&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]
  }">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="https://api.dicebear.com/7.x/shapes/svg?seed=Vynix&backgroundColor=8b5cf6&size=180">

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    *{box-sizing:border-box;-webkit-user-select:none;user-select:none}
    textarea,input,.content{-webkit-user-select:text;user-select:text}
    body{font-family:'Inter',sans-serif;background:#fff;color:#111827;margin:0;height:100dvh;display:flex;flex-direction:column;overflow:hidden}
    #chatPane{flex:1;overflow-y:auto;padding:1rem 1rem 140px;-webkit-overflow-scrolling:touch}
    .message{margin:1.5rem 0;position:relative}
    .message.ai .content{background:#f8f9fa;border:1px solid #e9ecef;border-radius:1rem;padding:1rem 1.2rem;max-width:88%}
    .message.user .content{background:#9ca3af;color:#111827;border-radius:1rem;padding:1rem 1.2rem;margin-left:auto;max-width:85%;white-space:pre-wrap;word-break:break-word}
    .timestamp{font-size:.75rem;color:#6b7280;margin-top:4px}
    .message.ai .timestamp{margin-left:8px}
    .message.user .timestamp{margin-right:8px;text-align:right}
    .ai-actions{display:flex;gap:12px;margin-top:8px;margin-left:8px;opacity:.8}
    .action-btn{width:36px;height:36px;background:#f1f3f4;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
    .action-btn:hover{background:#e0e0e0;transform:scale(1.1)}
    .thinking{display:flex;gap:8px;padding:1rem 1.2rem}
    .dot{width:10px;height:10px;background:#8b5cf6;border-radius:50%;animation:pulse 1.4s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes pulse{0%,100%{opacity:.4;transform:scale(.8)}50%{opacity:1;transform:scale(1)}}
    .input-bar{position:fixed;bottom:0;left:0;right:0;padding:.75rem;padding-bottom:calc(.75rem + env(safe-area-inset-bottom));background:#fff;border-top:1px solid #e5e7eb;box-shadow:0 -4px 20px rgba(0,0,0,.08);z-index:100}
    .input-container{background:#f9fafb;border:1px solid #d1d5db;border-radius:1.5rem;padding:.75rem 1rem;display:flex;align-items:center;gap:.5rem;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    .input-container:focus-within{border-color:#8b5cf6;box-shadow:0 0 0 3px rgba(139,92,246,.15)}
    #chatInput{flex:1;background:transparent;border:none;outline:none;font-size:1rem;resize:none;max-height:120px;line-height:1.5}
    .send-btn,.upload-btn{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center}
    .send-btn{background:#8b5cf6}.send-btn:disabled{background:#9ca3af;cursor:not-allowed}
    .upload-btn{background:#e5e7eb}
    #filePreview,#docPreview{width:40px;height:40px;border-radius:.5rem;display:none;flex-shrink:0}
    .doc-preview{background:#f3f4f6;border:1px solid #d1d5db;display:flex;align-items:center;justify-content:center}
    .token-bar{position:fixed;top:0;left:0;right:0;background:#8b5cf6;color:#fff;padding:.6rem 1rem;font-size:.9rem;text-align:center;z-index:50;display:flex;align-items:center;justify-content:center;gap:.5rem}
    .offline-notice{position:fixed;top:56px;left:0;right:0;background:#f59e0b;color:#fff;padding:.5rem;text-align:center;z-index:999;font-weight:600;display:none}
    #customAlert{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-150%);background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);color:#fff;padding:1rem 1.5rem;border-radius:9999px;font-weight:600;box-shadow:0 10px 25px rgba(0,0,0,.25);z-index:9999;transition:transform .3s ease}
    #customAlert.show{transform:translateX(-50%) translateY(0)}
    .bottom-sheet{position:fixed;bottom:-100%;left:0;right:0;background:#fff;border-radius:1.5rem 1.5rem 0 0;padding:1.5rem;box-shadow:0 -10px 40px rgba(0,0,0,.25);transition:bottom .4s cubic-bezier(.32,.72,0,1);z-index:200;max-height:92dvh;overflow-y:auto}
    .bottom-sheet.active{bottom:0}
    .sheet-handle{width:40px;height:5px;background:#ddd;border-radius:3px;margin:0 auto 1rem}
  </style>
</head>
<body>

   <div class="token-bar">
    <span id="tokenCount">15,000</span> tokens left today
    <button id="upgradePill" class="ml-3 px-4 py-1.5 bg-white/20 hover:bg-white/30 text-white font-semibold text-sm rounded-full border border-white/40 transition active:scale-95">Upgrade</button>
  </div>

  <!-- ADD THIS NEW SIGN OUT BUTTON HERE -->
  <div class="absolute top-4 right-4 z-50">
    <button id="signOutBtn" class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white font-medium text-sm rounded-full border border-white/40 transition active:scale-95 flex items-center gap-2">
      <i data-lucide="log-out" width="16" height="16"></i>
      Sign Out
    </button>
  </div>
  <!-- END OF NEW BUTTON -->

  <div class="offline-notice" id="offlineNotice">Offline – Your chats are saved</div>

  <section id="chatPane">
    <div class="text-center mt-28 text-gray-600 px-4">
      <h1 class="text-4xl font-black mb-2 text-purple-600">Vynix Buddy</h1>
      <p class="text-lg">Your CAPS AI Tutor • Grades 1–12 • South Africa</p>
    </div>
  </section>

  <div class="input-bar">
    <div class="input-container">
      <button class="upload-btn" id="uploadBtn"><i data-lucide="paperclip"></i></button>
      <input type="file" id="hiddenFile" accept="image/*,.pdf" hidden>
      <img id="filePreview" alt="Preview">
      <div class="doc-preview" id="docPreview"><i data-lucide="file-text" width="20" height="20"></i></div>
      <textarea id="chatInput" placeholder="Ask me anything..." rows="1"></textarea>
      <button id="sendBtn" class="send-btn" disabled><i data-lucide="send" class="text-white"></i></button>
    </div>
  </div>

  <!-- Upgrade Sheet -->
  <div id="upgradeSheet" class="bottom-sheet">
    <div class="sheet-handle"></div>
    <button onclick="document.getElementById('upgradeSheet').classList.remove('active')" class="absolute top-4 right-4 text-2xl text-gray-400">×</button>
    <div class="text-center px-4">
      <h2 class="text-3xl font-black mb-3">Go Unlimited – R79/month</h2>
      <p class="text-lg text-gray-600 mb-6">No token limits • Faster responses • Full exam papers</p>
      <button id="payNowBtn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold text-2xl py-6 rounded-3xl shadow-2xl hover:scale-105 active:scale-95">
        Pay R79 with Yoco
      </button>
    </div>
  </div>

  <!-- Paper Generator Sheet -->
  <div id="paperSheet" class="bottom-sheet">
    <div class="sheet-handle"></div>
    <button onclick="document.getElementById('paperSheet').classList.remove('active')" class="absolute top-4 right-4 text-2xl text-gray-400">×</button>
    <div class="p-4 space-y-4">
      <h3 class="text-xl font-bold">Generate CAPS Practice Paper</h3>
      <select id="subjectSelect" class="w-full border rounded-lg p-3">
        <option>Mathematics</option><option>Physical Sciences</option><option>Life Sciences</option>
        <option>Accounting</option><option>Geography</option><option>History</option><option>English HL</option>
      </select>
      <input type="text" id="topicInput" placeholder="Topic (e.g. Quadratic Equations)" class="w-full border rounded-lg p-3">
      <button id="generatePaperBtn" class="w-full bg-purple-600 text-white font-bold py-4 rounded-xl hover:bg-purple-700">
        Generate 5 Tough Questions + Memo
      </button>
    </div>
  </div>

  <div id="customAlert"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getRemoteConfig, fetchAndActivate, getString, getBoolean } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js";

    lucide.createIcons();
    const { jsPDF } = window.jspdf;

    const app = initializeApp({
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    });

    const auth = getAuth(app);
    const db = getDatabase(app);

    let xaiKey = null, elevenlabsKey = null, yocoKey = null, yocoEnabled = false;
    let history = [], currentImage = null, dailyTokens = 15000, isPremium = false, isOnline = navigator.onLine;
    let userProfile = null;

    const els = {
      chatPane: document.getElementById('chatPane'), chatInput: document.getElementById('chatInput'),
      sendBtn: document.getElementById('sendBtn'), uploadBtn: document.getElementById('uploadBtn'),
      hiddenFile: document.getElementById('hiddenFile'), filePreview: document.getElementById('filePreview'),
      docPreview: document.getElementById('docPreview'), tokenCount: document.getElementById('tokenCount'),
      offlineNotice: document.getElementById('offlineNotice'), upgradeSheet: document.getElementById('upgradeSheet'),
      payNowBtn: document.getElementById('payNowBtn'), paperSheet: document.getElementById('paperSheet'),
      generatePaperBtn: document.getElementById('generatePaperBtn'), subjectSelect: document.getElementById('subjectSelect'),
      topicInput: document.getElementById('topicInput')
    };

    window.addEventListener('online', () => { isOnline = true; els.offlineNotice.style.display = 'none'; customAlert("Back online!"); });
    window.addEventListener('offline', () => { isOnline = false; els.offlineNotice.style.display = 'block'; });

    function customAlert(msg, duration = 2500) {
      const box = document.getElementById('customAlert');
      box.textContent = msg; box.classList.add('show');
      setTimeout(() => box.classList.remove('show'), duration);
    }

    function formatTime() { return new Date().toLocaleTimeString('en-ZA', { hour: '2-digit', minute: '2-digit' }); }
    function estimateTokens(t) { return Math.ceil((t?.length || 0) / 3.8) + 150; }

    async function deductTokens(amount) {
      if (isPremium) return true;
      if (dailyTokens < amount) { els.upgradeSheet.classList.add('active'); return false; }
      dailyTokens -= amount; els.tokenCount.textContent = dailyTokens.toLocaleString();
      if (isOnline) await set(ref(db, `users/${auth.currentUser.uid}/tokens`), { daily: dailyTokens, lastReset: Date.now() });
      return true;
    }

    async function loadTokens() {
  if (!auth.currentUser) return;

  try {
    const tokensRef = ref(db, `users/${auth.currentUser.uid}/tokens`);
    const snap = await get(tokensRef);
    const data = snap.val();
    const now = Date.now();
    const oneDay = 24 * 60 * 60 * 1000; // 24 hours in ms

    // Check if user is premium
    const userSnap = await get(ref(db, `users/${auth.currentUser.uid}`));
    if (userSnap.val()?.premium) {
      isPremium = true;
      dailyTokens = 999999;
      document.querySelector('.token-bar').innerHTML = `<div class="flex items-center justify-center gap-3"><span>Unlimited • Premium</span></div>`;
      els.tokenCount.textContent = 'Unlimited';
      return;
    }

    // Auto reset logic — works even if app was closed for weeks
    if (!data || !data.lastReset || (now - Number(data.lastReset)) > oneDay) {
      dailyTokens = 15000;
      await set(tokensRef, {
        daily: dailyTokens,
        lastReset: now
      });
      customAlert("Tokens reset to 15,000!");
    } else {
      dailyTokens = data.daily || 15000;
    }

    els.tokenCount.textContent = dailyTokens.toLocaleString();

  } catch (err) {
    console.error("Token load failed:", err);
    dailyTokens = 15000;
    els.tokenCount.textContent = dailyTokens.toLocaleString();
  }
}
    // Yoco Payment
    async function startPayment() {
      if (!yocoEnabled) return customAlert("Payment coming soon!");
      await loadYoco();
      const yoco = new window.YocoSDK({ publicKey: yocoKey });
      const result = await yoco.showPopup({
        amountInCents: 7900, currency: 'ZAR', name: 'Vynix Buddy Unlimited',
        description: 'R79/month – Unlimited AI tutoring',
        metadata: { userId: auth.currentUser.uid }
      });
      if (result?.paymentResult?.status === 'successful') {
        await update(ref(db, `users/${auth.currentUser.uid}`), { premium: true });
        isPremium = true; loadTokens(); els.upgradeSheet.classList.remove('active');
        customAlert("Welcome to Unlimited!");
      }
    }
    function loadYoco() {
      if (window.YocoSDK) return Promise.resolve();
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = 'https://js.yoco.com/sdk/v1/yoco-sdk-web.js';
        s.onload = res; s.onerror = rej; document.head.appendChild(s);
      });
    }

    // Question Paper Generator
    async function generatePaper() {
      const subject = els.subjectSelect.value;
      const topic = els.topicInput.value.trim();
      if (!topic) return customAlert("Enter a topic");
      els.paperSheet.classList.remove('active');
      addThinking();

      const prompt = `Generate a CAPS Grade ${userProfile?.grade || 12} ${subject} exam paper on "${topic}". 
      Exactly 5 tough questions, 10 marks each. Include full memorandum with detailed solutions. 
      Format: COVER → QUESTIONS → ---MEMO--- → MEMORANDUM`;

      const cost = 2500;
      if (!(await deductTokens(cost))) { removeThinking(); return; }

      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST", headers: { "Authorization": `Bearer ${xaiKey}`, "Content-Type": "application/json" },
          body: JSON.stringify({
            model: "grok-4-1-fast-non-reasoning",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7, max_tokens: 8000
          })
        });
        const data = await res.json();
        const text = data.choices?.[0]?.message?.content || "Failed";
        removeThinking();
        const [qp, memo] = text.split("---MEMO---");
        const doc = new jsPDF();
        doc.setFontSize(20); doc.text("VYNIX BUDDY CAPS PAPER", 105, 30, { align: "center" });
        doc.setFontSize(14); doc.text(`${subject} • Grade ${userProfile?.grade || 12} • ${topic}`, 105, 50, { align: "center" });
        doc.addPage(); doc.setFontSize(12); doc.text(qp || "No questions", 15, 20);
        if (memo) { doc.addPage(); doc.text("MEMORANDUM", 105, 20, { align: "center" }); doc.text(memo.trim(), 15, 40); }
        doc.save(`CAPS_${subject}_${topic}.pdf`);
        customAlert("Paper downloaded!");
      } catch { removeThinking(); customAlert("Failed – try again"); }
    }

    function addMessage(content, sender, plainText = '') {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      const time = formatTime();
      if (sender === 'ai') {
        div.innerHTML = `
          <div class="content">${marked.parse(content)}</div>
          <div class="ai-actions">
            <button class="action-btn copy-btn"><i data-lucide="copy"></i></button>
            <button class="action-btn voice-btn"><i data-lucide="volume-2"></i></button>
            <button class="action-btn pdf-btn"><i data-lucide="download"></i></button>
            <button class="action-btn paper-btn"><i data-lucide="file-text"></i></button>
          </div>
          <div class="timestamp">${time}</div>`;
      } else {
        div.innerHTML = `<div class="content">${content.includes('<img') ? content : content.replace(/\n/g, '<br>')}</div><div class="timestamp">${time}</div>`;
      }
      els.chatPane.appendChild(div); els.chatPane.scrollTop = els.chatPane.scrollHeight; lucide.createIcons();

      if (sender === 'ai') {
        div.querySelector('.copy-btn')?.addEventListener('click', () => { navigator.clipboard.writeText(plainText || content); customAlert("Copied!"); });
        div.querySelector('.voice-btn')?.addEventListener('click', async () => {
          if (!elevenlabsKey) return;
          const i = div.querySelector('.voice-btn i');
          i.setAttribute('data-lucide', 'loader-2'); lucide.createIcons();
          try {
            const res = await fetch("https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream", {
              method: "POST", headers: { "xi-api-key": elevenlabsKey.trim(), "Content-Type": "application/json" },
              body: JSON.stringify({ text: (plainText || content).slice(0,4990), model_id: "eleven_multilingual_v2" })
            });
            const audio = new Audio(URL.createObjectURL(await res.blob()));
            audio.play(); audio.onended = () => { i.setAttribute('data-lucide', 'volume-2'); lucide.createIcons(); };
          } catch { i.setAttribute('data-lucide', 'volume-2'); lucide.createIcons(); }
        });
        div.querySelector('.pdf-btn')?.addEventListener('click', () => {
          const doc = new jsPDF(); doc.text("Vynix Answer", 20, 20);
          doc.text(doc.splitTextToSize((plainText || content).replace(/[#*`>]/g, ''), 170), 20, 35);
          doc.save("Answer.pdf");
        });
        div.querySelector('.paper-btn')?.addEventListener('click', () => els.paperSheet.classList.add('active'));
      }
    }

    function addThinking() {
      const d = document.createElement('div'); d.id = 'thinking'; d.className = 'message ai';
      d.innerHTML = `<div class="content"><div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
      els.chatPane.appendChild(d); els.chatPane.scrollTop = els.chatPane.scrollHeight;
    }
    function removeThinking() { document.getElementById('thinking')?.remove(); }

    async function send() {
      let text = els.chatInput.value.trim();
      if (!text && !currentImage) return;
      const cost = currentImage ? 1500 : estimateTokens(text);
      if (!(await deductTokens(cost))) return;

      const userContent = currentImage ? [{ type: "text", text: text || "Explain this." }, { type: "image_url", image_url: { url: currentImage } }] : text;
      if (currentImage) addMessage(`<img src="${currentImage}" class="rounded-lg max-w-full">`, 'user');
      else addMessage(text, 'user');
      history.push({ role: "user", content: userContent });
      els.chatInput.value = ''; hidePreview(); addThinking();

      const model = currentImage ? "grok-2-vision-1212" : "grok-4-1-fast-non-reasoning";
      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST", headers: { "Authorization": `Bearer ${xaiKey}`, "Content-Type": "application/json" },
          body: JSON.stringify({
            model, messages: [{ role: "system", content: "You are Vynix Buddy, a warm CAPS tutor. Be encouraging." }, ...history.slice(-15)],
            temperature: 0.7, max_tokens: 4000
          })
        });
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || "Thinking...";
        removeThinking(); addMessage(reply, 'ai', reply);
        history.push({ role: "assistant", content: reply });
      } catch { removeThinking(); addMessage("No connection", 'ai'); }
    }

    function hidePreview() { els.filePreview.style.display = els.docPreview.style.display = 'none'; currentImage = null; }

    els.uploadBtn.onclick = () => els.hiddenFile.click();
    els.hiddenFile.onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      if (file.type.startsWith('image/')) { els.filePreview.src = url; els.filePreview.style.display = 'block'; }
      else els.docPreview.style.display = 'flex';
      currentImage = url; els.sendBtn.disabled = false;
    };

    els.chatInput.addEventListener('input', () => {
      els.chatInput.style.height = 'auto'; els.chatInput.style.height = els.chatInput.scrollHeight + 'px';
      els.sendBtn.disabled = !els.chatInput.value.trim() && !currentImage;
    });
    els.sendBtn.onclick = send;
    els.chatInput.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } });

    // Buttons
    document.getElementById('upgradePill').onclick = () => els.upgradeSheet.classList.add('active');
    els.payNowBtn.onclick = startPayment;
    els.generatePaperBtn.onclick = generatePaper;

    // Init
    async function init() {
      const rc = getRemoteConfig(app);
      await fetchAndActivate(rc);
      xaiKey = getString(rc, 'xai_api_key')?.trim();
      elevenlabsKey = getString(rc, 'elevenlabs_api_key')?.trim();
      yocoKey = getString(rc, 'yoco_public_key')?.trim();
      yocoEnabled = getBoolean(rc, 'yoco_enabled');
    }

    onAuthStateChanged(auth, async user => {
      if (!user) { location.href = "login.html"; return; }
      await init(); await loadTokens();
      const profileSnap = await get(child(ref(db), `users/${user.uid}/profile`));
      userProfile = profileSnap.val() || { grade: 12 };
      addMessage(`Sawubona ${userProfile.name || ""}! Ready for Grade ${userProfile.grade}?`, 'ai');
    });

    // Sign Out Button
// Sign Out Button – using your customAlert for confirmation
document.getElementById('signOutBtn')?.addEventListener('click', async () => {
  // Show custom confirmation alert
  customAlert('Sign out now?', 5000); // stays visible longer

  // Create temporary Yes/No buttons overlay
  const overlay = document.createElement('div');
  overlay.className = 'fixed inset-0 bg-black/50 z-[9998] flex items-center justify-center';
  overlay.innerHTML = `
    <div class="bg-white rounded-2xl p-6 max-w-xs w-full mx-4 shadow-2xl">
      <p class="text-lg font-semibold mb-6 text-center">Sign out of Vynix Buddy?</p>
      <div class="flex gap-3 justify-center">
        <button id="confirmNo" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-xl font-medium active:scale-95">
          Cancel
        </button>
        <button id="confirmYes" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium active:scale-95">
          Sign Out
        </button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);

  // Handle responses
  overlay.querySelector('#confirmNo').onclick = () => overlay.remove();
  overlay.querySelector('#confirmYes').onclick = async () => {
    overlay.remove();
    customAlert('Signing you out...');
    try {
      await auth.signOut();
      customAlert('Signed out successfully!');
      setTimeout(() => location.href = 'login.html', 1200);
    } catch (err) {
      customAlert('Sign out failed');
      console.error(err);
    }
  };
});
  </script>
</body>
</html>
