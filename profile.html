<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Professional Portfolio - Vynix</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FIXED: Removed trailing spaces -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --bg: #f8f9fa;
      --card-bg: #ffffff;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --border: #e9ecef;
      --accent: #ff2a6d;
      --accent-light: rgba(255, 42, 109, 0.1);
      --success: #28a745;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
      --gradient: linear-gradient(135deg, #ff2a6d, #05d9e8);
    }
    body.dark {
      --bg: #121212;
      --card-bg: #1e1e1e;
      --text-primary: #e9ecef;
      --text-secondary: #adb5bd;
      --border: #343a40;
      --accent-light: rgba(255, 42, 109, 0.15);
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      -webkit-user-select: none;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    input, textarea, button {
      -webkit-user-select: text;
      user-select: text;
    }
    .header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: var(--card-bg);
      z-index: 100;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      box-shadow: var(--shadow);
    }
    .back-btn {
      background: none; border: none;
      color: var(--text-primary);
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
    }
    .share-btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(255,42,109,0.3);
    }
    .hero-section {
      padding-top: 84px;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .profile-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 32px;
      padding: 40px 0;
    }
    .avatar-wrapper {
      position: relative;
      flex-shrink: 0;
    }
    .profile-avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    .edit-avatar-overlay {
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--accent);
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .profile-info {
      flex: 1;
      min-width: 200px;
    }
    .name-input {
      font-size: 32px;
      font-weight: 700;
      border: none;
      background: transparent;
      color: var(--text-primary);
      width: 100%;
      margin-bottom: 8px;
      padding: 4px;
    }
    .name-input:disabled {
      border: none !important;
    }
    .professional-title-input {
      font-size: 18px;
      color: var(--text-secondary);
      border: none;
      background: transparent;
      width: 100%;
      margin-bottom: 16px;
      padding: 4px;
    }
    .verified-badge-inline {
      color: var(--accent);
      font-size: 24px;
      vertical-align: middle;
      margin-left: 8px;
    }
    .location-input {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }
    .location-input input {
      border: none;
      background: transparent;
      color: var(--text-secondary);
      flex: 1;
    }
    .social-links {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .social-input {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--accent-light);
      border-radius: 20px;
      border: 1px solid var(--border);
    }
    .social-input input {
      border: none;
      background: transparent;
      color: var(--text-primary);
      width: 140px;
    }
    .add-social-btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
    }
    .section-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .section-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .edit-toggle {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 16px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .bio-textarea {
      width: 100%;
      min-height: 120px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      background: var(--bg);
      color: var(--text-primary);
      font-size: 16px;
      line-height: 1.6;
      resize: vertical;
    }
    .tag-input-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .skill-tag {
      background: var(--accent-light);
      border: 1px solid var(--accent);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .skill-tag .remove {
      cursor: pointer;
      font-size: 16px;
    }
    .add-skill-input {
      border: 1px dashed var(--border);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      background: transparent;
      color: var(--text-primary);
      min-width: 120px;
    }
    .experience-item, .project-item, .education-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      background: var(--bg);
    }
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 8px;
    }
    .item-title-input, .item-company-input, .item-school-input {
      font-weight: 600;
      font-size: 16px;
      border: none;
      background: transparent;
      color: var(--text-primary);
      flex: 1;
    }
    .item-date-input {
      font-size: 13px;
      color: var(--text-secondary);
      border: none;
      background: transparent;
    }
    .item-description-input {
      width: 100%;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
      resize: vertical;
      min-height: 60px;
    }
    .add-item-btn {
      width: 100%;
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 16px;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    .add-item-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      cursor: pointer;
      font-size: 16px;
      flex-shrink: 0;
    }
    .download-resume-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
      z-index: 50;
    }
    .share-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      backdrop-filter: blur(4px);
    }
    .share-modal.active {
      display: flex;
    }
    .share-content {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
    }
    @media (max-width: 768px) {
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      .name-input {
        font-size: 24px;
      }
      .container {
        padding: 0 16px;
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <button class="back-btn material-icons" onclick="history.back()">arrow_back</button>
    <button class="share-btn" id="share-btn">
      <span class="material-icons" style="font-size: 18px;">share</span>
      Share
    </button>
  </header>

  <div class="hero-section">
    <div class="container">
      <div class="profile-header">
        <div class="avatar-wrapper">
          <img class="profile-avatar" id="profile-avatar" src="" alt="Profile">
          <button class="edit-avatar-overlay material-icons" id="edit-avatar-btn">edit</button>
        </div>
        <div class="profile-info">
          <input type="text" class="name-input" id="name-input" placeholder="Your Name" disabled>
          <input type="text" class="professional-title-input" id="title-input" placeholder="e.g. Senior Software Engineer" disabled>
          <div class="location-input">
            <span class="material-icons" style="font-size: 20px;">location_on</span>
            <input type="text" id="location-input" placeholder="City, Country" disabled>
          </div>
          <div class="social-links" id="social-links"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="padding-bottom: 100px;">
    
    <!-- About Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">person</span>
          About
        </div>
        <button class="edit-toggle" id="edit-about-btn">Edit</button>
      </div>
      <textarea class="bio-textarea" id="bio-textarea" placeholder="Write a professional summary about yourself..." disabled></textarea>
    </div>

    <!-- Skills Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">build</span>
          Skills
        </div>
        <button class="edit-toggle" id="edit-skills-btn">Edit</button>
      </div>
      <div class="tag-input-container" id="skills-container"></div>
    </div>

    <!-- Experience Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">work</span>
          Experience
        </div>
        <button class="edit-toggle" id="edit-experience-btn">Edit</button>
      </div>
      <div id="experience-container"></div>
    </div>

    <!-- Projects Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">folder</span>
          Projects
        </div>
        <button class="edit-toggle" id="edit-projects-btn">Edit</button>
      </div>
      <div id="projects-container"></div>
    </div>

    <!-- Education Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">school</span>
          Education
        </div>
        <button class="edit-toggle" id="edit-education-btn">Edit</button>
      </div>
      <div id="education-container"></div>
    </div>

    <!-- Contact Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">
          <span class="material-icons">mail</span>
          Contact
        </div>
        <button class="edit-toggle" id="edit-contact-btn">Edit</button>
      </div>
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <input type="email" class="item-description-input" id="contact-email" placeholder="Professional Email" disabled>
        <input type="tel" class="item-description-input" id="contact-phone" placeholder="Phone Number" disabled>
        <input type="url" class="item-description-input" id="contact-website" placeholder="Portfolio Website" disabled>
      </div>
    </div>

  </div>

  <button class="download-resume-btn material-icons" id="download-btn" title="Download Resume">download</button>

  <!-- Share Modal -->
  <div class="share-modal" id="share-modal">
    <div class="share-content">
      <h3 style="margin-bottom: 16px; font-size: 18px;">Share Portfolio</h3>
      <div style="display: flex; gap: 12px; margin-bottom: 16px;">
        <input type="text" id="share-link-input" readonly style="flex: 1; padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text-primary);">
        <button class="share-btn" id="copy-link-btn">Copy</button>
      </div>
      <div style="display: flex; justify-content: space-between;">
        <button class="modal-btn cancel" id="close-share-btn">Close</button>
        <button class="modal-btn save" id="public-view-btn">Public View</button>
      </div>
    </div>
  </div>

  <script type="module">
    // FIXED: Removed trailing spaces
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getDatabase, ref, onValue, update, set } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      // FIXED: Removed space in database URL
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const storage = getStorage(app);

    let currentUser = null;
    let isEditMode = false;
    let portfolioData = {
      name: '',
      title: '',
      location: '',
      bio: '',
      skills: [],
      experience: [],
      projects: [],
      education: [],
      contact: { email: '', phone: '', website: '' },
      social: []
    };

    const showAlert = (msg) => {
      const el = document.createElement('div');
      el.textContent = msg;
      el.style.cssText = `position:fixed;top:20px;right:20px;background:var(--card-bg);color:var(--text-primary);padding:12px 20px;border-radius:20px;border:1px solid var(--border);z-index:1000;transition:transform 0.3s;transform:translateX(120%);`;
      document.body.appendChild(el);
      setTimeout(() => el.style.transform = 'translateX(0)', 10);
      setTimeout(() => el.remove(), 3000);
    };

    // Load portfolio data
    const loadPortfolio = async (userId) => {
      const portfolioRef = ref(db, `portfolios/${userId}`);
      onValue(portfolioRef, (snap) => {
        if (snap.exists()) {
          portfolioData = { ...portfolioData, ...snap.val() };
        } else {
          // Initialize with user data
          portfolioData.name = currentUser.displayName || '';
          portfolioData.contact.email = currentUser.email || '';
        }
        renderPortfolio();
      });
    };

    // Render all sections
    const renderPortfolio = () => {
      document.getElementById('name-input').value = portfolioData.name;
      document.getElementById('title-input').value = portfolioData.title || '';
      document.getElementById('location-input').value = portfolioData.location || '';
      document.getElementById('bio-textarea').value = portfolioData.bio || '';
      
      // Contact
      document.getElementById('contact-email').value = portfolioData.contact.email || '';
      document.getElementById('contact-phone').value = portfolioData.contact.phone || '';
      document.getElementById('contact-website').value = portfolioData.contact.website || '';
      
      // Avatar
      const avatarEl = document.getElementById('profile-avatar');
      avatarEl.src = currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(portfolioData.name || 'U')}&background=ff2a6d&color=fff`;

      renderSkills();
      renderExperience();
      renderProjects();
      renderEducation();
      renderSocialLinks();
    };

    // Skills
    const renderSkills = () => {
      const container = document.getElementById('skills-container');
      container.innerHTML = '';
      portfolioData.skills.forEach((skill, index) => {
        const tag = document.createElement('div');
        tag.className = 'skill-tag';
        tag.innerHTML = `
          ${skill}
          ${isEditMode ? `<span class="remove" onclick="removeSkill(${index})">&times;</span>` : ''}
        `;
        container.appendChild(tag);
      });
      if (isEditMode) {
        const input = document.createElement('input');
        input.className = 'add-skill-input';
        input.placeholder = '+ Add skill';
        input.onkeypress = (e) => {
          if (e.key === 'Enter' && e.target.value.trim()) {
            addSkill(e.target.value.trim());
            e.target.value = '';
          }
        };
        container.appendChild(input);
      }
    };

    window.addSkill = (skill) => {
      if (!portfolioData.skills.includes(skill)) {
        portfolioData.skills.push(skill);
        savePortfolio();
      }
    };

    window.removeSkill = (index) => {
      portfolioData.skills.splice(index, 1);
      savePortfolio();
    };

    // Dynamic list renderer (experience, projects, education)
    const renderList = (key, containerId, itemTemplate) => {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      portfolioData[key].forEach((item, index) => {
        const div = document.createElement('div');
        div.className = key === 'projects' ? 'project-item' : 'experience-item';
        div.innerHTML = itemTemplate(item, index, key);
        container.appendChild(div);
      });
      if (isEditMode) {
        const btn = document.createElement('button');
        btn.className = 'add-item-btn';
        btn.textContent = `+ Add ${key.slice(0, -1)}`;
        btn.onclick = () => addNewItem(key);
        container.appendChild(btn);
      }
    };

    const renderExperience = () => {
      renderList('experience', 'experience-container', (item, index) => `
        <div class="item-header">
          <input type="text" class="item-title-input" value="${item.title || ''}" placeholder="Job Title" ${!isEditMode ? 'disabled' : ''} data-field="title" data-index="${index}" data-key="experience">
          ${isEditMode ? `<button class="delete-btn" onclick="deleteItem('experience', ${index})">×</button>` : ''}
        </div>
        <input type="text" class="item-company-input" value="${item.company || ''}" placeholder="Company" ${!isEditMode ? 'disabled' : ''} data-field="company" data-index="${index}" data-key="experience">
        <input type="text" class="item-date-input" value="${item.duration || ''}" placeholder="Jan 2020 - Present" ${!isEditMode ? 'disabled' : ''} data-field="duration" data-index="${index}" data-key="experience">
        <textarea class="item-description-input" ${!isEditMode ? 'disabled' : ''} data-field="description" data-index="${index}" data-key="experience" placeholder="Describe your role and achievements...">${item.description || ''}</textarea>
      `);
    };

    const renderProjects = () => {
      renderList('projects', 'projects-container', (item, index) => `
        <div class="item-header">
          <input type="text" class="item-title-input" value="${item.name || ''}" placeholder="Project Name" ${!isEditMode ? 'disabled' : ''} data-field="name" data-index="${index}" data-key="projects">
          ${isEditMode ? `<button class="delete-btn" onclick="deleteItem('projects', ${index})">×</button>` : ''}
        </div>
        <input type="url" class="item-company-input" value="${item.url || ''}" placeholder="https://project.com" ${!isEditMode ? 'disabled' : ''} data-field="url" data-index="${index}" data-key="projects">
        <textarea class="item-description-input" ${!isEditMode ? 'disabled' : ''} data-field="description" data-index="${index}" data-key="projects" placeholder="Project description and technologies used...">${item.description || ''}</textarea>
      `);
    };

    const renderEducation = () => {
      renderList('education', 'education-container', (item, index) => `
        <div class="item-header">
          <input type="text" class="item-title-input" value="${item.degree || ''}" placeholder="Degree" ${!isEditMode ? 'disabled' : ''} data-field="degree" data-index="${index}" data-key="education">
          ${isEditMode ? `<button class="delete-btn" onclick="deleteItem('education', ${index})">×</button>` : ''}
        </div>
        <input type="text" class="item-company-input" value="${item.school || ''}" placeholder="School/University" ${!isEditMode ? 'disabled' : ''} data-field="school" data-index="${index}" data-key="education">
        <input type="text" class="item-date-input" value="${item.year || ''}" placeholder="2016 - 2020" ${!isEditMode ? 'disabled' : ''} data-field="year" data-index="${index}" data-key="education">
      `);
    };

    // Social links
    const renderSocialLinks = () => {
      const container = document.getElementById('social-links');
      container.innerHTML = '';
      const platforms = ['LinkedIn', 'GitHub', 'Twitter', 'Portfolio'];
      platforms.forEach(platform => {
        const input = document.createElement('div');
        input.className = 'social-input';
        input.innerHTML = `
          <span class="material-icons" style="font-size:16px;">${platform.toLowerCase()}</span>
          <input type="url" placeholder="${platform} URL" value="${portfolioData.social[platform] || ''}" ${!isEditMode ? 'disabled' : ''} data-platform="${platform}">
        `;
        container.appendChild(input);
      });
    };

    // Add new item to list
    window.addNewItem = (key) => {
      const newItem = key === 'experience' ? 
        { title: '', company: '', duration: '', description: '' } :
        key === 'projects' ? 
        { name: '', url: '', description: '' } :
        { degree: '', school: '', year: '' };
      portfolioData[key].push(newItem);
      savePortfolio();
    };

    window.deleteItem = (key, index) => {
      portfolioData[key].splice(index, 1);
      savePortfolio();
    };

    // Save portfolio to Firebase
    const savePortfolio = () => {
      update(ref(db, `portfolios/${currentUser.uid}`), portfolioData);
      showAlert('Portfolio updated successfully!');
    };

    // Edit mode toggles
    document.querySelectorAll('.edit-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const section = btn.id.replace('edit-', '').replace('-btn', '');
        isEditMode = !isEditMode;
        btn.textContent = isEditMode ? 'Done' : 'Edit';
        document.querySelectorAll(`#${section}-container input, #${section}-container textarea, #bio-textarea`).forEach(el => {
          el.disabled = !isEditMode;
        });
        renderPortfolio();
      });
    });

    // Auto-save on input change
    document.addEventListener('input', (e) => {
      if (e.target.dataset.field) {
        const { field, index, key } = e.target.dataset;
        portfolioData[key][index][field] = e.target.value;
      } else if (e.target.id === 'name-input') {
        portfolioData.name = e.target.value;
      } else if (e.target.id === 'title-input') {
        portfolioData.title = e.target.value;
      } else if (e.target.id === 'location-input') {
        portfolioData.location = e.target.value;
      } else if (e.target.id === 'bio-textarea') {
        portfolioData.bio = e.target.value;
      } else if (e.target.dataset.platform) {
        portfolioData.social[e.target.dataset.platform] = e.target.value;
      } else if (e.target.id.startsWith('contact-')) {
        const field = e.target.id.replace('contact-', '');
        portfolioData.contact[field] = e.target.value;
      }
    });

    // Debounced save
    let saveTimeout;
    document.addEventListener('input', () => {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(savePortfolio, 1000);
    });

    // Avatar upload
    document.getElementById('edit-avatar-btn').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try {
          const fileRef = storageRef(storage, `profilePictures/${currentUser.uid}`);
          await uploadBytes(fileRef, file);
          const url = await getDownloadURL(fileRef);
          await update(ref(db, `users/${currentUser.uid}`), { photoURL: url });
          await update(ref(db, `portfolios/${currentUser.uid}`), { photoURL: url });
          showAlert('Profile picture updated!');
        } catch (err) {
          console.error(err);
          showAlert('Upload failed');
        }
      };
      input.click();
    });

    // Share functionality
    document.getElementById('share-btn').addEventListener('click', () => {
      const shareUrl = `${window.location.origin}/portfolio.html?user=${currentUser.uid}`;
      document.getElementById('share-link-input').value = shareUrl;
      document.getElementById('share-modal').classList.add('active');
    });

    document.getElementById('close-share-btn').addEventListener('click', () => {
      document.getElementById('share-modal').classList.remove('active');
    });

    document.getElementById('copy-link-btn').addEventListener('click', () => {
      navigator.clipboard.writeText(document.getElementById('share-link-input').value);
      showAlert('Link copied to clipboard!');
    });

    document.getElementById('public-view-btn').addEventListener('click', () => {
      window.open(`portfolio.html?user=${currentUser.uid}`, '_blank');
    });

    // Download resume (placeholder)
    document.getElementById('download-btn').addEventListener('click', () => {
      showAlert('Resume download feature coming soon!');
    });

    // Auth state
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        location.href = 'login.html';
        return;
      }
      currentUser = user;
      loadPortfolio(user.uid);
    });
  </script>

</body>
</html>
