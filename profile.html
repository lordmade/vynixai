<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Vynix â€“ Profile</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVnluaXgiLCJzaG9ydF9uYW1lIjoiVnluaXgiLCJkZXNjcmlwdGlvbiI6IkNvbm5lY3Qgd2l0aCBmcmllbmRzIC0gZmFzdCwgYmVhdXRpZnVsLCBwcml2YXRlIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNkOTQ2ZWYiLCJ0aGVtZV9jb2xvciI6IiNkOTQ2ZWYiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0LXByaW1hcnkiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9pLnBvc3RpbWcuY2MvSzhZV0tHMHovR2VtaW5pLUdlbmVyYXRlZC1JbWFnZS1qNHpuMGpqNHpuMGpqNHpuLTEtcmVtb3ZlYmctcHJldmlldy5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9LHsic3JjIjoiaHR0cHM6Ly9pLnBvc3RpbWcuY2MvSzhZV0tHMHovR2VtaW5pLUdlbmVyYXRlZC1JbWFnZS1qNHpuMGpqNHpuMGpqNHpuLTEtcmVtb3ZlYmctcHJldmlldy5wbmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
  <meta name="theme-color" content="#d946ef">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="https://i.postimg.cc/K8YWKG0z/Gemini-Generated-Image-j4zn0jj4zn0jj4zn-1-removebg-preview.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ---------- ROOT TOKENS (Facebook-like) ---------- */
    :root{
      --bg:#f0f2f5;
      --card:#ffffff;
      --text:#1c1e21;
      --text2:#65676b;
      --border:#ced0d4;
      --accent:#1877f2;
      --hover-accent:#f0f2f5;
      --card-shadow:0 1px 2px rgba(0,0,0,0.1);
      --radius:8px;
      --avatar:40px;
    }
    [data-theme="dark"]{
      --bg:#18191a;
      --card:#242526;
      --text:#e4e6eb;
      --text2:#b0b3b8;
      --border:#3e4042;
      --hover-accent:#3a3b3c;
      --card-shadow:0 1px 2px rgba(0,0,0,0.2);
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding-bottom:80px;
    }
    *{box-sizing:border-box;-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent}
    input,textarea{-webkit-user-select:auto;user-select:auto}

    /* ---------- FULL-PAGE SHIMMER ---------- */
    .shimmer-cover{
      position:fixed;
      inset:0;
      background:var(--bg);
      z-index:999;
      display:flex;
      flex-direction:column;
      gap:16px;
      padding:16px;
    }
    .shimmer-cover > div{
      background:linear-gradient(90deg,var(--border) 25%,rgba(0,0,0,.05) 50%,var(--border) 75%);
      background-size:200% 100%;
      animation:shimmer 1.5s infinite;
      border-radius:var(--radius);
    }
    @keyframes shimmer{to{background-position:-200% 0}}
    [data-theme="dark"] .shimmer-cover > div{background:linear-gradient(90deg,var(--border) 25%,rgba(255,255,255,.05) 50%,var(--border) 75%)}

    /* ---------- PROFILE HEADER ---------- */
    .cover-photo{width:100%;height:200px;object-fit:cover;border-radius:var(--radius) var(--radius) 0 0}
    .avatar-ring{width:120px;height:120px;border-radius:50%;border:4px solid var(--card);margin:-60px auto 0;overflow:hidden;background:var(--card)}
    .avatar-ring img{width:100%;height:100%;object-fit:cover}
    .profile-header{background:var(--card);box-shadow:var(--card-shadow);padding:20px 16px 16px;text-align:center}
    .profile-name{font-size:24px;font-weight:600;margin-top:12px}
    .profile-handle{font-size:15px;color:var(--text2)}
    .profile-bio{font-size:15px;max-width:600px;margin:8px auto 16px;line-height:1.4;white-space:pre-wrap}
    .profile-stats{display:flex;justify-content:center;gap:32px;margin:16px 0}
    .stat-number{font-size:18px;font-weight:700}
    .stat-label{font-size:14px;color:var(--text2)}
    .profile-actions{display:flex;justify-content:center;gap:12px;margin:16px 0}
    .btn-primary{background:var(--accent);color:#fff;border:none;border-radius:6px;padding:8px 20px;font-weight:600;cursor:pointer}
    .btn-secondary{background:var(--hover-accent);color:var(--text);border:none;border-radius:6px;padding:8px 20px;font-weight:600;cursor:pointer}

    /* ---------- POST CARD (copy-paste from feed.html) ---------- */
    .post-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--card-shadow);margin:0 auto 16px;max-width:680px;transition:.2s ease}
    .post-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .post-header{display:flex;align-items:center;gap:12px;padding:16px 16px 12px}
    .post-avatar{width:var(--avatar);height:var(--avatar);border-radius:50%;object-fit:cover;flex-shrink:0}
    .user-info{flex:1}
    .user-name{font-size:15px;font-weight:600;color:var(--text);display:flex;align-items:center;gap:4px}
    .user-handle{font-size:13px;color:var(--text2)}
    .post-time{font-size:13px;color:var(--text2)}
    .verified-badge{color:var(--accent);font-size:16px!important}
    .post-content{padding:0 16px 12px;font-size:15px;line-height:1.5;color:var(--text);white-space:pre-wrap}
    .post-image,.post-video{width:100%;max-height:500px;object-fit:cover;margin:0;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
    .post-video{max-height:400px}
    .post-actions{display:flex;align-items:center;justify-content:space-around;padding:8px 16px;border-top:1px solid var(--border)}
    .action-item{display:flex;align-items:center;gap:6px;font-size:15px;color:var(--text2);cursor:pointer;padding:8px;border-radius:6px;transition:.2s ease;font-weight:500}
    .action-item:hover{background:var(--hover-accent)}
    .action-item svg{width:20px;height:20px;stroke-width:1.8}
    .action-item.liked{color:var(--accent)}
    .action-item.liked svg{fill:var(--accent)}
    .action-item.disabled{opacity:.5;pointer-events:none}
    .hidden{display:none}
    .text-center{text-align:center}
    .p-4{padding:16px}
    .text-gray{color:var(--text2)}

    /* ---------- NAV ---------- */
    nav{position:fixed;bottom:0;left:0;right:0;height:56px;background:var(--card);border-top:1px solid var(--border);z-index:40}
    nav a{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;color:var(--text2)}
    nav a.active{color:var(--accent)}
  </style>
</head>
<body>
  <!-- FULL-PAGE SHIMMER -->
  <div id="shimmer" class="shimmer-cover">
    <div style="height:200px"></div>
    <div style="height:120px;width:120px;margin:-60px auto 0;border-radius:50%"></div>
    <div style="height:24px;width:180px;margin:12px auto 4px"></div>
    <div style="height:16px;width:120px;margin:0 auto 12px"></div>
    <div style="height:40px;width:280px;margin:0 auto 16px"></div>
    <div style="height:16px;width:200px;margin:0 auto 24px"></div>
    <div style="height:120px"></div>
    <div style="height:120px"></div>
    <div style="height:120px"></div>
  </div>

  <!-- PROFILE HEADER -->
  <div id="profile-header" class="hidden">
    <img id="cover-photo" class="cover-photo" src="https://via.placeholder.com/680x200/1877f2/ffffff?text=Cover+Photo" alt="Cover">
    <div class="avatar-ring">
      <img id="profile-avatar" src="" alt="Avatar">
    </div>
    <div class="profile-header">
      <div class="profile-name" id="profile-name">Loading...</div>
      <div class="profile-handle" id="profile-handle">@loading</div>
      <p class="profile-bio" id="profile-bio"></p>
      <div class="profile-stats">
        <div class="stat-item"><div class="stat-number" id="stat-posts">0</div><div class="stat-label">Posts</div></div>
        <div class="stat-item"><div class="stat-number" id="stat-followers">0</div><div class="stat-label">Followers</div></div>
        <div class="stat-item"><div class="stat-number" id="stat-following">0</div><div class="stat-label">Following</div></div>
      </div>
      <div class="profile-actions" id="profile-actions"></div>
    </div>
  </div>

  <!-- POSTS FEED -->
  <main id="feed" class="p-4"></main>
  <div class="text-center p-4">
    <button id="load-more-btn" class="btn-primary hidden">Load More</button>
  </div>

  <!-- BOTTOM NAV -->
  <nav>
    <a href="feed.html"><span class="material-icons-outlined">home</span><span>Home</span></a>
    <a href="chat.html"><span class="material-icons-outlined">chat_bubble_outline</span><span>Chat</span></a>
    <a href="search.html"><span class="material-icons-outlined">search</span><span>Search</span></a>
    <a href="ai.html"><span class="material-icons-outlined">auto_awesome</span><span>AI</span></a>
    <a href="notifications.html"><span class="material-icons-outlined">notifications</span><span>Alerts</span></a>
    <a href="profile.html" class="active"><span class="material-icons">person</span><span>Profile</span></a>
  </nav>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
import { getAuth, onAuthStateChanged, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
import { getDatabase, ref, onValue, query, orderByChild, limitToLast, get, set, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
  authDomain: "fire-b-a8878.firebaseapp.com",
  databaseURL: "https://fire-b-a8878.firebaseio.com",
  projectId: "fire-b-a8878",
  storageBucket: "fire-b-a8878.firebasestorage.app",
  messagingSenderId: "658673187627",
  appId: "1:658673187627:web:6e4c29af661785f0afa36e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const urlParams = new URLSearchParams(location.search);
const profileUid = urlParams.get('uid') || null;
let currentUid = null;
let isOwner = false;
const POST_LIMIT = 10;
let lastTimestamp = null;

const $ = s => document.querySelector(s);
const feedEl = $('#feed');
const loadMoreBtn = $('#load-more-btn');

if (window.matchMedia?.('(prefers-color-scheme: dark)')?.matches)
  document.body.setAttribute('data-theme', 'dark');

onAuthStateChanged(auth, user => {
  if (!user) {
    signInAnonymously(auth).catch(console.error);
  } else {
    currentUid = user.uid;
    isOwner = !profileUid || profileUid === currentUid;
    loadProfile();
    loadPosts();
  }
});

async function loadProfile() {
  const uid = profileUid || currentUid;
  onValue(ref(db, `users/${uid}/profile`), snap => {
    const p = snap.val() || {};
    $('#profile-avatar').src = p.avatar || `https://ui-avatars.com/api/?background=1877f2&color=fff&name=${encodeURIComponent(p.displayName || 'User')}`;
    $('#profile-name').textContent = p.displayName || 'User';
    $('#profile-handle').textContent = '@' + (p.handle || uid.slice(0, 8));
    $('#profile-bio').textContent = p.bio || 'No bio yet.';
    $('#cover-photo').src = p.cover || 'https://via.placeholder.com/680x200/1877f2/ffffff?text=Cover+Photo';
    $('#profile-actions').innerHTML = isOwner
      ? '<button class="btn-secondary" onclick="openEditModal()">Edit Profile</button>'
      : '<button class="btn-primary">Follow</button><button class="btn-secondary">Message</button>';
  });

  onValue(ref(db, `posts`), snap => {
    let c = 0; snap.forEach(ch => { if (ch.val().authorId === uid) c++; });
    $('#stat-posts').textContent = c;
  });
  onValue(ref(db, `followers/${uid}`), s => $('#stat-followers').textContent = s.size);
  onValue(ref(db, `following/${uid}`), s => $('#stat-following').textContent = s.size);

  $('#shimmer').classList.add('hidden');
  $('#profile-header').classList.remove('hidden');
}

async function loadPosts() {
  const uid = profileUid || currentUid;
  const q = query(ref(db, 'posts'), orderByChild('timestamp'), limitToLast(POST_LIMIT * 2));
  const snap = await get(q);
  const rows = [];
  snap.forEach(c => { if (c.val().authorId === uid) rows.unshift({key: c.key, ...c.val()}); });
  feedEl.innerHTML = '';
  if (!rows.length) {
    feedEl.innerHTML = '<div class="text-center p-8 text-gray-500">No posts yet.</div>';
    return;
  }
  rows.forEach(p => feedEl.appendChild(renderPostCard(p)));
  lastTimestamp = rows[rows.length - 1]?.timestamp;
  loadMoreBtn.classList.toggle('hidden', rows.length < POST_LIMIT);
}

loadMoreBtn.onclick = async () => {
  toast('No more posts');
  loadMoreBtn.classList.add('hidden');
};

function renderPostCard(p) {
  const div = document.createElement('div');
  div.className = 'post-card';
  div.id = `post-${p.key}`;
  div.innerHTML = `
    <div class="post-header">
      <img src="${p.authorAvatar}" class="post-avatar">
      <div class="user-info">
        <div class="user-name"><span class="name">${esc(p.authorName)}</span></div>
        <div class="post-time">${timeAgo(p.timestamp || Date.now())}</div>
      </div>
    </div>
    <div class="post-content">${linkify(esc(p.text || ''))}</div>
    ${p.image ? `<img class="post-image" src="${p.image}" loading="lazy">` : ''}
    <div class="post-actions">
      <div class="action-item like"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg><span>${p.likes||0}</span></div>
      <div class="action-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg><span>${p.replies||0}</span></div>
      <div class="action-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2l4 4-4 4M3 11v-1a4 4 0 0 1 4-4h14M7 22l-4-4 4-4M21 13v1a4 4 0 0 1-4 4H3"/></svg><span>${p.reposts||0}</span></div>
      <div class="action-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></div>
    </div>`;
  return div;
}

function esc(s) { return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function timeAgo(ts) {
  const s = Math.floor((Date.now() - ts) / 1000);
  return s < 60 ? `${s}s` : s < 3600 ? `${Math.floor(s/60)}m` : s < 86400 ? `${Math.floor(s/3600)}h` : `${Math.floor(s/86400)}d`;
}

function linkify(str) {
  str = str.replace(/#(\w+)/g, '<a href="search.html?q=%23$1" class="text-[#1877f2] font-medium">#$1</a>');
  str = str.replace(/@(\w+)/g, '<a href="profile.html?handle=$1" class="text-[#1877f2] font-medium">@$1</a>');
  str = str.replace(/(https?:\/\/|www\.)([^\s<]+)/gi, m => {
    const href = m.startsWith('www') ? 'https://' + m : m;
    return `<a href="${href}" target="_blank" rel="noopener" class="text-[#1877f2] font-medium">${m}</a>`;
  });
  return str;
}

function toast(msg) {
  const t = document.createElement('div');
  t.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-[#1877f2] text-white px-4 py-2 rounded-full shadow-lg text-sm font-semibold';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

window.openEditModal = () => toast('Edit modal coming soon!');
</script>
</body>
</html>
