<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ffffff">
  <title>Vynix Lingua ‚Äì Multilingual African AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">
 <style>
  :root {
    --bg-color: #ffffff;
    --surface-color: #f4f6f8;
    --text-primary: #1a1a1a;
    --text-secondary: #5f6368;
    --text-muted: #9aa0a6;
    --accent-color: #2563eb;
    --logo-gradient: linear-gradient(135deg, #2563eb 0%, #d946ef 100%);
    --input-bg: #f0f2f5;
    --shadow-soft: 0 4px 20px rgba(0,0,0,0.06);
    --font-main: 'Outfit', sans-serif;
    --font-mono: 'Roboto Mono', monospace;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    margin: 0;
    font-family: var(--font-main);
    background: var(--bg-color);
    color: var(--text-primary);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    user-select: none;
  }
  .header {
    height: 64px;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    z-index: 10;
    border-bottom: 1px solid rgba(0,0,0,0.03);
  }
  .header-left { display: flex; align-items: center; gap: 12px; }
  .vynix-logo {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 12px;
    transition: transform 0.2s;
  }
  .vynix-logo:active { transform: scale(0.96); }
  .logo-icon {
    font-size: 26px;
    background: var(--logo-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-variation-settings: 'FILL' 1, 'wght' 600;
  }
  .logo-text {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
    color: #1a1a1a;
  }
  .lingua-badge {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .lang-selector {
    position: relative;
    margin-left: auto;
    margin-right: 12px;
  }
  .lang-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: var(--surface-color);
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
    transition: background 0.2s;
  }
  .lang-btn:hover { background: #e0e0e0; }
  .lang-btn span { font-size: 18px; }
  .lang-dropdown {
    position: absolute;
    top: 48px;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    padding: 8px;
    min-width: 240px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    z-index: 100;
  }
  .lang-dropdown.open { display: block; }
  .lang-option {
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
  }
  .lang-option:hover { background: var(--surface-color); }
  .lang-option.active { background: var(--accent-color); color: white; }
  .lang-flag { font-size: 20px; }
  .lang-info { flex: 1; }
  .lang-name { font-weight: 600; }
  .lang-native { font-size: 12px; color: var(--text-muted); }
  .lang-option.active .lang-native { color: rgba(255,255,255,0.8); }
  .profile-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: var(--surface-color);
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: background 0.2s;
  }
  .profile-btn:active { background: #e0e0e0; }
  .profile-btn span { font-size: 24px; }
  .chat-container { 
    flex: 1; 
    overflow-y: auto; 
    padding: 20px 0 160px 0; 
    display: flex; 
    flex-direction: column; 
    scroll-behavior: smooth; 
  }
  .welcome-screen { 
    flex: 1; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
    text-align: center; 
    padding: 40px; 
    animation: fadeIn 0.5s ease; 
  }
  .welcome-icon { 
    font-size: 64px; 
    background: var(--logo-gradient); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    margin-bottom: 24px; 
    font-variation-settings: 'wght' 200; 
  }
  .welcome-text { font-size: 32px; font-weight: 600; margin-bottom: 12px; }
  .welcome-sub { 
    color: var(--text-muted); 
    font-size: 16px; 
    max-width: 400px; 
    line-height: 1.5; 
    margin-bottom: 20px; 
  }
  .feature-pills {
    display: flex;
    gap: 8px;
    margin-top: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .pill {
    background: var(--surface-color);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .pill span { font-size: 16px; }
  .input-wrapper-fixed { 
    position: fixed; 
    left: 0; right: 0; bottom: 0; 
    z-index: 30; 
    background: var(--bg-color); 
    padding: 12px max(20px, env(safe-area-inset-left)) max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-right)); 
    box-shadow: 0 -2px 10px rgba(0,0,0,0.04); 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
  }
  .input-wrapper { 
    width: 100%; 
    background: var(--input-bg); 
    border-radius: 28px; 
    padding: 6px; 
    display: flex; 
    align-items: center; 
    transition: background 0.2s; 
  }
  .input-wrapper:focus-within { 
    background: white; 
    outline: 1px solid #e0e0e0; 
    box-shadow: var(--shadow-soft); 
  }
  input { 
    flex: 1; 
    border: none; 
    background: none; 
    outline: none; 
    font-size: 16px; 
    font-family: var(--font-main); 
    color: var(--text-primary); 
    padding: 12px 14px; 
    user-select: text; 
  }
  .mic-btn, .send-btn, .translate-btn { 
    width: 44px; 
    height: 44px; 
    border-radius: 50%; 
    border: none; 
    background: transparent; 
    color: var(--text-muted); 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    transition: all 0.2s; 
    flex-shrink: 0; 
  }
  .mic-btn.listening { 
    color: #dc2626; 
    background: rgba(220, 38, 38, 0.1); 
    animation: pulse-red 1.5s infinite; 
  }
  .send-btn.active { background: var(--text-primary); color: white; }
  .translate-btn.active { background: #10b981; color: white; }
  .send-btn span, .translate-btn span { font-size: 22px; }
  .disclaimer { 
    font-size: 11px; 
    color: var(--text-muted); 
    margin-top: 8px; 
    text-align: center; 
    opacity: 0.8; 
  }

  /* ==================== MESSAGE BUBBLES ‚Äì PERFECT SPACING ==================== */
  .message-row {
    display: flex;
    margin-bottom: 40px;
    max-width: 80%;
    position: relative;
  }
  .message-row.user {
    margin-left: auto;
    text-align: right;
    flex-direction: column;
    align-items: flex-end;
    margin-bottom: 56px;
  }
  .message-row.ai {
    margin-right: auto;
    padding-left: 50px;
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 56px;
  }
  .timestamp {
    font-size: 10px;
    color: var(--text-muted);
    position: absolute;
    bottom: -24px;
  }
  .message-row.user .timestamp { right: 0; }
  .message-row.ai .timestamp   { left: 50px; }

  .message-content {
    padding: 14px 18px;
    border-radius: 20px;
    line-height: 1.6;
    text-align: left;
    font-size: 15px;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    word-wrap: break-word;
    max-width: 100%;
    display: inline-block;
    box-shadow: var(--shadow-soft);
  }
  .message-row.user .message-content {
    background: var(--accent-color);
    color: white;
    border-bottom-right-radius: 4px;
    box-shadow: 0 2px 5px rgba(37, 99, 235, 0.2);
  }
  .message-row.ai .message-content {
    background: var(--surface-color);
    color: var(--text-primary);
    border-top-left-radius: 4px;
    position: relative;
  }
  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: absolute;
  }
  .message-row.ai .avatar {
    background: var(--logo-gradient);
    color: white;
    font-size: 22px;
    left: 0;
    top: -10px;
  }
  .lang-badge-msg {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    font-size: 9px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    text-transform: uppercase;
  }
  .copy-actions {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 2;
    margin-top: -10px;
    margin-right: -10px;
    opacity: 0;
    transition: opacity 0.3s;
    display: flex;
    gap: 5px;
  }
  .message-row.ai:hover .copy-actions { opacity: 1; }
  .copy-btn, .speak-btn {
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    padding: 5px 12px;
    border-radius: 50px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    backdrop-filter: blur(5px);
  }
  .copy-btn span, .speak-btn span { font-size: 16px; transition: transform 0.1s; }
  .copy-btn:active span, .speak-btn:active span { transform: scale(0.9); }
  .message-content pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 13px;
    margin: 10px -18px 10px -18px;
  }
  .message-content code {
    background: rgba(0,0,0,0.05);
    padding: 2px 4px;
    border-radius: 4px;
    font-family: var(--font-mono);
  }
  .message-content pre code { background: none; padding: 0; }
  .thinking { display: flex; gap: 5px; padding: 10px 0; }
  .dot { width: 5px; height: 5px; background: #9aa0a6; border-radius: 50%; animation: pulse 1s infinite alternate; }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  /* ==================== DESKTOP LAYOUT ‚Äì BEAUTIFUL SPACING ==================== */
  @media (min-width: 768px) {
    .chat-container {
      max-width: 768px;
      margin: 0 auto;
      padding: 40px 20px 180px 20px;
    }
    .welcome-screen { max-width: 600px; margin: 0 auto; }
    #messagesList { max-width: 100%; }

    /* --- far-edge alignment --- */
    .message-row.user {
      margin-left: auto;
      margin-right: 0;
      max-width: 70%;
    }
    .message-row.ai {
      margin-left: 0;
      margin-right: auto;
      max-width: 70%;
    }

    /* --- extra vertical space --- */
    .message-row,
    .message-row.user,
    .message-row.ai {
      margin-bottom: 100px !important;
    }

    /* --- container padding for edges --- */
    .chat-container {
      padding-left: 40px;
      padding-right: 40px;
    }

    .message-row { max-width: 100%; }
    .message-row.ai { padding-left: 62px; }
    .message-row.ai .avatar {
      width: 52px;
      height: 52px;
      font-size: 28px;
      top: -12px;
    }
    .message-content {
      padding: 18px 22px;
      font-size: 16px;
    }
    .timestamp { 
      bottom: -28px;
      font-size: 11px;
    }
    .message-row.ai .timestamp { left: 62px; }

    .input-wrapper-fixed {
      max-width: 768px;
      left: 50%;
      transform: translateX(-50%);
      padding-left: 20px;
      padding-right: 20px;
    }
    .lang-dropdown { max-height: 500px; }
  }

  @media (min-width: 1024px) {
    .chat-container { max-width: 900px; }
    .input-wrapper-fixed { max-width: 900px; }
    .message-row { max-width: 85%; }
  }
  @media (min-width: 1440px) {
    .chat-container { max-width: 1000px; }
    .input-wrapper-fixed { max-width: 1000px; }
  }

  @keyframes pulse { to { opacity: 0.3; transform: translateY(-2px); } }
  @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* Bottom sheets & snackbar (unchanged) */
  .bottom-sheet {
    position: fixed;
    left: 0; right: 0; bottom: 0;
    background: var(--bg-color);
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    padding: 20px;
    z-index: 50;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
    transform: translateY(100%);
    transition: transform 0.3s ease-out;
    max-height: 90vh;
    overflow-y: auto;
  }
  .bottom-sheet.open { transform: translateY(0); }
  .sheet-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 40;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .sheet-overlay.open { opacity: 1; pointer-events: all; }
  .sheet-header { font-size: 20px; font-weight: 700; margin-bottom: 20px; text-align: center; position: relative; }
  .sheet-close-btn { position: absolute; right: 0; top: 0; background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
  .sheet-tab-bar { display: flex; border-bottom: 1px solid var(--surface-color); margin-bottom: 20px; }
  .sheet-tab { flex: 1; text-align: center; padding: 10px 0; cursor: pointer; font-weight: 500; color: var(--text-muted); border-bottom: 2px solid transparent; transition: color 0.2s, border-color 0.2s; }
  .sheet-tab.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
  .sheet-tab-content { padding: 10px 0; }
  .sheet-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--surface-color); border-radius: 10px; font-family: var(--font-main); font-size: 16px; background: var(--input-bg); }
  .sheet-btn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 50px;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.2s;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .sheet-btn:active { transform: scale(0.98); }
  .sheet-btn-primary { background: var(--logo-gradient); color: white; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
  .sheet-btn-google { background: white; color: var(--text-primary); border: 1px solid #ccc; margin-bottom: 15px; }
  .sheet-btn-google img { width: 20px; height: 20px; }
  .sheet-btn-logout { background: #dc2626; color: white; margin-top: 20px; }
  .user-avatar-large {
    width: 80px; height: 80px; border-radius: 50%; background: var(--logo-gradient); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 40px;
  }
  .user-email-text { text-align: center; color: var(--text-muted); font-size: 14px; margin-top: -10px; margin-bottom: 20px; }
  .user-info-group { margin-bottom: 20px; padding: 15px; background: var(--surface-color); border-radius: 12px; }
  .user-info-group label { display: block; font-size: 12px; font-weight: 500; color: var(--text-secondary); margin-bottom: 5px; }
  #customSnackbar {
    visibility: hidden;
    min-width: 250px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 12px;
    position: fixed;
    z-index: 1000;
    left: 50%;
    bottom: 100px;
    transform: translateX(-50%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transition: opacity 0.3s, bottom 0.3s;
    font-size: 14px;
    font-weight: 500;
  }
  #customSnackbar.show {
    visibility: visible;
    opacity: 1;
    bottom: 80px;
  }
   /* ----------  DESKTOP ‚ÄúLOCKED-APART‚Äù BUBBLES  ---------- */
@media (min-width: 768px) {
  /* 1.  Container breathes away from screen edges */
  .chat-container {
    padding-left:  48px;
    padding-right: 48px;
  }

  /* 2.  Force bubbles to the far sides */
  .message-row.user { margin-left: auto; margin-right: 0; }
  .message-row.ai   { margin-left: 0;   margin-right: auto; }

  /* 3.  Cap width so they don‚Äôt stretch too wide */
  .message-row.user,
  .message-row.ai   { max-width: 65%; }

  /* 4.  FIXED vertical gap between *every* bubble pair */
  .message-row        { margin-bottom: 100px !important; }
  .message-row:last-child { margin-bottom: 0 !important; } /* tidy last item */
}
</style>
</head>
<body>
  <div id="customSnackbar"></div>
  <div class="sheet-overlay" id="sheetOverlay"></div>
  
  <div class="bottom-sheet" id="userSheet">
    <div class="sheet-header">
      Account Settings
      <button class="sheet-close-btn" onclick="closeSheet('user')"><span class="material-symbols-rounded">close</span></button>
    </div>
    <div class="user-avatar-large"><span class="material-symbols-rounded">person</span></div>
    <div class="user-email-text" id="userEmail">example@email.com</div>
    <div class="user-info-group">
        <label for="userNameInput">Display Name</label>
        <input type="text" id="userNameInput" class="sheet-input" placeholder="Enter your name">
        <button class="sheet-btn sheet-btn-primary" onclick="updateDisplayName()">Save Name</button>
    </div>
    <button class="sheet-btn sheet-btn-logout" onclick="logout()">
        <span class="material-symbols-rounded" style="font-size: 18px;">logout</span> Logout
    </button>
  </div>
  
  <div class="bottom-sheet" id="authSheet">
    <div class="sheet-header">
      Welcome to Vynix Lingua
      <button class="sheet-close-btn" onclick="closeSheet('auth')"><span class="material-symbols-rounded">close</span></button>
    </div>
    <button class="sheet-btn sheet-btn-google" onclick="signInWithGoogle()">
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjA4IDEwLjE4OVY1Ljg2NDhIMTguNDg4QzE4LjY0OTIgNi42MTk3NCAxOC43MzMgNy41MDMyNiAxOC43MzMgOC40MTMzM0MxOC43MzMgMTQuMzIzOCAxNC45OTkyIDE4LjY0OCA5LjEyNDQzIDE4LjY0OEM0LjYwMzEgMTguNjQ4IDAuOTk5MDkgMTUuMDQzOSA2LjQ2NTI0ZS0wNSAxMC41MjI2QzAuOTk5MDk5IDUuOTk5MTEgNC42MDMxIDIuMzk1MSAxMC4xMjQ0IDIuMzk1MUMxMy4xMDI3IDIuMzk1MSAxNS4wMjg0IDMuNTQ1ODIgMTYuMDAzMiA0LjI5MDc1TDEyLjYxODQgOC43NDAyNUMxMS40OTMzIDguMDE5NTcgMTAuNTIyNiA3LjUzMDExIDkuNjIyNTUgNy41MzAxMUM2LjE3NTMgNy41MzAxMSAzLjM3NTUyIDEwLjIyOTYgMy4zNzU1MiAxMy42NzY4QzMuMzc1NTIgMTcuMTI0IDYuMTc1MyAyMC40MjM1IDkuNjIyNTUgMjAuNDIzNUMxMy4wNjk4IDIwLjQyMzUgMTUuNzkwOSAxOC4xMjQgMTUuNzk0NyAxNS42MDlIMTIuMDg0OVYxMC4xODlIMTguNDg4QzE4LjM0NzcgMTIuMzcxMyAxNy4xOTIgMTUuMjY1MyAxMi4wOCAxOC4yNzQzVjE4LjY0OEMxNy45Nzk0IDE3LjQ1NTIgMjAuMjI1MyAxMi4xMTk2IDIwLjIyNTMgNi43ODQwM0gyMS45OTIxVjEwLjE4OTJIMTIuMDg0OVoiIGZpbGw9IiMxYTFhMGEiLz4KPC9zdmc+Cg==" alt="Google">
        Sign in with Google
    </button>
    <div class="sheet-tab-bar" id="authTabs">
        <div class="sheet-tab active" data-tab="signin">Sign In</div>
        <div class="sheet-tab" data-tab="signup">Sign Up</div>
    </div>
    <div id="signin-content" class="sheet-tab-content">
        <input type="email" placeholder="Email Address" class="sheet-input" id="signInEmail">
        <input type="password" placeholder="Password" class="sheet-input" id="signInPassword">
        <button class="sheet-btn sheet-btn-primary" onclick="handleSignIn()">Sign In</button>
    </div>
    <div id="signup-content" class="sheet-tab-content" style="display: none;">
        <input type="text" placeholder="Display Name" class="sheet-input" id="signUpName">
        <input type="email" placeholder="Email Address" class="sheet-input" id="signUpEmail">
        <input type="password" placeholder="Password (min 6 chars)" class="sheet-input" id="signUpPassword">
        <button class="sheet-btn sheet-btn-primary" onclick="handleSignUp()">Sign Up</button>
    </div>
  </div>
  
  <header class="header">
    <div class="header-left">
      <div class="vynix-logo" onclick="location.reload()">
        <span class="material-symbols-rounded logo-icon">auto_awesome</span>
        <span class="logo-text">Vynix</span>
        <span class="lingua-badge">Lingua</span>
      </div>
    </div>
    
    <div class="lang-selector">
      <button class="lang-btn" id="langBtn">
        <span class="material-symbols-rounded">translate</span>
        <span id="currentLangText">English</span>
      </button>
      <div class="lang-dropdown" id="langDropdown"></div>
    </div>
    
    <button class="profile-btn" id="profileBtn">
        <span class="material-symbols-rounded">person</span>
    </button>
  </header>
  
  <main class="chat-container" id="chatContainer">
    <div class="welcome-screen" id="welcomeScreen">
      <div class="material-symbols-rounded welcome-icon">translate</div>
      <div class="welcome-text" id="welcomeText">Sawubona! How can I help?</div>
      <div class="welcome-sub">I'm Vynix Lingua - your multilingual African AI assistant. I speak multiple African languages and understand local slang!</div>
      <div class="feature-pills">
        <div class="pill"><span class="material-symbols-rounded">school</span>Education</div>
        <div class="pill"><span class="material-symbols-rounded">code</span>Coding</div>
        <div class="pill"><span class="material-symbols-rounded">auto_stories</span>Stories</div>
        <div class="pill"><span class="material-symbols-rounded">translate</span>11 Languages</div>
      </div>
    </div>
    <div id="messagesList"></div>
  </main>
  
  <div class="input-wrapper-fixed">
    <div class="input-wrapper">
      <button class="mic-btn" id="micBtn">
        <span class="material-symbols-rounded">mic</span>
      </button>
      <input type="text" id="input" placeholder="Message Vynix Lingua..." autocomplete="off">
      <button class="translate-btn" id="translateBtn" title="Auto-translate">
        <span class="material-symbols-rounded">g_translate</span>
      </button>
      <button class="send-btn" id="sendBtn">
        <span class="material-symbols-rounded">arrow_upward</span>
      </button>
    </div>
    <p class="disclaimer">Vynix Lingua speaks 11 African languages. Responses may vary.</p>
  </div>
  
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import {
        getAuth,
        onAuthStateChanged,
        signOut,
        GoogleAuthProvider,
        signInWithPopup,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        updateProfile
    } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getRemoteConfig, fetchAndActivate, getString } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      projectId: "fire-b-a8878",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const rc = getRemoteConfig(app);
    await fetchAndActivate(rc);
    const XAI_KEY = getString(rc, 'xai_api_key') || "YOUR_XAI_KEY_HERE";

    const LANGUAGES = {
      en: { name: 'English', native: 'English', flag: 'üá¨üáß', code: 'en-US', greeting: 'Hello' },
      zu: { name: 'Zulu', native: 'isiZulu', flag: 'üáøüá¶', code: 'zu-ZA', greeting: 'Sawubona' },
      xh: { name: 'Xhosa', native: 'isiXhosa', flag: 'üáøüá¶', code: 'xh-ZA', greeting: 'Molo' },
      af: { name: 'Afrikaans', native: 'Afrikaans', flag: 'üáøüá¶', code: 'af-ZA', greeting: 'Hallo' },
      st: { name: 'Sotho', native: 'Sesotho', flag: 'üáøüá¶', code: 'st-ZA', greeting: 'Lumela' },
      tn: { name: 'Tswana', native: 'Setswana', flag: 'üáßüáº', code: 'tn-ZA', greeting: 'Dumela' },
      sw: { name: 'Swahili', native: 'Kiswahili', flag: 'üá∞üá™', code: 'sw-KE', greeting: 'Jambo' },
      yo: { name: 'Yoruba', native: 'Yor√πb√°', flag: 'üá≥üá¨', code: 'yo-NG', greeting: 'Bawo' },
      ig: { name: 'Igbo', native: 'As·ª•s·ª• Igbo', flag: 'üá≥üá¨', code: 'ig-NG', greeting: 'Ndewo' },
      ha: { name: 'Hausa', native: 'Hausa', flag: 'üá≥üá¨', code: 'ha-NG', greeting: 'Sannu' },
      am: { name: 'Amharic', native: '·ä†·àõ·à≠·äõ', flag: 'üá™üáπ', code: 'am-ET', greeting: '·à∞·àã·àù' }
    };

    const SLANG_DICTIONARY = {
      'eish': { lang: 'zu', meaning: 'Expression of surprise or sympathy', translation: 'Oh my!' },
      'yebo': { lang: 'zu', meaning: 'Yes', translation: 'Yes' },
      'cha': { lang: 'zu', meaning: 'No', translation: 'No' },
      'howzit': { lang: 'af', meaning: 'How are you?', translation: 'How are you?' },
      'lekker': { lang: 'af', meaning: 'Nice/good', translation: 'Nice' },
      'braai': { lang: 'af', meaning: 'Barbecue', translation: 'Barbecue' },
      'molo': { lang: 'xh', meaning: 'Hello (singular)', translation: 'Hello' },
      'molweni': { lang: 'xh', meaning: 'Hello (plural)', translation: 'Hello everyone' },
      'sharp': { lang: 'multi', meaning: 'OK/bye', translation: 'OK' },
      'ja': { lang: 'af', meaning: 'Yes', translation: 'Yes' },
      'nee': { lang: 'af', meaning: 'No', translation: 'No' },
      'ayoba': { lang: 'multi', meaning: 'Awesome/cool', translation: 'Awesome!' },
      'shap shap': { lang: 'multi', meaning: 'Quickly/hurry', translation: 'Hurry up' },
      'now now': { lang: 'multi', meaning: 'Soon', translation: 'In a moment' },
      'just now': { lang: 'multi', meaning: 'Later', translation: 'Later' }
    };

    let currentLang = 'en';
    let autoTranslate = false;
    let historyStack = [];

    const $ = s => document.querySelector(s);
    const $i = $('#input'), $send = $('#sendBtn'), $mic = $('#micBtn');
    const $translate = $('#translateBtn'), $list = $('#messagesList');
    const $welcome = $('#welcomeScreen'), $welcomeText = $('#welcomeText');
    const $profileBtn = $('#profileBtn'), $userSheet = $('#userSheet');
    const $authSheet = $('#authSheet'), $sheetOverlay = $('#sheetOverlay');
    const $langBtn = $('#langBtn'), $langDropdown = $('#langDropdown');
    const $currentLangText = $('#currentLangText');
    const $customSnackbar = $('#customSnackbar');

    function initLanguageDropdown() {
      $langDropdown.innerHTML = Object.keys(LANGUAGES).map(code => {
        const lang = LANGUAGES[code];
        return `
          <div class="lang-option ${code === currentLang ? 'active' : ''}" data-lang="${code}">
            <span class="lang-flag">${lang.flag}</span>
            <div class="lang-info">
              <div class="lang-name">${lang.name}</div>
              <div class="lang-native">${lang.native}</div>
            </div>
          </div>
        `;
      }).join('');

      document.querySelectorAll('.lang-option').forEach(opt => {
        opt.addEventListener('click', () => {
          const newLang = opt.dataset.lang;
          switchLanguage(newLang);
        });
      });
    }

    function switchLanguage(langCode) {
      currentLang = langCode;
      const lang = LANGUAGES[langCode];
      $currentLangText.textContent = lang.name;
      $langDropdown.classList.remove('open');
      
      document.querySelectorAll('.lang-option').forEach(opt => {
        opt.classList.toggle('active', opt.dataset.lang === langCode);
      });

      updateSystemInstructions();
      showCustomSnackbar(`Language switched to ${lang.name}`);
      
      const user = auth.currentUser;
      if (user && user.displayName) {
        const firstName = user.displayName.split(' ')[0];
        $welcomeText.textContent = `${lang.greeting} ${firstName}! How can I help?`;
      } else {
        $welcomeText.textContent = `${lang.greeting}! How can I help?`;
      }
    }

    function updateSystemInstructions() {
      const lang = LANGUAGES[currentLang];
      const systemPrompt = `You are Vynix Lingua, a multilingual African AI assistant fluent in ${lang.name} (${lang.native}).

CRITICAL INSTRUCTIONS:
1. ALWAYS respond in ${lang.name} when the user's selected language is ${lang.name}.
2. Understand and interpret African slang from all South African languages.
3. Be culturally aware and sensitive to African contexts.
4. For education: Expert in South African CAPS curriculum (Grades R-12).
5. For coding: Provide clean, modern code with clear explanations.
6. For storytelling: Be creative and engaging.

SLANG INTERPRETATION:
- Recognize common slang like "eish", "yebo", "howzit", "lekker", "braai", "sharp", "ayoba"
- Explain slang meanings when asked
- Use appropriate slang naturally in responses when suitable

TRANSLATION MODE:
- When asked to translate, provide accurate translations
- Explain cultural context when relevant
- Help with pronunciation when needed

Keep responses conversational, accurate, and culturally relevant. Use ${lang.name} as the primary response language unless the user specifically asks for English or another language.`;

      historyStack = [{ role: "system", content: systemPrompt }];
    }

    $langBtn.addEventListener('click', () => {
      $langDropdown.classList.toggle('open');
    });

    document.addEventListener('click', (e) => {
      if (!$langBtn.contains(e.target) && !$langDropdown.contains(e.target)) {
        $langDropdown.classList.remove('open');
      }
    });

    $translate.addEventListener('click', () => {
      autoTranslate = !autoTranslate;
      $translate.classList.toggle('active', autoTranslate);
      showCustomSnackbar(autoTranslate ? 'Auto-translate enabled' : 'Auto-translate disabled');
    });

    function formatTime(date) {
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    function showCustomSnackbar(message) {
      $customSnackbar.textContent = message;
      $customSnackbar.classList.add('show');
      setTimeout(() => {
        $customSnackbar.classList.remove('show');
      }, 3000);
    }

    function openSheet(type) {
      $sheetOverlay.classList.add('open');
      if (type === 'user') {
        $userSheet.classList.add('open');
      } else if (type === 'auth') {
        $authSheet.classList.add('open');
      }
    }

    window.closeSheet = (type) => {
      $sheetOverlay.classList.remove('open');
      if (type === 'user') $userSheet.classList.remove('open');
      else if (type === 'auth') $authSheet.classList.remove('open');
    };

    $sheetOverlay.addEventListener('click', () => {
      closeSheet('user');
      closeSheet('auth');
    });

    $profileBtn.addEventListener('click', () => {
      const user = auth.currentUser;
      if (user) {
        document.getElementById('userNameInput').value = user.displayName || '';
        document.getElementById('userEmail').textContent = user.email || 'No email';
        openSheet('user');
      } else {
        openSheet('auth');
      }
    });

    document.getElementById('authTabs').addEventListener('click', (e) => {
      const tab = e.target.closest('.sheet-tab');
      if (!tab) return;
      const targetTab = tab.dataset.tab;
      document.querySelectorAll('.sheet-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      document.querySelectorAll('.sheet-tab-content').forEach(content => content.style.display = 'none');
      document.getElementById(`${targetTab}-content`).style.display = 'block';
    });

    window.updateDisplayName = async () => {
      const newName = document.getElementById('userNameInput').value.trim();
      const user = auth.currentUser;
      if (!user || newName === user.displayName) return;
      try {
        await updateProfile(user, { displayName: newName });
        showCustomSnackbar('Display name updated successfully!');
        const lang = LANGUAGES[currentLang];
        const firstName = newName.split(' ')[0];
        $welcomeText.textContent = `${lang.greeting} ${firstName}! How can I help?`;
        closeSheet('user');
      } catch (error) {
        showCustomSnackbar("Failed to update name: " + error.message);
      }
    };

    window.logout = async () => {
      try {
        await signOut(auth);
        showCustomSnackbar("Logged out successfully.");
        closeSheet('user');
      } catch (error) {
        showCustomSnackbar("Logout failed. Please try again.");
      }
    };

    window.signInWithGoogle = async () => {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        showCustomSnackbar("Google Sign-In failed: " + error.message);
      }
    };

    window.handleSignIn = async () => {
      const email = document.getElementById('signInEmail').value.trim();
      const password = document.getElementById('signInPassword').value;
      if (!email || !password) {
        showCustomSnackbar("Please enter both email and password.");
        return;
      }
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        let errorMessage = "Sign-In failed. Please check your credentials.";
        if (error.code === 'auth/user-not-found') errorMessage = "No user found with this email.";
        else if (error.code === 'auth/wrong-password') errorMessage = "Incorrect password.";
        showCustomSnackbar(errorMessage);
      }
    };

    window.handleSignUp = async () => {
      const name = document.getElementById('signUpName').value.trim();
      const email = document.getElementById('signUpEmail').value.trim();
      const password = document.getElementById('signUpPassword').value;
      if (!name || !email || !password || password.length < 6) {
        showCustomSnackbar("Please enter valid details (password min 6 chars).");
        return;
      }
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        await updateProfile(userCredential.user, { displayName: name });
      } catch (error) {
        let errorMessage = "Sign-Up failed. Please try again.";
        if (error.code === 'auth/email-already-in-use') errorMessage = "Email already in use.";
        showCustomSnackbar(errorMessage);
      }
    };

    onAuthStateChanged(auth, (user) => {
      const lang = LANGUAGES[currentLang];
      if (user) {
        if (user.displayName) {
          const firstName = user.displayName.split(' ')[0];
          $welcomeText.textContent = `${lang.greeting} ${firstName}! How can I help?`;
        } else {
          $welcomeText.textContent = `${lang.greeting}! How can I help?`;
        }
        closeSheet('auth');
      } else {
        $welcomeText.textContent = `${lang.greeting}! How can I help?`;
      }
    });

    function parseMarkdown(text) {
      let html = text.replace(/```([\s\S]*?)```/g, (match, code) =>
        `<pre><code>${code.trim()}</code></pre>`
      );
      html = html.replace(/`([^`]+)`/g, '<code>$1</code>')
                 .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                 .replace(/\*(.*?)\*/g, '<em>$1</em>');
      html = html.replace(/^\s*-\s+(.*)/gm, '<li>$1</li>');
      if (html.includes('<li>')) {
        html = html.replace(/(<li>.*?<\/li>)/g, '<ul>$1</ul>');
        html = html.replace(/<\/ul><ul>/g, '');
      }
      html = html.split('<pre>').map((segment, index) => {
        if (index % 2 === 0) {
          return segment.replace(/\n/g, '<br>');
        } else {
          return segment;
        }
      }).join('<pre>');
      html = html.replace(/<br><pre>/g, '<pre>').replace(/<\/pre><br>/g, '</pre>');
      return html;
    }

    function detectSlang(text) {
      const words = text.toLowerCase().split(/\s+/);
      const detected = [];
      for (const word of words) {
        if (SLANG_DICTIONARY[word]) {
          detected.push({ word, ...SLANG_DICTIONARY[word] });
        }
      }
      return detected;
    }

    function addMessage(text, type, showLangBadge = false) {
      $welcome.style.display = 'none';
      const div = document.createElement('div');
      div.className = `message-row ${type}`;
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = parseMarkdown(text);

      if (showLangBadge && currentLang !== 'en') {
        const badge = document.createElement('div');
        badge.className = 'lang-badge-msg';
        badge.textContent = LANGUAGES[currentLang].native;
        contentDiv.appendChild(badge);
      }

      const timestampDiv = document.createElement('div');
      timestampDiv.className = 'timestamp';
      timestampDiv.textContent = formatTime(new Date());

      if (type === 'ai') {
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'avatar ai';
        avatarDiv.innerHTML = '<span class="material-symbols-rounded">auto_awesome</span>';

        const copyActionsDiv = document.createElement('div');
        copyActionsDiv.className = 'copy-actions';

        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.innerHTML = '<span class="material-symbols-rounded">content_copy</span> Copy';
        copyBtn.addEventListener('click', () => {
          const textToCopy = contentDiv.textContent.replace(/Copy$/, '').trim();
          navigator.clipboard.writeText(textToCopy);
          copyBtn.innerHTML = '<span class="material-symbols-rounded">check</span> Copied';
          setTimeout(() => {
            copyBtn.innerHTML = '<span class="material-symbols-rounded">content_copy</span> Copy';
          }, 2000);
        });

        const speakBtn = document.createElement('button');
        speakBtn.className = 'speak-btn';
        speakBtn.innerHTML = '<span class="material-symbols-rounded">volume_up</span> Speak';
        speakBtn.addEventListener('click', () => {
          if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(contentDiv.textContent);
            utterance.lang = LANGUAGES[currentLang].code;
            speechSynthesis.speak(utterance);
          }
        });

        copyActionsDiv.appendChild(copyBtn);
        copyActionsDiv.appendChild(speakBtn);
        contentDiv.appendChild(copyActionsDiv);

        div.appendChild(avatarDiv);
        div.appendChild(contentDiv);
        div.appendChild(timestampDiv);
      } else {
        div.appendChild(contentDiv);
        div.appendChild(timestampDiv);
      }

      $list.appendChild(div);
      $('#chatContainer').scrollTop = $('#chatContainer').scrollHeight;
    }

    function addLoading() {
      const div = document.createElement('div');
      div.id = 'loading';
      div.className = 'message-row ai';

      const avatarDiv = document.createElement('div');
      avatarDiv.className = 'avatar ai';
      avatarDiv.innerHTML = '<span class="material-symbols-rounded">auto_awesome</span>';

      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = `<div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

      div.appendChild(avatarDiv);
      div.appendChild(contentDiv);
      $list.appendChild(div);
      $('#chatContainer').scrollTop = $('#chatContainer').scrollHeight;
    }

    function removeLoading() {
      const loading = $('#loading');
      if (loading) loading.remove();
    }

    window.sendMessage = async () => {
      const msg = $i.value.trim();
      if (!msg) return;

      if (!auth.currentUser) {
        showCustomSnackbar("You must be logged in to chat.");
        openSheet('auth');
        return;
      }

      $i.value = '';
      $send.classList.remove('active');
      addMessage(msg, 'user');

      const slangDetected = detectSlang(msg);
      if (slangDetected.length > 0 && msg.toLowerCase().includes('what does') || msg.toLowerCase().includes('meaning')) {
        const explanations = slangDetected.map(s => 
          `**${s.word}** (${LANGUAGES[s.lang].name}): ${s.meaning} - "${s.translation}"`
        ).join('\n\n');
        addMessage(`Here are the slang terms I found:\n\n${explanations}`, 'ai', true);
        return;
      }

      addLoading();
      try {
        const messages = [...historyStack, { role: "user", content: msg }];
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${XAI_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "grok-4-1-fast-non-reasoning",
            messages: messages,
            temperature: 0.7,
            max_tokens: 1500
          })
        });

        removeLoading();
        if (!res.ok) throw new Error("API Error");

        const data = await res.json();
        const reply = data.choices[0]?.message?.content?.trim() || "No response.";
        addMessage(reply, 'ai', currentLang !== 'en');
        historyStack.push(
          { role: "user", content: msg },
          { role: "assistant", content: reply }
        );
      } catch (e) {
        removeLoading();
        addMessage("Connection error. Please try again.", 'ai');
      }
    };

    $i.addEventListener('input', () => $send.classList.toggle('active', $i.value.trim().length > 0));
    $i.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    $send.addEventListener('click', sendMessage);

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SR();
      recognition.continuous = false;
      recognition.interimResults = false;

      $mic.onclick = () => {
        if (!auth.currentUser) {
          showCustomSnackbar("You must be logged in to use voice.");
          openSheet('auth');
          return;
        }
        recognition.lang = LANGUAGES[currentLang].code;
        recognition.start();
      };

      recognition.onstart = () => {
        $mic.classList.add('listening');
        $i.placeholder = "Listening...";
      };

      recognition.onresult = e => {
        $i.value = e.results[0][0].transcript;
        sendMessage();
      };

      recognition.onend = () => {
        $mic.classList.remove('listening');
        $i.placeholder = `Message Vynix Lingua...`;
      };

      recognition.onerror = () => {
        $mic.classList.remove('listening');
        $i.placeholder = `Message Vynix Lingua...`;
      };
    } else {
      $mic.style.display = 'none';
    }

    initLanguageDropdown();
    updateSystemInstructions();
  </script>
</body>
</html>
