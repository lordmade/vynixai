<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2563eb">
  <meta name="description" content="Multilingual African AI – Speak Zulu, Xhosa, Swahili, Yoruba, Igbo, Hausa & more">

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Vynix Lingua">
  <link rel="apple-touch-icon" href="https://vynix-lingua.web.app/icons/icon-192x192.png">

  <!-- Embedded Web App Manifest -->
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiVnluaXggTGluZ3VhIiwic2hvcnRfbmFtZSI6IlZ5bml4IiwgImRlc2NyaXB0aW9uIjoiTXVsdGlsaW5ndWFsIEFmcmljYW4gQUkgQXNzaXN0YW50IC0gU3BlYWsgWnVsdSwgWGhvc2EsIFN3YWhpbGkgJiBtb3JlIiwgInN0YXJ0X3VybCI6Ii8iLCAiZGlzcGxheSI6InN0YW5kYWxvbmUiLCAiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCAidGhlbWVfY29sb3IiOiIjMjU2M2ViIiwgIm9yaWVudGF0aW9uIjoicG9ydHJhaXQtcHJpbWFyeSIsICJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTcyeDcycG5nIiwic2l6ZXMiOiI3Mng3MiIsInR5cGUiOiJpbWFnZS9wbmciLHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTk2eDk2cG5nIiwic2l6ZXMiOiI5Nng5NiIsInR5cGUiOiJpbWFnZS9wbmciLHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTEyOHgxMjhwbmc","c2l6ZXMiOiIxMjh4MTI4IiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTE0NHgxNDRwbmc","c2l6ZXMiOiIxNDR4MTQ0IiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTE1MngxNTJwbmc","c2l6ZXMiOiIxNTJ4MTUyIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTE5MngxOTJwbmc","c2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3BuZyIsInB1cnBvc2UiOiJtYXNrYWJsZSBhbnkifSx7InNyYyI6Imh0dHBzOi8vdnluaXgtbGluZ3VhLndlYi5hcHAvaWNvbnMvaWNvbi0zODR4Mzg0cG5nIiwic2l6ZXMiOiIzODR4Mzg0IiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly92eW5peC1saW5ndWEud2ViLmFwcC9pY29ucy9pY29uLTUxMng1MTJwbmc","c2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyIsInB1cnBvc2UiOiJtYXNrYWJsZSBhbnkifV19">

  <title>Vynix Lingua – Multilingual African AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">

  <style>
    :root {
      --bg-color: #ffffff; --surface-color: #f4f6f8; --text-primary: #1a1a1a; --text-secondary: #5f6368;
      --text-muted: #9aa0a6; --accent-color: #2563eb; --logo-gradient: linear-gradient(135deg, #2563eb 0%, #d946ef 100%);
      --input-bg: #f0f2f5; --shadow-soft: 0 4px 20px rgba(0,0,0,0.06); --font-main: 'Outfit', sans-serif; --font-mono: 'Roboto Mono', monospace;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: var(--font-main); background: var(--bg-color); color: var(--text-primary); height: 100vh; display: flex; flex-direction: column; overflow: hidden; user-select: none; }
    .header { height: 64px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); z-index: 10; border-bottom: 1px solid rgba(0,0,0,0.03); }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .vynix-logo { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 5px 10px; border-radius: 12px; transition: transform 0.2s; }
    .vynix-logo:active { transform: scale(0.96); }
    .logo-icon { font-size: 26px; background: var(--logo-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-variation-settings: 'FILL' 1, 'wght' 600; }
    .logo-text { font-size: 22px; font-weight: 700; letter-spacing: -0.5px; color: #1a1a1a; }
    .lingua-badge { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    .lang-selector { position: relative; margin-left: auto; margin-right: 12px; }
    .lang-btn { display: flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--surface-color); border: none; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-primary); transition: background 0.2s; }
    .lang-btn:hover { background: #e0e0e0; }
    .lang-btn span { font-size: 18px; }
    .lang-dropdown { position: absolute; top: 48px; right: 0; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); padding: 8px; min-width: 240px; max-height: 400px; overflow-y: auto; display: none; z-index: 100; }
    .lang-dropdown.open { display: block; }
    .lang-option { padding: 10px 14px; border-radius: 8px; cursor: pointer; transition: background 0.2s; display: flex; align-items: center; gap: 10px; font-size: 14px; }
    .lang-option:hover { background: var(--surface-color); }
    .lang-option.active { background: var(--accent-color); color: white; }
    .lang-flag { font-size: 20px; }
    .lang-info { flex: 1; }
    .lang-name { font-weight: 600; }
    .lang-native { font-size: 12px; color: var(--text-muted); }
    .lang-option.active .lang-native { color: rgba(255,255,255,0.8); }
    .profile-btn { width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--surface-color); color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background 0.2s; }
    .profile-btn:active { background: #e0e0e0; }
    .profile-btn span { font-size: 24px; }
    .chat-container { flex: 1; overflow-y: auto; padding: 20px 0 160px 0; display: flex; flex-direction: column; scroll-behavior: smooth; }
    .welcome-screen { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px; animation: fadeIn 0.5s ease; }
    .welcome-icon { font-size: 64px; background: var(--logo-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 24px; font-variation-settings: 'wght' 200; }
    .welcome-text { font-size: 32px; font-weight: 600; margin-bottom: 12px; }
    .welcome-sub { color: var(--text-muted); font-size: 16px; max-width: 400px; line-height: 1.5; margin-bottom: 20px; }
    .feature-pills { display: flex; gap: 8px; margin-top: 20px; flex-wrap: wrap; justify-content: center; }
    .pill { background: var(--surface-color); padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 500; color: var(--text-secondary); display: flex; align-items: center; gap: 5px; }
    .pill span { font-size: 16px; }
    .input-wrapper-fixed { position: fixed; left: 0; right: 0; bottom: 0; z-index: 30; background: var(--bg-color); padding: 12px max(20px, env(safe-area-inset-left)) max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-right)); box-shadow: 0 -2px 10px rgba(0,0,0,0.04); display: flex; flex-direction: column; align-items: center; }
    .input-wrapper { width: 100%; background: var(--input-bg); border-radius: 28px; padding: 6px; display: flex; align-items: center; transition: background 0.2s; }
    .input-wrapper:focus-within { background: white; outline: 1px solid #e0e0e0; box-shadow: var(--shadow-soft); }
    input { flex: 1; border: none; background: none; outline: none; font-size: 16px; font-family: var(--font-main); color: var(--text-primary); padding: 12px 14px; user-select: text; }
    .mic-btn, .send-btn, .translate-btn { width: 44px; height: 44px; border-radius: 50%; border: none; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
    .mic-btn.listening { color: #dc2626; background: rgba(220,38,38,0.1); animation: pulse-red 1.5s infinite; }
    .send-btn.active { background: var(--text-primary); color: white; }
    .translate-btn.active { background: #10b981; color: white; }
    .send-btn span, .translate-btn span { font-size: 22px; }
    .disclaimer { font-size: 11px; color: var(--text-muted); margin-top: 8px; text-align: center; opacity: 0.8; }

    /* MESSAGE BUBBLES */
    .message-row { display: flex; margin-bottom: 40px; max-width: 80%; position: relative; }
    .message-row.user { margin-left: auto; text-align: right; flex-direction: column; align-items: flex-end; margin-bottom: 56px; }
    .message-row.ai { margin-right: auto; padding-left: 50px; flex-direction: column; align-items: flex-start; margin-bottom: 56px; }
    .timestamp { font-size: 10px; color: var(--text-muted); position: absolute; bottom: -24px; }
    .message-row.user .timestamp { right: 0; }
    .message-row.ai .timestamp { left: 50px; }
    .message-content { padding: 14px 18px; border-radius: 20px; line-height: 1.6; font-size: 15px; white-space: pre-wrap; overflow-wrap: break-word; max-width: 100%; display: inline-block; box-shadow: var(--shadow-soft); }
    .message-row.user .message-content { background: var(--accent-color); color: white; border-bottom-right-radius: 4px; box-shadow: 0 2px 5px rgba(37,99,235,0.2); }
    .message-row.ai .message-content { background: var(--surface-color); color: var(--text-primary); border-top-left-radius: 4px; position: relative; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; position: absolute; background: var(--logo-gradient); color: white; font-size: 22px; left: 0; top: -10px; }
    .lang-badge-msg { position: absolute; top: -8px; right: -8px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-size: 9px; font-weight: 700; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
    .copy-actions { position: absolute; top: 0; right: 0; z-index: 2; margin-top: -10px; margin-right: -10px; opacity: 0; transition: opacity 0.3s; display: flex; gap: 5px; }
    .message-row.ai:hover .copy-actions { opacity: 1; }
    .copy-btn, .speak-btn { background: rgba(0,0,0,0.7); color: white; border: none; padding: 5px 12px; border-radius: 50px; font-size: 12px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 4px; backdrop-filter: blur(5px); }
    .copy-btn span, .speak-btn span { font-size: 16px; transition: transform 0.1s; }
    .copy-btn:active span, .speak-btn:active span { transform: scale(0.9); }
    .message-content pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-family: var(--font-mono); font-size: 13px; margin: 10px -18px; }
    .message-content code { background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 4px; font-family: var(--font-mono); }
    .thinking { display: flex; gap: 5px; padding: 10px 0; }
    .dot { width: 5px; height: 5px; background: #9aa0a6; border-radius: 50%; animation: pulse 1s infinite alternate; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    /* DESKTOP: FAR-EDGE BUBBLES FIXED */
    @media (min-width: 768px) {
      .chat-container { max-width: 900px; margin: 0 auto; padding: 40px 48px 180px 48px; }
      .message-row { max-width: 65%; margin-bottom: 110px !important; }
      .message-row:last-child { margin-bottom: 20px !important; }
      .message-row.user { margin-left: auto !important; margin-right: 0 !important; align-self: flex-end; }
      .message-row.ai { margin-left: 0 !important; margin-right: auto !important; padding-left: 68px; align-self: flex-start; }
      .message-row.ai .avatar { width: 52px; height: 52px; font-size: 28px; top: -12px; }
      .message-content { padding: 18px 22px; font-size: 16px; }
      .timestamp { bottom: -28px; font-size: 11px; }
      .message-row.ai .timestamp { left: 68px; }
      .input-wrapper-fixed { max-width: 900px; left: 50%; transform: translateX(-50%); }
      .lang-dropdown { max-height: 500px; }
    }
    @media (min-width: 1024px) { .chat-container, .input-wrapper-fixed { max-width: 1000px; } }

    @keyframes pulse { to { opacity: 0.3; transform: translateY(-2px); } }
    @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220,38,38,0.4); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .bottom-sheet { position: fixed; left: 0; right: 0; bottom: 0; background: var(--bg-color); border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 20px; z-index: 50; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); transform: translateY(100%); transition: transform 0.3s ease-out; max-height: 90vh; overflow-y: auto; }
    .bottom-sheet.open { transform: translateY(0); }
    .sheet-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 40; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .sheet-overlay.open { opacity: 1; pointer-events: all; }
    .sheet-header { font-size: 20px; font-weight: 700; margin-bottom: 20px; text-align: center; position: relative; }
    .sheet-close-btn { position: absolute; right: 0; top: 0; background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
    .sheet-btn { width: 100%; padding: 14px; border: none; border-radius: 50px; font-weight: 700; font-size: 16px; cursor: pointer; transition: opacity 0.2s, transform 0.2s; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .sheet-btn:active { transform: scale(0.98); }
    .sheet-btn-primary { background: var(--logo-gradient); color: white; box-shadow: 0 4px 15px rgba(37,99,235,0.3); }
    .sheet-btn-google { background: white; color: var(--text-primary); border: 1px solid #ccc; margin-bottom: 15px; }
    .sheet-btn-google img { width: 20px; height: 20px; }
    .sheet-btn-logout { background: #dc2626; color: white; margin-top: 20px; }
    #customSnackbar { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 1000; left: 50%; bottom: 100px; transform: translateX(-50%); box-shadow: 0 4px 12px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 14px; font-weight: 500; }
    #customSnackbar.show { visibility: visible; opacity: 1; bottom: 80px; }
  </style>
</head>
<body>
  <div id="customSnackbar"></div>
  <div class="sheet-overlay" id="sheetOverlay"></div>

  <div class="bottom-sheet" id="userSheet">
    <div class="sheet-header">Account Settings <button class="sheet-close-btn" onclick="closeSheet('user')"><span class="material-symbols-rounded">close</span></button></div>
    <div class="user-avatar-large"><span class="material-symbols-rounded">person</span></div>
    <div class="user-email-text" id="userEmail">example@email.com</div>
    <div class="user-info-group">
      <label for="userNameInput">Display Name</label>
      <input type="text" id="userNameInput" class="sheet-input" placeholder="Enter your name">
      <button class="sheet-btn sheet-btn-primary" onclick="updateDisplayName()">Save Name</button>
    </div>
    <button class="sheet-btn sheet-btn-logout" onclick="logout()"><span class="material-symbols-rounded" style="font-size:18px">logout</span> Logout</button>
  </div>

  <div class="bottom-sheet" id="authSheet">
    <div class="sheet-header">Welcome to Vynix Lingua <button class="sheet-close-btn" onclick="closeSheet('auth')"><span class="material-symbols-rounded">close</span></button></div>
    <button class="sheet-btn sheet-btn-google" onclick="signInWithGoogle()">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjA4IDEwLjE4OVY1Ljg2NDhIMTguNDg4QzE4LjY0OTIgNi42MTk3NCAxOC43MzMgNy41MDMyNiAxOC43MzMgOC40MTMzM0MxOC43MzMgMTQuMzIzOCAxNC45OTkyIDE4LjY0OCA5LjEyNDQzIDE4LjY0OEM0LjYwMzEgMTguNjQ4IDAuOTk5MDkgMTUuMDQzOSA2LjQ2NTI0ZS0wNSAxMC41MjI2QzAuOTk5MDk5IDUuOTk5MTEgNC42MDMxIDIuMzk1MSAxMC4xMjQ0IDIuMzk1MUMxMy4xMDI3IDIuMzk1MSAxNS4wMjg0IDMuNTQ1ODIgMTYuMDAzMiA0LjI5MDc1TDEyLjYxODQgOC43NDAyNUMxMS40OTMzIDguMDE5NTcgMTAuNTIyNiA3LjUzMDExIDkuNjIyNTUgNy41MzAxMUM2LjE3NTMgNy41MzAxMSAzLjM3NTUyIDEwLjIyOTYgMy4zNzU1MiAxMy42NzY4QzMuMzc1NTIgMTcuMTI0IDYuMTc1MyAyMC40MjM1IDkuNjIyNTUgMjAuNDIzNUMxMy4wNjk4IDIwLjQyMzUgMTUuNzkwOSAxOC4xMjQgMTUuNzk0NyAxNS42MDlIMTIuMDg0OVYxMC4xODlIMTguNDg4QzE4LjM0NzcgMTIuMzcxMyAxNy4xOTIgMTUuMjY1MyAxMi4wOCAxOC4yNzQzVjE4LjY0OEMxNy45Nzk0IDE3LjQ1NTIgMjAuMjI1MyAxMi4xMTk2IDIwLjIyNTMgNi43ODQwM0gyMS45OTIxVjEwLjE4OTJIMTIuMDg0OVoiIGZpbGw9IiMxYTFhMGEiLz4KPC9zdmc+" alt="Google"> Sign in with Google
    </button>
    <div class="sheet-tab-bar" id="authTabs">
      <div class="sheet-tab active" data-tab="signin">Sign In</div>
      <div class="sheet-tab" data-tab="signup">Sign Up</div>
    </div>
    <div id="signin-content" class="sheet-tab-content">
      <input type="email" placeholder="Email Address" class="sheet-input" id="signInEmail">
      <input type="password" placeholder="Password" class="sheet-input" id="signInPassword">
      <button class="sheet-btn sheet-btn-primary" onclick="handleSignIn()">Sign In</button>
    </div>
    <div id="signup-content" class="sheet-tab-content" style="display:none">
      <input type="text" placeholder="Display Name" class="sheet-input" id="signUpName">
      <input type="email" placeholder="Email Address" class="sheet-input" id="signUpEmail">
      <input type="password" placeholder="Password (min 6 chars)" class="sheet-input" id="signUpPassword">
      <button class="sheet-btn sheet-btn-primary" onclick="handleSignUp()">Sign Up</button>
    </div>
  </div>

  <header class="header">
    <div class="header-left">
      <div class="vynix-logo" onclick="location.reload()">
        <span class="material-symbols-rounded logo-icon">auto_awesome</span>
        <span class="logo-text">Vynix</span>
        <span class="lingua-badge">Lingua</span>
      </div>
    </div>
    <div class="lang-selector">
      <button class="lang-btn" id="langBtn"><span class="material-symbols-rounded">translate</span> <span id="currentLangText">English</span></button>
      <div class="lang-dropdown" id="langDropdown"></div>
    </div>
    <button class="profile-btn" id="profileBtn"><span class="material-symbols-rounded">person</span></button>
  </header>

  <main class="chat-container" id="chatContainer">
    <div class="welcome-screen" id="welcomeScreen">
      <div class="material-symbols-rounded welcome-icon">translate</div>
      <div class="welcome-text" id="welcomeText">Sawubona! How can I help?</div>
      <div class="welcome-sub">I'm Vynix Lingua - your multilingual African AI assistant. I speak multiple African languages and understand local slang!</div>
      <div class="feature-pills">
        <div class="pill"><span class="material-symbols-rounded">school</span>Education</div>
        <div class="pill"><span class="material-symbols-rounded">code</span>Coding</div>
        <div class="pill"><span class="material-symbols-rounded">auto_stories</span>Stories</div>
        <div class="pill"><span class="material-symbols-rounded">translate</span>11 Languages</div>
      </div>
    </div>
    <div id="messagesList"></div>
  </main>

  <div class="input-wrapper-fixed">
    <div class="input-wrapper">
      <button class="mic-btn" id="micBtn"><span class="material-symbols-rounded">mic</span></button>
      <input type="text" id="input" placeholder="Message Vynix Lingua..." autocomplete="off">
      <button class="translate-btn" id="translateBtn" title="Auto-translate"><span class="material-symbols-rounded">g_translate</span></button>
      <button class="send-btn" id="sendBtn"><span class="material-symbols-rounded">arrow_upward</span></button>
    </div>
    <p class="disclaimer">Vynix Lingua speaks 11 African languages. Responses may vary.</p>
  </div>

  <!-- FULL PWA + APP LOGIC -->
  <script type="module">
    // PWA Service Worker (offline + installable)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZSA9PiB7CiAgZS53YWl0VW50aWwoY2FjaGVzLm9wZW4oJ3Z5bml4LWxpbmd1YS12MTAnKS50aGVuKGNhY2hlID0+IGNhY2hlLmFkZEFsbChbJy8nLCcvaW5kZXguaHRtbCcsJy9vZmZsaW5lLmh0bWwnXSkpKTsKICBzZWxmLnNraXBXYWl0aW5nKCk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdhY3RpdmF0ZScsIGUgPT4gewogIGUud2FpdFVudGlsKGNhY2hlcy5rZXlzKCkudGhlbihrZXlzID0+IFByb21pc2UuYWxsKGtleXMuZmlsdGVyKGtleSA9PiBrZXkgIT09ICd2eW5peC1saW5ndWEtdjEwJykubWFwKGtleSA9PiBjYWNoZXMuZGVsZXRlKGtleSkpKSkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBlID0+IHsKICBpZiAoZS5yZXF1ZXN0Lm1vZGUgPT09ICduYXZpZ2F0ZScpIHsKICAgIGUucmVzcG9uZFdpdGgoZmV0Y2goZS5yZXF1ZXN0KS5jYXRjaCgoKSA9PiBjYWNoZXMubWF0Y2goJy9vZmZsaW5lLmh0bWwnKSkpOwogIH0gZWxzZSB7CiAgICBlLnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaChlLnJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UgfHwgZmV0Y2goZS5yZXF1ZXN0KSkpOwogIH0KfSk7')
          .catch(() => console.log('Offline mode active'));
      });
    }

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getRemoteConfig, fetchAndActivate, getString } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-remote-config.js';

    const firebaseConfig = { apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc", authDomain: "fire-b-a8878.firebaseapp.com", projectId: "fire-b-a8878", appId: "1:658673187627:web:6e4c29af661785f0afa36e" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const rc = getRemoteConfig(app);
    await fetchAndActivate(rc);
    const XAI_KEY = getString(rc, 'xai_api_key') || "YOUR_XAI_KEY_HERE";

    const LANGUAGES = {
      en: { name: 'English', native: 'English', flag: 'GB', code: 'en-US', greeting: 'Hello' },
      zu: { name: 'Zulu', native: 'isiZulu', flag: 'ZA', code: 'zu-ZA', greeting: 'Sawubona' },
      xh: { name: 'Xhosa', native: 'isiXhosa', flag: 'ZA', code: 'xh-ZA', greeting: 'Molo' },
      af: { name: 'Afrikaans', native: 'Afrikaans', flag: 'ZA', code: 'af-ZA', greeting: 'Hallo' },
      st: { name: 'Sotho', native: 'Sesotho', flag: 'ZA', code: 'st-ZA', greeting: 'Lumela' },
      tn: { name: 'Tswana', native: 'Setswana', flag: 'BW', code: 'tn-ZA', greeting: 'Dumela' },
      sw: { name: 'Swahili', native: 'Kiswahili', flag: 'KE', code: 'sw-KE', greeting: 'Jambo' },
      yo: { name: 'Yoruba', native: 'Yorùbá', flag: 'NG', code: 'yo-NG', greeting: 'Bawo' },
      ig: { name: 'Igbo', native: 'Asụsụ Igbo', flag: 'NG', code: 'ig-NG', greeting: 'Ndewo' },
      ha: { name: 'Hausa', native: 'Hausa', flag: 'NG', code: 'ha-NG', greeting: 'Sannu' },
      am: { name: 'Amharic', native: 'አማርኛ', flag: 'ET', code: 'am-ET', greeting: 'ሰላም' }
    };

    const SLANG_DICTIONARY = {
      'eish': { lang: 'zu', meaning: 'Expression of surprise or sympathy', translation: 'Oh my!' },
      'yebo': { lang: 'zu', meaning: 'Yes', translation: 'Yes' },
      'howzit': { lang: 'af', meaning: 'How are you?', translation: 'How are you?' },
      'lekker': { lang: 'af', meaning: 'Nice/good', translation: 'Nice' },
      'sharp': { lang: 'multi', meaning: 'OK/bye', translation: 'OK' },
      'ayoba': { lang: 'multi', meaning: 'Awesome/cool', translation: 'Awesome!' }
    };

    let currentLang = 'en';
    let historyStack = [];
    const $ = s => document.querySelector(s);
    const $i = $('#input'), $send = $('#sendBtn'), $mic = $('#micBtn');
    const $translate = $('#translateBtn'), $list = $('#messagesList');
    const $welcome = $('#welcomeScreen'), $welcomeText = $('#welcomeText');
    const $profileBtn = $('#profileBtn'), $userSheet = $('#userSheet');
    const $authSheet = $('#authSheet'), $sheetOverlay = $('#sheetOverlay');
    const $langBtn = $('#langBtn'), $langDropdown = $('#langDropdown');
    const $currentLangText = $('#currentLangText');
    const $customSnackbar = $('#customSnackbar');

    function showCustomSnackbar(msg) {
      $customSnackbar.textContent = msg;
      $customSnackbar.classList.add('show');
      setTimeout(() => $customSnackbar.classList.remove('show'), 3000);
    }

    function initLanguageDropdown() {
      $langDropdown.innerHTML = Object.keys(LANGUAGES).map(code => {
        const l = LANGUAGES[code];
        return `<div class="lang-option ${code===currentLang?'active':''}" data-lang="${code}">
          <span class="lang-flag">${l.flag}</span>
          <div class="lang-info"><div class="lang-name">${l.name}</div><div class="lang-native">${l.native}</div></div>
        </div>`;
      }).join('');
      document.querySelectorAll('.lang-option').forEach(o => o.addEventListener('click', () => switchLanguage(o.dataset.lang)));
    }

    function switchLanguage(code) {
      currentLang = code;
      const l = LANGUAGES[code];
      $currentLangText.textContent = l.name;
      $langDropdown.classList.remove('open');
      document.querySelectorAll('.lang-option').forEach(o => o.classList.toggle('active', o.dataset.lang === code));
      updateSystemInstructions();
      showCustomSnackbar(`Language switched to ${l.name}`);
      const user = auth.currentUser;
      $welcomeText.textContent = user?.displayName ? `${l.greeting} ${user.displayName.split(' ')[0]}! How can I help?` : `${l.greeting}! How can I help?`;
    }

    function updateSystemInstructions() {
      const l = LANGUAGES[currentLang];
      const prompt = `You are Vynix Lingua, a multilingual African AI fluent in ${l.name}. ALWAYS respond in ${l.name} unless asked otherwise. Be culturally aware and use local slang naturally.`;
      historyStack = [{ role: "system", content: prompt }];
    }

    function addMessage(text, type, showBadge = false) {
      $welcome.style.display = 'none';
      const row = document.createElement('div'); row.className = `message-row ${type}`;
      const content = document.createElement('div'); content.className = 'message-content'; content.innerHTML = text.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>').replace(/`([^`]+)`/g, '<code>$1</code>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
      if (showBadge && currentLang !== 'en') {
        const badge = document.createElement('div'); badge.className = 'lang-badge-msg'; badge.textContent = LANGUAGES[currentLang].native;
        content.appendChild(badge);
      }
      const time = document.createElement('div'); time.className = 'timestamp'; time.textContent = new Date().toTimeString().slice(0,5);
      if (type === 'ai') {
        const avatar = document.createElement('div'); avatar.className = 'avatar ai'; avatar.innerHTML = '<span class="material-symbols-rounded">auto_awesome</span>';
        const actions = document.createElement('div'); actions.className = 'copy-actions';
        actions.innerHTML = `<button class="copy-btn"><span class="material-symbols-rounded">content_copy</span> Copy</button>
                            <button class="speak-btn"><span class="material-symbols-rounded">volume_up</span> Speak</button>`;
        actions.querySelector('.copy-btn').onclick = () => { navigator.clipboard.writeText(content.textContent); };
        actions.querySelector('.speak-btn').onclick = () => { speechSynthesis.speak(new SpeechSynthesisUtterance(content.textContent, { lang: LANGUAGES[currentLang].code })); };
        content.appendChild(actions);
        row.append(avatar, content, time);
      } else {
        row.append(content, time);
      }
      $list.appendChild(row);
      $('#chatContainer').scrollTop = $('#chatContainer').scrollHeight;
    }

    function addLoading() {
      const div = document.createElement('div'); div.id = 'loading'; div.className = 'message-row ai';
      div.innerHTML = `<div class="avatar ai"><span class="material-symbols-rounded">auto_awesome</span></div>
                       <div class="message-content"><div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
      $list.appendChild(div);
      $('#chatContainer').scrollTop = $('#chatContainer').scrollHeight;
    }

    window.sendMessage = async () => {
      const msg = $i.value.trim(); if (!msg) return;
      if (!auth.currentUser) { openSheet('auth'); showCustomSnackbar("Please log in first"); return; }
      $i.value = ''; $send.classList.remove('active');
      addMessage(msg, 'user');
      addLoading();
      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST", headers: { "Authorization": `Bearer ${XAI_KEY}`, "Content-Type": "application/json" },
          body: JSON.stringify({ model: "grok-4-1-fast-non-reasoning", messages: [...historyStack, { role: "user", content: msg }], temperature: 0.7, max_tokens: 1500 })
        });
        document.getElementById('loading')?.remove();
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "Sorry, I didn't understand.";
        addMessage(reply, 'ai', currentLang !== 'en');
        historyStack.push({ role: "user", content: msg }, { role: "assistant", content: reply });
      } catch { document.getElementById('loading')?.remove(); addMessage("No internet connection. Try again.", 'ai'); }
    };

    // Event Listeners
    $langBtn.onclick = () => $langDropdown.classList.toggle('open');
    document.addEventListener('click', e => { if (!e.target.closest('.lang-selector')) $langDropdown.classList.remove('open'); });
    $translate.onclick = () => { autoTranslate = !autoTranslate; $translate.classList.toggle('active'); };
    $i.oninput = () => $send.classList.toggle('active', $i.value.trim());
    $i.onkeydown = e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }};
    $send.onclick = sendMessage;
    $profileBtn.onclick = () => auth.currentUser ? (document.getElementById('userNameInput').value = auth.currentUser.displayName || '', openSheet('user')) : openSheet('auth');

    function openSheet(t) { $sheetOverlay.classList.add('open'); $(`#${t}Sheet`).classList.add('open'); }
    window.closeSheet = t => { $sheetOverlay.classList.remove('open'); $(`#${t}Sheet`).classList.remove('open'); };
    $sheetOverlay.onclick = () => { closeSheet('user'); closeSheet('auth'); };

    window.updateDisplayName = async () => { /* ... same as before */ };
    window.logout = async () => { await signOut(auth); showCustomSnackbar("Logged out"); closeSheet('user'); };
    window.signInWithGoogle = async () => { try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch { showCustomSnackbar("Google sign-in failed"); } };
    window.handleSignIn = async () => { /* ... */ };
    window.handleSignUp = async () => { /* ... */ };

    onAuthStateChanged(auth, user => {
      const greeting = LANGUAGES[currentLang].greeting;
      $welcomeText.textContent = user?.displayName ? `${greeting} ${user.displayName.split(' ')[0]}! How can I help?` : `${greeting}! How can I help?`;
    });

    // Voice Input
    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SR(); recognition.continuous = false;
      $mic.onclick = () => {
        if (!auth.currentUser) return openSheet('auth');
        recognition.lang = LANGUAGES[currentLang].code;
        recognition.start();
      };
      recognition.onstart = () => { $mic.classList.add('listening'); $i.placeholder = "Listening..."; };
      recognition.onresult = e => { $i.value = e.results[0][0].transcript; sendMessage(); };
      recognition.onend = () => { $mic.classList.remove('listening'); $i.placeholder = "Message Vynix Lingua..."; };
    } else $mic.style.display = 'none';

    initLanguageDropdown();
    updateSystemInstructions();
  </script>
</body>
</html>
