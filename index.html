<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vynix</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body { font-family: system-ui, -apple-system; background: #f3f4f6; margin: 0; padding: 0; }
    .container { max-width: 500px; margin: 0 auto; background: white; min-height: 100vh; padding-bottom: 70px; }
    .header { background: #1877f2; color: white; padding: 12px 16px; font-weight: bold; font-size: 20px; }
    .post { background: white; border-bottom: 1px solid #ddd; padding: 12px; }
    .story-row { overflow-x: auto; white-space: nowrap; padding: 12px 8px; scrollbar-width: none; }
    .story-row::-webkit-scrollbar { display: none; }
    .story { display: inline-block; width: 80px; text-align: center; margin-right: 10px; }
    .story img { width: 72px; height: 72px; border-radius: 50%; border: 3px solid #1877f2; }
    .create-post { padding: 12px; border-bottom: 8px solid #f0f2f5; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 8px 0; max-width: 500px; margin: 0 auto; }
    .bottom-nav button { background: none; border: none; font-size: 28px; color: #65676b; }
    .bottom-nav button.active { color: #1877f2; }
    #toast { @apply fixed top-4 left-1/2 -translate-x-1/2 bg-black text-white px-6 py-3 rounded-full z-50 opacity-0 transition; }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

<div class="container">

  <!-- Header -->
  <div class="header flex justify-between items-center">
    <div>Vynix</div>
    <div class="flex gap-4">
      <button>Search</button>
      <button>Messenger</button>
    </div>
  </div>

  <!-- Stories -->
  <div class="story-row">
    <div class="story">
      <div style="background:#e4e6eb;border-radius:50%;width:72px;height:72px;display:flex;align-items:center;justify-content:center;">
        <span style="font-size:40px;color:#1877f2;">+</span>
      </div>
      <div style="font-size:12px;margin-top:4px;">Your Story</div>
    </div>
    <div class="story">
      <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="">
      <div style="font-size:12px;margin-top:4px;">Sarah</div>
    </div>
    <div class="story">
      <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="">
      <div style="font-size:12px;margin-top:4px;">John</div>
    </div>
    <div class="story">
      <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="">
      <div style="font-size:12px;margin-top:4px;">Emma</div>
    </div>
  </div>

  <!-- Create Post -->
  <div class="create-post">
    <div class="flex gap-3 items-center">
      <div class="w-10 h-10 rounded-full bg-gray-400"></div>
      <input type="text" placeholder="What's on your mind?" class="flex-1 bg-gray-100 rounded-full px-4 py-3 outline-none" onclick="openPost()">
    </div>
    <div class="flex justify-around mt-3 pt-3 border-t">
      <button class="flex items-center gap-2 text-green-600"><span class="material-icons">videocam</span> Live</button>
      <button class="flex items-center gap-2 text-green-600"><span class="material-icons">photo_library</span> Photo</button>
      <button class="flex items-center gap-2 text-purple-600"><span class="material-icons">mood</span> Feeling</button>
    </div>
  </div>

  <!-- Feed -->
  <div id="feed">
    <!-- Posts load here -->
  </div>

</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <button class="active"><span class="material-icons">home</span></button>
  <button><span class="material-icons">people</span></button>
  <button onclick="openPost()"><span class="material-icons">add_box</span></button>
  <button><span class="material-icons">play_circle</span></button>
  <button><span class="material-icons">person</span></button>
</div>

<!-- Post Modal -->
<div id="post-modal" class="hidden fixed inset-0 bg-white z-50 flex flex-col">
  <div class="flex items-center justify-between p-4 border-b">
    <button onclick="closePost()" class="text-2xl">Back</button>
    <h2 class="font-bold text-lg">Create Post</h2>
    <button onclick="submitPost()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">Post</button>
  </div>
  <textarea id="post-text" placeholder="What's on your mind?" class="flex-1 p-4 text-lg outline-none" rows="8"></textarea>
  <input type="file" id="post-media" accept="image/*,video/*" class="p-4 border-t">
</div>

<!-- Toast -->
<div id="toast"></div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
  import { getDatabase, ref, onValue, push, set, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js';

  const app = initializeApp({
    apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
    authDomain: "fire-b-a8878.firebaseapp.com",
    databaseURL: "https://fire-b-a8878.firebaseio.com",
    projectId: "fire-b-a8878",
    storageBucket: "fire-b-a8878.firebasestorage.app",
    appId: "1:658673187627:web:6e4c29af661785f0afa36e"
  });

  const auth = getAuth(app);
  const db = getDatabase(app);
  const storage = getStorage(app);

  const toast = (msg) => {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
  };

  onAuthStateChanged(auth, user => {
    if (!user) location.href = "login.html";
    loadFeed();
  });

  window.openPost = () => document.getElementById('post-modal').classList.remove('hidden');
  window.closePost = () => document.getElementById('post-modal').classList.add('hidden');

  window.submitPost = async () => {
    const text = document.getElementById('post-text').value.trim();
    const file = document.getElementById('post-media').files[0];
    if (!text && !file) return toast("Add text or media");

    let mediaURL = "";
    if (file) {
      const storageRef = sRef(storage, `posts/\( {Date.now()}_ \){file.name}`);
      await uploadBytes(storageRef, file);
      mediaURL = await getDownloadURL(storageRef);
    }

    const postRef = push(ref(db, 'posts'));
    await set(postRef, {
      userId: auth.currentUser.uid,
      userName: auth.currentUser.displayName || "User",
      content: text,
      mediaURL,
      timestamp: serverTimestamp(),
      likes: 0
    });

    document.getElementById('post-text').value = "";
    document.getElementById('post-media').value = "";
    closePost();
    toast("Posted!");
  };

  function loadFeed() {
    onValue(ref(db, 'posts'), snap => {
      const posts = [];
      snap.forEach(child => posts.push({ id: child.key, ...child.val() }));
      posts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

      document.getElementById('feed').innerHTML = posts.map(p => `
        <div class="post">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600"></div>
            <div>
              <div class="font-bold">${p.userName}</div>
              <div class="text-xs text-gray-500">Just now</div>
            </div>
          </div>
          <div class="mb-3">${p.content || ''}</div>
          \( {p.mediaURL ? `<img src=" \){p.mediaURL}" class="w-full rounded-lg mb-3">` : ''}
          <div class="flex justify-between text-gray-600 text-sm">
            <button>Like (${p.likes || 0})</button>
            <button>Comment</button>
            <button>Share</button>
          </div>
        </div>
      `).join('');
    });
  }

  loadFeed();
</script>
</body>
</html>
