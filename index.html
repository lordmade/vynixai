<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Vynix AI • Cross Platform</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet"/>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-remote-config-compat.js"></script>

  <style>
    :root {
      /* ─── PALETTE: Sports/Dark AI ─── */
      --bg-page: #09090B;       /* Deep Black */
      --bg-sidebar: #121214;    /* Dark Panel */
      --bg-surface: #1E1E22;    /* Cards */
      --bg-input-glass: rgba(30, 30, 34, 0.85);
      
      --primary: #6366F1;       /* Indigo */
      --primary-dim: rgba(99, 102, 241, 0.15);
      --accent-gradient: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
      
      --text-main: #FFFFFF;
      --text-muted: #A1A1AA;
      --border: #27272A;
      
      --header-height: 72px;
      --sidebar-width: 260px;
      --sidebar-mini: 80px;
      
      /* Safe Areas for Mobile */
      --safe-bottom: env(safe-area-inset-bottom, 20px);
    }

    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    
    body {
      background: var(--bg-page);
      color: var(--text-main);
      font-family: 'Plus Jakarta Sans', sans-serif;
      height: 100vh;
      display: flex;
      overflow: hidden;
      width: 100%;
    }

    /* ─── 1. RESPONSIVE SIDEBAR ─── */
    .sidebar {
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      z-index: 50;
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* Desktop: Mini by default, expand on hover */
    @media (min-width: 769px) {
      .sidebar { width: var(--sidebar-mini); position: relative; }
      .sidebar:hover { width: var(--sidebar-width); }
      
      /* Hide text when collapsed */
      .sidebar:not(:hover) .nav-text,
      .sidebar:not(:hover) .brand-text,
      .sidebar:not(:hover) .user-info { 
        opacity: 0; pointer-events: none; width: 0; overflow: hidden;
      }
      .logo-container { padding-left: 4px; }
      .hamburger { display: none !important; }
      .overlay { display: none; }
    }

    /* Mobile: Off-canvas drawer */
    @media (max-width: 768px) {
      .sidebar { 
        position: fixed; top: 0; left: 0; bottom: 0;
        width: var(--sidebar-width); 
        transform: translateX(-100%);
        box-shadow: 10px 0 40px rgba(0,0,0,0.5);
      }
      .sidebar.open { transform: translateX(0); }
      .overlay { 
        position: fixed; inset: 0; background: rgba(0,0,0,0.6); 
        backdrop-filter: blur(4px); z-index: 40; 
        opacity: 0; visibility: hidden; transition: 0.3s; 
      }
      .overlay.active { opacity: 1; visibility: visible; }
    }

    .sidebar-header { height: 80px; display: flex; align-items: center; padding: 0 22px; overflow: hidden; white-space: nowrap; }
    .logo-container { display: flex; align-items: center; gap: 14px; }
    .brand-logo { 
      width: 36px; height: 36px; flex-shrink: 0;
      background: var(--accent-gradient); 
      border-radius: 10px; 
      display: flex; align-items: center; justify-content: center; 
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
    }
    .brand-text { font-weight: 700; font-size: 1.1rem; color: #fff; letter-spacing: -0.5px; transition: opacity 0.2s; }

    .nav-links { flex: 1; padding: 20px 14px; display: flex; flex-direction: column; gap: 8px; }
    .nav-item {
      display: flex; align-items: center; gap: 14px;
      padding: 12px; border-radius: 16px;
      color: var(--text-muted); cursor: pointer;
      transition: all 0.2s; white-space: nowrap;
    }
    .nav-item:hover, .nav-item.active { background: var(--bg-surface); color: white; }
    .nav-item .material-symbols-rounded { font-size: 24px; flex-shrink: 0; }
    .nav-text { font-weight: 500; font-size: 0.95rem; transition: opacity 0.3s; }

    .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); }
    .user-profile { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 12px; margin-bottom: 8px; overflow: hidden; }
    .user-avatar { width: 36px; height: 36px; border-radius: 10px; background: #333; flex-shrink: 0; border: 1px solid var(--border); background-size: cover; }

    /* ─── 2. MAIN LAYOUT ─── */
    .main-wrapper { flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg-page); }
    
    /* Responsive Header */
    .header { 
      height: var(--header-height); 
      padding: 0 24px; 
      display: flex; align-items: center; justify-content: space-between; 
      z-index: 10;
      position: absolute; top: 0; left: 0; right: 0;
      background: linear-gradient(180deg, var(--bg-page) 20%, rgba(9,9,11,0) 100%);
    }
    
    .header-left { display: flex; align-items: center; gap: 16px; }
    .hamburger { background: none; border: none; color: white; cursor: pointer; padding: 8px; margin-left: -8px; }
    
    /* Hide Title on small mobile to fit selectors */
    @media (max-width: 450px) { .page-title { display: none; } }
    .page-title { font-size: 1.1rem; font-weight: 700; color: white; }

    /* Glass Pills for Selectors */
    .selector-group { 
      display: flex; gap: 8px; 
      background: rgba(255,255,255,0.04); 
      padding: 4px; border-radius: 30px; 
      border: 1px solid var(--border); 
      backdrop-filter: blur(10px);
    }
    select { 
      padding: 6px 12px; border: none; border-radius: 20px; 
      font-size: 0.8rem; font-weight: 600; color: var(--text-muted); 
      background: transparent; outline: none; appearance: none; 
      cursor: pointer; transition: all 0.2s;
    }
    select:hover { color: white; background: rgba(255,255,255,0.06); }
    select:focus { background: var(--bg-surface); color: white; }
    option { background: var(--bg-surface); color: white; }

    /* ─── 3. CHAT VIEW ─── */
    .view { display: flex; flex-direction: column; flex: 1; height: 100%; pt: var(--header-height); }
    
    .chat-container {
      flex: 1;
      overflow-y: auto;
      scroll-behavior: smooth;
      padding: 90px 20px 140px; /* Top padding for header, Bottom for input */
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

    .message { display: flex; flex-direction: column; max-width: 80%; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .message.user { align-self: flex-end; align-items: flex-end; max-width: 75%; }
    .message.ai { align-self: flex-start; align-items: flex-start; max-width: 85%; }

    /* Mobile: Widen bubbles */
    @media (max-width: 600px) {
      .message.user { max-width: 85%; }
      .message.ai { max-width: 95%; }
      .chat-container { padding-inline: 16px; }
    }

    .msg-bubble {
      padding: 14px 20px;
      font-size: 0.98rem;
      line-height: 1.6;
      border-radius: 22px;
      position: relative;
      word-wrap: break-word;
    }

    /* User: Gradient Pill */
    .message.user .msg-bubble {
      background: var(--accent-gradient);
      color: white;
      border-bottom-right-radius: 4px;
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.25);
    }

    /* AI: Glass Card */
    .message.ai .msg-bubble {
      background: var(--bg-surface);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-bottom-left-radius: 4px;
    }

    .msg-time { font-size: 0.7rem; color: #666; margin-top: 6px; font-weight: 500; margin-left: 4px; }

    /* ─── 4. FLOATING INPUT CAPSULE ─── */
    .input-bar {
      position: absolute; 
      left: 50%; transform: translateX(-50%);
      background: var(--bg-input-glass);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 100px;
      padding: 6px 6px 6px 24px;
      display: flex; align-items: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      z-index: 20;
      transition: all 0.3s ease;
    }

    /* Responsive Input Positioning */
    @media (min-width: 769px) {
      .input-bar { bottom: 40px; width: 700px; max-width: 90%; }
      .input-bar:focus-within { width: 720px; border-color: rgba(99, 102, 241, 0.4); }
    }
    
    @media (max-width: 768px) {
      .input-bar { 
        bottom: 24px; 
        width: calc(100% - 32px); /* 16px margin on sides */
        padding-left: 16px;
      }
    }

    .input-bar input {
      flex: 1; border: none; outline: none; background: transparent;
      font-family: inherit; font-size: 1rem;
      color: white; padding-right: 12px; height: 44px;
    }
    .input-bar input::placeholder { color: #555; }

    .send-btn {
      width: 44px; height: 44px;
      background: var(--text-main); color: black;
      border: none; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: transform 0.2s; flex-shrink: 0;
    }
    .send-btn:active { transform: scale(0.9); }

    /* Typing Indicator */
    .typing-indicator {
      display: none; gap: 6px; padding: 12px 18px;
      background: var(--bg-surface); border-radius: 16px;
      width: fit-content; margin-bottom: 20px; border: 1px solid var(--border);
    }
    .dot { width: 6px; height: 6px; background: #666; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
    .dot:nth-child(1) { animation-delay: -0.32s; }
    .dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    /* Auth Modal (Responsive) */
    .auth-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; opacity: 0; visibility: hidden; transition: 0.3s; backdrop-filter: blur(8px); }
    .auth-backdrop.active { opacity: 1; visibility: visible; }
    
    .auth-container { 
      position: fixed; z-index: 101; 
      background: #141416; border: 1px solid var(--border);
      box-shadow: 0 40px 100px rgba(0,0,0,0.8); 
      transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
      opacity: 0; transform: scale(0.95);
    }
    .auth-container.active { opacity: 1; transform: scale(1); }
    
    @media (min-width: 769px) {
      .auth-container { 
        top: 50%; left: 50%; translate: -50% -50%; 
        width: 400px; border-radius: 24px;
      }
    }
    @media (max-width: 768px) {
      .auth-container {
        bottom: 0; left: 0; right: 0; width: 100%;
        border-radius: 24px 24px 0 0;
        transform: translateY(100%);
      }
      .auth-container.active { transform: translateY(0); }
    }

    .auth-content { padding: 40px 30px; display: flex; flex-direction: column; align-items: center; text-align: center; }
    .auth-btn { 
      width: 100%; padding: 14px; margin-top: 24px; 
      border-radius: 14px; font-weight: 600; cursor: pointer; 
      display: flex; align-items: center; justify-content: center; gap: 12px; 
      border: 1px solid #333; background: #222; color: white;
    }
    .shimmer {
      background: linear-gradient(90deg, #1E1E22 25%, #2A2A2E 37%, #1E1E22 63%);
      background-size: 200% 100%; animation: shimmer 2s infinite linear; border-radius: 8px;
    }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* KaTeX Adjustments */
    .katex { font-size: 1.1em; color: #ececec; }
  </style>
</head>
<body>

  <div id="authBackdrop" class="auth-backdrop"></div>
  <div id="authContainer" class="auth-container">
    <div class="auth-content">
      <h2 style="font-size:1.8rem; margin-bottom:8px;">Vynix AI</h2>
      <p style="color:var(--text-muted);">Sign in to access the tutor.</p>
      <button class="auth-btn" id="googleSignInBtn" onclick="signInWithGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" alt="G">
        <span>Continue with Google</span>
      </button>
    </div>
  </div>

  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
  
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="brand-logo"><span class="material-symbols-rounded">bolt</span></div>
        <span class="brand-text">Vynix AI</span>
      </div>
    </div>
    <div class="nav-links">
      <div class="nav-item active">
        <span class="material-symbols-rounded">chat_bubble</span>
        <span class="nav-text">Chat</span>
      </div>
      <div class="nav-item">
        <span class="material-symbols-rounded">library_books</span>
        <span class="nav-text">Library</span>
      </div>
      <div class="nav-item">
        <span class="material-symbols-rounded">history</span>
        <span class="nav-text">History</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <div class="user-profile" id="userProfile">
        <div class="user-avatar" id="userAvatar"></div>
        <div class="user-info">
          <div style="font-weight:600; font-size:0.9rem" id="userDisplayName">Guest</div>
          <div style="font-size:0.75rem; color:var(--text-muted)" id="userEmail"></div>
        </div>
      </div>
      <div class="nav-item" id="signOutBtn">
        <span class="material-symbols-rounded">logout</span>
        <span class="nav-text">Sign Out</span>
      </div>
    </div>
  </nav>

  <div class="main-wrapper">
    <header class="header">
      <div class="header-left">
        <button class="hamburger" onclick="toggleSidebar()">
          <span class="material-symbols-rounded">menu</span>
        </button>
        <h1 class="page-title">AI Tutor</h1>
      </div>
      <div class="selector-group">
        <select id="gradeSelect">
          <option>Grade 10</option>
          <option>Grade 11</option>
          <option selected>Grade 12</option>
        </select>
        <select id="subjectSelect">
          <option>Math</option>
          <option>Physics</option>
          <option>Life Sci</option>
        </select>
      </div>
    </header>

    <div class="view">
      <main class="chat-container" id="chatContainer">
        <div class="message ai" id="welcomeMessage">
          <div class="msg-bubble shimmer" style="width:180px; height:60px;"></div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
          <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
      </main>
      
      <div class="input-bar">
        <input type="text" id="userInput" placeholder="Ask a question..." autocomplete="off">
        <button id="sendBtn" class="send-btn">
          <span class="material-symbols-rounded">arrow_upward</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ─── UI LOGIC ─── */
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('active');
    }

    function showAuthUI() {
      document.getElementById('authBackdrop').classList.add('active');
      document.getElementById('authContainer').classList.add('active');
    }
    function closeAuth() {
      document.getElementById('authBackdrop').classList.remove('active');
      document.getElementById('authContainer').classList.remove('active');
    }

    /* ─── FIREBASE INIT ─── */
    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      projectId: "fire-b-a8878",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const remoteConfig = firebase.remoteConfig();
    let XAI_API_KEY = "";
    const MODEL_ID = "grok-4-1-fast-reasoning";

    /* ─── AUTH HANDLERS ─── */
    const googleBtn = document.getElementById('googleSignInBtn');
    function signInWithGoogle() {
      googleBtn.style.opacity = "0.5";
      auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(err => {
        alert(err.message);
        googleBtn.style.opacity = "1";
      });
    }

    auth.onAuthStateChanged(user => {
      const welcomeBubble = document.querySelector('#welcomeMessage .msg-bubble');
      if (!user) {
        showAuthUI();
        if(welcomeBubble) {
          welcomeBubble.classList.add('shimmer');
          welcomeBubble.textContent = '';
        }
      } else {
        closeAuth();
        initConfig();
        const name = user.displayName?.split(" ")[0] || "Student";
        const photo = user.photoURL || `https://ui-avatars.com/api/?name=${name}&background=6366F1&color=fff`;
        
        document.getElementById('userDisplayName').textContent = name;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userAvatar').style.backgroundImage = `url("${photo}")`;
        
        if(welcomeBubble) {
          welcomeBubble.classList.remove('shimmer');
          welcomeBubble.style.width = 'auto';
          welcomeBubble.style.height = 'auto';
          welcomeBubble.innerHTML = `<strong>Hello ${name}.</strong><br>I'm ready to help with ${document.getElementById('subjectSelect').value}.`;
        }
      }
    });

    async function initConfig() {
      remoteConfig.settings = { minimumFetchIntervalMillis: 0 };
      try {
        await remoteConfig.fetchAndActivate();
        XAI_API_KEY = remoteConfig.getValue('xai_api_key').asString();
      } catch(e) { console.log(e); }
    }

    /* ─── CHAT LOGIC ─── */
    function appendMessage(role, text) {
      const chat = document.getElementById('chatContainer');
      const div = document.createElement('div');
      div.className = `message ${role}`;
      div.innerHTML = `
        <div class="msg-bubble">${text.replace(/\n/g, '<br>')}</div>
        <div class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
      `;
      chat.insertBefore(div, document.getElementById('typingIndicator'));
      chat.scrollTop = chat.scrollHeight;
      
      if(window.renderMathInElement) {
        renderMathInElement(div, { delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false}
        ]});
      }
    }

    async function sendMessage() {
      const input = document.getElementById('userInput');
      const text = input.value.trim();
      if(!text || !XAI_API_KEY) return;
      
      appendMessage('user', text);
      input.value = '';
      document.getElementById('typingIndicator').style.display = 'flex';
      
      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {
          method: "POST",
          headers: { "Authorization": `Bearer ${XAI_API_KEY}`, "Content-Type": "application/json" },
          body: JSON.stringify({
            model: MODEL_ID,
            messages: [
              {role: "system", content: "You are Vynix AI, a CAPS tutor. Be concise. Use LaTeX for math."},
              {role: "user", content: text}
            ],
            temperature: 0.7
          })
        });
        const data = await res.json();
        appendMessage('ai', data.choices[0].message.content);
      } catch(e) {
        appendMessage('ai', "Error connecting to AI.");
      } finally {
        document.getElementById('typingIndicator').style.display = 'none';
      }
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('userInput').onkeypress = e => { if(e.key==='Enter') sendMessage(); };
    document.getElementById('signOutBtn').onclick = () => auth.signOut();
  </script>
</body>
</html>
