<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Mxit 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>
  <style>
    :root { --mxit: #00ff41; --dark: #0a0a0a; --card: rgba(20,20,20,0.8); }
    body.light { --mxit: #00cc33; --dark: #f0f0f0; --card: rgba(255,255,255,0.9); background:#fff; color:#000; }
    body { margin:0; height:100vh; background:var(--dark); color:#fff; font-family:'Segoe UI',sans-serif; overflow:hidden; backdrop-filter:blur(10px); }
    .header { background:var(--mxit); color:#000; padding:12px; font-weight:900; font-size:20px; text-align:center; position:fixed; top:0; left:0; right:0; z-index:100; box-shadow:0 4px 20px rgba(0,255,65,0.4); }
    .status { background:#000; color:var(--mxit); padding:6px; font-size:12px; text-align:center; }
    .chat { display:flex; flex-direction:column; height:100vh; padding-top:60px; }
    .messages { flex:1; overflow-y:auto; padding:16px; scrollbar-width:none; }
    .messages::-webkit-scrollbar { display:none; }
    .msg { max-width:80%; margin:8px 0; padding:10px 14px; border-radius:18px; position:relative; animation:fadeIn 0.4s; }
    .msg.me { background:var(--mxit); color:#000; align-self:flex-end; border-bottom-right-radius:4px; }
    .msg.other { background:#333; color:#fff; align-self:flex-start; border-bottom-left-radius:4px; }
    .name { font-size:11px; color:var(--mxit); font-weight:bold; margin-bottom:4px; }
    .time { font-size:10px; color:#888; margin-top:4px; }
    .input-bar { background:var(--card); backdrop-filter:blur(20px); padding:12px; display:flex; gap:10px; align-items:center; border-top:1px solid #333; }
    input { flex:1; background:#222; color:#fff; border:none; padding:14px 18px; border-radius:30px; outline:none; font-size:16px; }
    body.light input { background:#eee; color:#000; }
    button { background:var(--mxit); color:#000; width:48px; height:48px; border-radius:50%; border:none; font-size:20px; font-weight:bold; box-shadow:0 4px 15px rgba(0,255,65,0.5); }
    .voice-btn { background:#ff2d55; }
    .typing { color:#666; font-style:italic; padding:0 16px; animation:pulse 1.5s infinite; }
    .reaction { position:absolute; bottom:-10px; right:10px; background:#222; padding:4px 8px; border-radius:12px; font-size:12px; }
    .online { width:10px; height:10px; background:var(--mxit); border-radius:50%; position:absolute; bottom:4px; right:4px; box-shadow:0 0 10px var(--mxit); animation:glow 2s infinite; }
    audio { display:none; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:none} }
    @keyframes glow { 0%,100%{box-shadow:0 0 10px var(--mxit)} 50%{box-shadow:0 0 20px var(--mxit)} }
    @keyframes pulse { 0%,100%{opacity:0.6} 50%{opacity:1} }
    .beep { animation:beep 0.3s; }
    @keyframes beep { 0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)} }
  </style>
</head>
<body class="dark">

  <div class="header">MXIT 2025</div>
  <div class="status">Connected • 48,291 users online worldwide</div>

  <div class="chat">
    <div class="messages" id="messages">
      <div style="text-align:center; padding:40px; color:#666;">
        <h2 style="color:var(--mxit);">Welcome back to Mxit!</h2>
        <p>The legend is back — better, faster, greener.</p>
      </div>
    </div>

    <div class="typing" id="typing"></div>

    <div class="input-bar">
      <button onclick="insertEmoji()">Smile</button>
      <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">Mic</button>
      <input type="text" id="input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') send()">
      <button onclick="send()">Send</button>
      <button onclick="document.body.classList.toggle('light')">Theme</button>
    </div>
  </div>

  <audio id="beep" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js';
    import { getDatabase, ref, push, onValue, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js';
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js';

    const app = initializeApp({
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    });

    const db = getDatabase(app);
    const storage = getStorage(app);
    const messagesRef = ref(db, 'mxit2025');

    let myName = localStorage.getItem('mxitName') || "MxitUser" + Math.floor(Math.random()*9999);
    if (!localStorage.getItem('mxitName')) localStorage.setItem('mxitName', myName);

    let recorder, audioBlob;
    let isRecording = false;

    onValue(messagesRef, (snapshot) => {
      const messages = document.getElementById('messages');
      messages.innerHTML = '';
      snapshot.forEach(child => {
        const msg = child.val();
        const div = document.createElement('div');
        div.className = `msg ${msg.name === myName ? 'me' : 'other'}`;
        const time = new Date(msg.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        
        let content = msg.text || '';
        if (msg.image) content = `<img src="${msg.image}" style="max-width:100%; border-radius:12px; margin:8px 0;">`;
        if (msg.voice) content = `<audio src="${msg.voice}" controls style="width:100%; margin:8px 0;"></audio>`;

        div.innerHTML = `
          ${msg.name !== myName ? `<div class="name">${msg.name}</div>` : ''}
          ${content}
          <div class="time">${time}</div>
          ${msg.reactions ? `<div class="reaction">${msg.reactions}</div>` : ''}
        `;
        messages.appendChild(div);
      });
      messages.scrollTop = messages.scrollHeight;
      if (snapshot.size > document.querySelectorAll('.msg').length + 5) beep();
    });

    window.send = () => {
      const input = document.getElementById('input');
      const text = input.value.trim();
      if (!text) return;
      push(messagesRef, {
        name: myName,
        text: text.replace(/:\)/g,'Smile').replace(/:\(/g,'Sad').replace(/<3/g,'Heart'),
        time: serverTimestamp()
      });
      input.value = '';
      beep();
    };

    window.insertEmoji = () => {
      const emojis = ["Smile","Heart","Laugh","Fire","Cry","Thumbs Up","100","South Africa","Mexico","Nigeria"];
      const random = emojis[Math.floor(Math.random() * emojis.length)];
      document.getElementById('input').value += random + " ";
    };

    window.toggleVoice = () => {
      if (isRecording) {
        recorder.stop();
        isRecording = false;
        document.getElementById('voiceBtn').textContent = "Mic";
        return;
      }
      navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        recorder = new MediaRecorder(stream);
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = async () => {
          audioBlob = new Blob(chunks, { type: 'audio/webm' });
          const storageRef = sRef(storage, 'voice/' + Date.now() + '.webm');
          await uploadBytes(storageRef, audioBlob);
          const url = await getDownloadURL(storageRef);
          push(messagesRef, { name: myName, voice: url, time: serverTimestamp() });
        };
        recorder.start();
        isRecording = true;
        document.getElementById('voiceBtn').textContent = "Stop";
      });
    };

    document.getElementById('input').addEventListener('input', () => {
      document.getElementById('typing').textContent = "You are typing...";
      setTimeout(() => document.getElementById('typing').textContent = "", 2000);
    });

    function beep() {
      document.getElementById('beep').play();
      document.querySelector('.header').classList.add('beep');
      setTimeout(() => document.querySelector('.header').classList.remove('beep'), 300);
    }

    // Auto welcome message
    setTimeout(() => {
      if (document.querySelectorAll('.msg').length === 1) {
        push(messagesRef, {
          name: "Mxit Bot",
          text: `Heita ${myName.split(' ')[0]}! Welcome back to Mxit 2025! The legend lives Heart`,
          time: serverTimestamp()
        });
      }
    }, 2000);
  </script>
</body>
</html>
