<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mxit 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.cdnfonts.com/css/mxit" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body { font-family: 'Mxit', Arial; background: #000; color: #0f0; min-height: 100vh; }
    .mxit { background: linear-gradient(135deg, #003366, #000); }
    .chat { background: #001122; border: 2px solid #00ff00; border-radius: 12px; }
    .msg { background: #002244; border-radius: 12px 12px 12px 0; margin: 8px; padding: 10px; max-width: 80%; }
    .msg.me { background: #00ff00; color: #000; border-radius: 12px 12px 0 12px; margin-left: auto; }
    .mood { position: fixed; top: 20px; right: 20px; background: #00ff00; color: #000; padding: 8px 16px; border-radius: 30px; font-weight: bold; }
    #splash { position: fixed; inset: 0; background: #000 url('https://i.imgur.com/8bWvZ3g.gif') center no-repeat; background-size: contain; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #0f0; }
    .blink { animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body class="mxit text-green-400">

  <!-- MXIT SPLASH SCREEN -->
  <div id="splash">
    <h1 class="text-6xl font-bold blink">MXIT</h1>
    <p class="text-2xl mt-10">Loading your world...</p>
  </div>

  <div class="p-4 hidden" id="main">

    <!-- Mood -->
    <div class="mood" id="mood">Happy</div>

    <!-- Header -->
    <header class="text-center py-4 border-b-4 border-green-500">
      <h1 class="text-4xl font-bold">MXIT 2025</h1>
      <p>Welcome back, <span id="username">User</span>!</p>
    </header>

    <!-- Chat Rooms -->
    <div class="grid grid-cols-2 gap-4 my-6">
      <button onclick="joinRoom('southafrica')" class="chat p-6 text-center text-2xl hover:bg-green-900 transition">
        South Africa
      </button>
      <button onclick="joinRoom('tradepost')" class="chat p-6 text-center text-2xl hover:bg-green-900 transition">
        Tradepost
      </button>
      <button onclick="joinRoom('gallery')" class="chat p-6 text-center text-2xl hover:bg-green-900 transition">
        Gallery
      </button>
      <button onclick="joinRoom('random')" class="chat p-6 text-center text-2xl hover:bg-green-900 transition">
        Random Chat
      </button>
    </div>

    <!-- Active Chat -->
    <div id="chat-container" class="hidden">
      <div class="flex justify-between items-center bg-black p-4 border-b-4 border-green-500">
        <button onclick="leaveRoom()" class="text-3xl">Back</button>
        <h2 id="room-name" class="text-2xl font-bold">Chat Room</h2>
        <button onclick="nudge()" class="text-3xl animate-bounce">Nudge</button>
      </div>

      <div id="messages" class="h-96 overflow-y-auto p-4 space-y-4"></div>

      <div class="flex gap-2 p-4 border-t-4 border-green-500">
        <input type="text" id="msg-input" placeholder="Type a message..." class="flex-1 bg-black border-2 border-green-500 rounded-full px-6 py-3 outline-none text-green-400">
        <button onclick="sendMessage()" class="bg-green-500 text-black px-8 py-3 rounded-full font-bold hover:bg-green-400 transition">Send</button>
      </div>
    </div>

    <!-- Voice Note -->
    <div class="text-center my-6">
      <button onclick="startVoice()" class="bg-green-500 text-black px-8 py-4 rounded-full text-xl font-bold hover:bg-green-400 transition">
        Hold to Record Voice Note
      </button>
    </div>

  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getDatabase, ref, onValue, push, set, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

    const app = initializeApp({
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    });

    const auth = getAuth(app);
    const db = getDatabase(app);
    let currentUser = null;
    let currentRoom = null;

    // Hide splash after 3 seconds
    setTimeout(() => {
      document.getElementById('splash').remove();
      document.getElementById('main').classList.remove('hidden');
    }, 3000);

    onAuthStateChanged(auth, user => {
      currentUser = user;
      if (user) {
        document.getElementById('username').textContent = user.displayName || user.email.split('@')[0];
      }
    });

    window.joinRoom = (room) => {
      currentRoom = room;
      document.getElementById('room-name').textContent = room.replace(/^\w/, c => c.toUpperCase());
      document.getElementById('chat-container').classList.remove('hidden');
      document.getElementById('messages').innerHTML = '';

      onValue(ref(db, `mxit/${room}`), snap => {
        const msgs = [];
        snap.forEach(child => {
          const m = child.val();
          const isMe = m.uid === currentUser.uid;
          msgs.push(`
            <div class="flex ${isMe ? 'justify-end' : ''}">
              <div class="${isMe ? 'msg me' : 'msg'}">
                <strong>\( {m.name}:</strong> \){m.text}
                <div class="text-xs opacity-70">${new Date(m.time).toLocaleTimeString()}</div>
              </div>
            </div>
          `);
        });
        document.getElementById('messages').innerHTML = msgs.join('');
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
      });
    };

    window.leaveRoom = () => {
      currentRoom = null;
      document.getElementById('chat-container').classList.add('hidden');
    };

    window.sendMessage = () => {
      const input = document.getElementById('msg-input');
      const text = input.value.trim();
      if (!text || !currentRoom) return;

      push(ref(db, `mxit/${currentRoom}`), {
        uid: currentUser.uid,
        name: currentUser.displayName || "User",
        text,
        time: Date.now()
      });

      input.value = '';
    };

    window.nudge = () => {
      push(ref(db, `mxit/${currentRoom}`), {
        uid: currentUser.uid,
        name: currentUser.displayName || "User",
        text: " sent you a nudge!",
        time: Date.now(),
        nudge: true
      });
      alert("NUDGE SENT!");
    };

    window.startVoice = () => {
      alert("Voice notes coming soon! Hold tight");
    };

    // Enter to send
    document.getElementById('msg-input')?.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>
