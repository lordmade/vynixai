<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vynix Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">
 
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --accent-purple: #d946ef;
            --accent-green: #10b981;
            --logo-gradient: linear-gradient(135deg, #000000 0%, var(--accent-purple) 50%, var(--accent-green) 100%);
        }
      
        /* Prevent text selection and long-press context menu globally */
        * {
            -webkit-user-select: none; /* Chrome/Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE/Edge */
            user-select: none; /* Standard */
          
            -webkit-touch-callout: none; /* Disable long-press callout (iOS Safari) */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
        }
      
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #ffffff;
            position: relative;
        }
        .logo-icon {
            font-size: 80px;
            background: var(--logo-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        h2 { font-weight: 700; margin: 0; font-size: 32px; }
        p { color: #666; margin-bottom: 40px; }
        /* Google Button Style */
        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            color: #1f1f1f;
            border: 1px solid #dadce0;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            max-width: 280px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background 0.2s, box-shadow 0.2s;
        }
        .google-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .google-btn img {
            width: 20px;
            margin-right: 12px;
        }
        /* Driver Button */
        .driver-btn {
            margin-top: 20px;
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            max-width: 280px;
            box-shadow: 0 4px 12px rgba(217, 70, 239, 0.3);
        }
        #loader { display: none; margin-top: 20px; font-size: 14px; color: var(--accent-purple); }
        /* Bottom Sheet for Driver Signup */
        #driverSheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 28px;
            border-top-right-radius: 28px;
            padding: 30px 24px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
            transition: bottom 0.4s cubic-bezier(0.33, 1, 0.68, 1);
            z-index: 50;
            max-height: 90vh;
            overflow-y: auto;
        }
        #driverSheet.open {
            bottom: 0;
        }
        .sheet-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .sheet-header h3 {
            font-size: 20px;
            font-weight: 700;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #444;
        }
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            -webkit-user-select: text;
            user-select: text;
        }
        .photo-upload {
            text-align: center;
            margin-bottom: 20px;
        }
        #driverPhotoPreview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #eee;
            margin-bottom: 12px;
            display: none;
        }
        .upload-btn {
            background: #f3f4f6;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: inline-block;
        }
        .submit-driver {
            width: 100%;
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        #sheetLoader { display: none; text-align: center; margin-top: 20px; color: var(--accent-purple); }
        /* Overlay for sheet */
        #sheetOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
        }
        #sheetOverlay.open {
            opacity: 1;
            visibility: visible;
        }
        /* Custom Alert Modal */
        #customAlert {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .alert-box {
            background: white;
            border-radius: 20px;
            padding: 24px;
            width: 90%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .alert-box h4 {
            font-size: 18px;
            margin-bottom: 12px;
        }
        .alert-box p {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
        }
        .alert-btn {
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <span class="material-symbols-rounded logo-icon">auto_awesome</span>
    <h2>Vynix</h2>
    <p>Sign in to start chatting</p>
    <button class="google-btn" onclick="signInWithGoogle()">
        <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" alt="Google Logo">
        Continue with Google
    </button>
    <button class="driver-btn" onclick="openDriverSheet()">
        Become a Driver
    </button>
    <div id="loader">Signing you in...</div>

    <!-- Driver Signup Bottom Sheet -->
    <div id="sheetOverlay" onclick="closeDriverSheet()"></div>
    <div id="driverSheet">
        <div class="sheet-header">
            <h3>Become a Vynix Driver</h3>
            <p>Fill in your details to join as a driver</p>
        </div>
        <div class="photo-upload">
            <img id="driverPhotoPreview" src="" alt="Driver Photo">
            <label class="upload-btn">
                Upload Photo
                <input type="file" id="driverPhotoInput" accept="image/*" style="display:none;">
            </label>
        </div>
        <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="driverName" placeholder="John Doe">
        </div>
        <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="driverPhone" placeholder="+27 ...">
        </div>
        <div class="form-group">
            <label>Vehicle Model</label>
            <input type="text" id="driverVehicle" placeholder="Toyota Corolla 2020">
        </div>
        <div class="form-group">
            <label>License Plate</label>
            <input type="text" id="driverPlate" placeholder="ABC 123 GP">
        </div>
        <button class="submit-driver" onclick="submitDriverApplication()">
            Submit Application
        </button>
        <div id="sheetLoader">Submitting...</div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlert">
        <div class="alert-box">
            <h4 id="alertTitle">Title</h4>
            <p id="alertMessage">Message</p>
            <button class="alert-btn" onclick="closeCustomAlert()">OK</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
          authDomain: "fire-b-a8878.firebaseapp.com",
          databaseURL: "https://fire-b-a8878.firebaseio.com",
          projectId: "fire-b-a8878",
          storageBucket: "fire-b-a8878.firebasestorage.app",
          messagingSenderId: "658673187627",
          appId: "1:658673187627:web:6e4c29af661785f0afa36e"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Cloudinary configuration
        const CLOUDINARY_CLOUD_NAME = "dqkujefxj";
        const CLOUDINARY_UPLOAD_PRESET = "banter_box";

        let selectedPhotoFile = null;

        // Photo preview and selection
        document.getElementById('driverPhotoInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                selectedPhotoFile = file;
                const preview = document.getElementById('driverPhotoPreview');
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
            }
        });

        // Custom Alert Functions
        function showCustomAlert(title, message) {
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMessage').innerText = message;
            document.getElementById('customAlert').style.display = 'flex';
        }

        function closeCustomAlert() {
            document.getElementById('customAlert').style.display = 'none';
        }

        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            const loader = document.getElementById('loader');
            loader.style.display = "block";
            firebase.auth().signInWithPopup(provider)
                .then((result) => {
                    window.location.href = "community.html";
                })
                .catch((error) => {
                    loader.style.display = "none";
                    console.error("Auth Error:", error);
                    showCustomAlert("Sign In Failed", error.message);
                });
        }

        function openDriverSheet() {
            document.getElementById('driverSheet').classList.add('open');
            document.getElementById('sheetOverlay').classList.add('open');
        }

        function closeDriverSheet() {
            document.getElementById('driverSheet').classList.remove('open');
            document.getElementById('sheetOverlay').classList.remove('open');
            // Reset form
            selectedPhotoFile = null;
            document.getElementById('driverPhotoPreview').style.display = 'none';
            document.getElementById('driverPhotoInput').value = '';
            document.getElementById('driverName').value = '';
            document.getElementById('driverPhone').value = '';
            document.getElementById('driverVehicle').value = '';
            document.getElementById('driverPlate').value = '';
        }

        async function uploadPhotoToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) {
                throw new Error('Photo upload failed');
            }
            const data = await response.json();
            return data.secure_url;
        }

        async function submitDriverApplication() {
            const name = document.getElementById('driverName').value.trim();
            const phone = document.getElementById('driverPhone').value.trim();
            const vehicle = document.getElementById('driverVehicle').value.trim();
            const plate = document.getElementById('driverPlate').value.trim();

            if (!name || !phone || !vehicle || !plate) {
                showCustomAlert("Missing Fields", "Please fill in all text fields.");
                return;
            }

            if (!selectedPhotoFile) {
                showCustomAlert("Photo Required", "Please upload a profile photo.");
                return;
            }

            const sheetLoader = document.getElementById('sheetLoader');
            sheetLoader.style.display = "block";

            try {
                const photoUrl = await uploadPhotoToCloudinary(selectedPhotoFile);

                const userCred = await firebase.auth().signInAnonymously();
                const uid = userCred.user.uid;
                const email = `driver_${uid}@vynix.internal`;

                await db.ref(`users/${uid}/profile`).set({
                    name: name,
                    phone: phone,
                    photoUrl: photoUrl,
                    role: 'driver',
                    isDriver: true
                });

                await db.ref(`drivers/${uid}`).set({
                    name: name,
                    phone: phone,
                    vehicle: vehicle,
                    plate: plate,
                    email: email,
                    photoUrl: photoUrl,
                    status: 'pending',
                    ts: Date.now()
                });

                sheetLoader.style.display = "none";
                showCustomAlert("Success!", "Driver application submitted successfully!");
                setTimeout(() => {
                    closeCustomAlert();
                    closeDriverSheet();
                    window.location.href = "community.html";
                }, 2000);
            } catch (error) {
                sheetLoader.style.display = "none";
                console.error("Driver signup error:", error);
                showCustomAlert("Submission Failed", error.message || "An error occurred. Please try again.");
            }
        }
    </script>
</body>
</html>
