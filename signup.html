<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Banter Box - Sign In / Sign Up</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <style>
    :root {
      --accent: #25D366;
      --background: #F0F2F5;
      --foreground: #FFFFFF;
      --text: #111B21;
      --secondary-text: #8696A0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
      background: var(--background);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .auth-container {
      background: var(--foreground);
      border-radius: 16px;
      padding: 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-header h1 {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text);
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .auth-form input,
    .auth-form select {
      padding: 0.75rem;
      border: 1px solid #D1D7DB;
      border-radius: 8px;
      font-size: 1rem;
      width: 100%;
      outline: none;
    }

    .auth-form input:focus,
    .auth-form select:focus {
      border-color: var(--accent);
    }

    .auth-form button {
      background: var(--accent);
      color: #FFFFFF;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .auth-form button:hover {
      background: #20B85A;
    }

    .auth-toggle {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.9rem;
    }

    .auth-toggle a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    .auth-toggle a:hover {
      text-decoration: underline;
    }

    .error-message {
      color: #D32F2F;
      font-size: 0.875rem;
      text-align: center;
      margin-top: 0.5rem;
      display: none;
    }

    .shimmer {
      background: linear-gradient(90deg, #F0F0F0 25%, #E0E0E0 50%, #F0F0F0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    @media (max-width: 640px) {
      .auth-container {
        padding: 1.5rem;
        max-width: 90%;
      }

      .auth-header h1 {
        font-size: 1.25rem;
      }

      .auth-form input,
      .auth-form select,
      .auth-form button {
        font-size: 0.9rem;
        padding: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="auth-container" id="auth-container">
    <div class="auth-header">
      <h1 id="form-title">Sign In</h1>
    </div>
    <form id="auth-form" class="auth-form">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <div id="signup-fields" style="display: none;">
        <input type="text" id="name" placeholder="Name" />
        <input type="file" id="avatar" accept="image/*" />
        <select id="language">
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
        </select>
      </div>
      <button type="submit" id="auth-button">Sign In</button>
      <div class="error-message" id="error-message"></div>
    </form>
    <div class="auth-toggle">
      <span id="toggle-text">Don't have an account? </span>
      <a href="#" id="toggle-link">Sign Up</a>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
  <script>
    // Firebase configuration (replace with your config)
    const firebaseConfig = {
  apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
  authDomain: "fire-b-a8878.firebaseapp.com",
  databaseURL: "https://fire-b-a8878.firebaseio.com",
  projectId: "fire-b-a8878",
  storageBucket: "fire-b-a8878.firebasestorage.app",
  messagingSenderId: "658673187627",
  appId: "1:658673187627:web:6e4c29af661785f0afa36e",
  measurementId: "G-V4W97VMSKL"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Cloudinary configuration
    const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/dqkujefxj/image/upload';
    const CLOUDINARY_UPLOAD_PRESET = 'banter_box';

    // Localization
    const translations = {
      en: {
        sign_in: "Sign In",
        sign_up: "Sign Up",
        email_placeholder: "Email",
        password_placeholder: "Password",
        name_placeholder: "Name",
        language_label: "Language",
        sign_in_button: "Sign In",
        sign_up_button: "Sign Up",
        toggle_sign_in: "Already have an account? Sign In",
        toggle_sign_up: "Don't have an account? Sign Up",
        error_invalid_email: "Invalid email address",
        error_weak_password: "Password should be at least 6 characters",
        error_email_already_in_use: "Email already in use",
        error_wrong_password: "Incorrect password",
        error_user_not_found: "No account found with this email",
        error_general: "An error occurred. Please try again."
      },
      es: {
        sign_in: "Iniciar Sesión",
        sign_up: "Registrarse",
        email_placeholder: "Correo Electrónico",
        password_placeholder: "Contraseña",
        name_placeholder: "Nombre",
        language_label: "Idioma",
        sign_in_button: "Iniciar Sesión",
        sign_up_button: "Registrarse",
        toggle_sign_in: "¿Ya tienes una cuenta? Inicia Sesión",
        toggle_sign_up: "¿No tienes una cuenta? Regístrate",
        error_invalid_email: "Dirección de correo inválida",
        error_weak_password: "La contraseña debe tener al menos 6 caracteres",
        error_email_already_in_use: "Correo ya en uso",
        error_wrong_password: "Contraseña incorrecta",
        error_user_not_found: "No se encontró una cuenta con este correo",
        error_general: "Ocurrió un error. Intenta de nuevo."
      },
      fr: {
        sign_in: "Se Connecter",
        sign_up: "S'inscrire",
        email_placeholder: "Email",
        password_placeholder: "Mot de passe",
        name_placeholder: "Nom",
        language_label: "Langue",
        sign_in_button: "Se Connecter",
        sign_up_button: "S'inscrire",
        toggle_sign_in: "Vous avez déjà un compte ? Connectez-vous",
        toggle_sign_up: "Vous n'avez pas de compte ? Inscrivez-vous",
        error_invalid_email: "Adresse email invalide",
        error_weak_password: "Le mot de passe doit comporter au moins 6 caractères",
        error_email_already_in_use: "Email déjà utilisé",
        error_wrong_password: "Mot de passe incorrect",
        error_user_not_found: "Aucun compte trouvé avec cet email",
        error_general: "Une erreur s'est produite. Veuillez réessayer."
      }
    };

    // Default language (fallback to browser language)
    let currentLanguage = navigator.language.split('-')[0] || 'en';

    // DOM elements
    const authContainer = document.getElementById('auth-container');
    const formTitle = document.getElementById('form-title');
    const authForm = document.getElementById('auth-form');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const nameInput = document.getElementById('name');
    const avatarInput = document.getElementById('avatar');
    const languageSelect = document.getElementById('language');
    const authButton = document.getElementById('auth-button');
    const errorMessage = document.getElementById('error-message');
    const toggleText = document.getElementById('toggle-text');
    const toggleLink = document.getElementById('toggle-link');
    let isSignUp = false;

    // Apply localization
    function applyLocalization() {
      const t = translations[currentLanguage] || translations['en'];
      emailInput.placeholder = t.email_placeholder;
      passwordInput.placeholder = t.password_placeholder;
      if (isSignUp) {
        formTitle.textContent = t.sign_up;
        authButton.textContent = t.sign_up_button;
        toggleText.textContent = t.toggle_sign_in.split('? ')[0] + '? ';
        toggleLink.textContent = t.toggle_sign_in.split('? ')[1];
        nameInput.placeholder = t.name_placeholder;
        languageSelect.previousElementSibling && (languageSelect.previousElementSibling.textContent = t.language_label);
      } else {
        formTitle.textContent = t.sign_in;
        authButton.textContent = t.sign_in_button;
        toggleText.textContent = t.toggle_sign_up.split('? ')[0] + '? ';
        toggleLink.textContent = t.toggle_sign_up.split('? ')[1];
      }
    }

    // Toggle between signin and signup
    toggleLink.addEventListener('click', (e) => {
      e.preventDefault();
      isSignUp = !isSignUp;
      document.getElementById('signup-fields').style.display = isSignUp ? 'block' : 'none';
      applyLocalization();
      errorMessage.style.display = 'none';
    });

    // Shimmer effect
    function showShimmer() {
      authButton.classList.add('shimmer');
      authButton.disabled = true;
    }

    function hideShimmer() {
      authButton.classList.remove('shimmer');
      authButton.disabled = false;
    }

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    }

    // Upload avatar to Cloudinary
    async function uploadAvatar(file) {
      if (!file) return null;
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      try {
        const response = await axios.post(CLOUDINARY_URL, formData);
        return response.data.secure_url;
      } catch (error) {
        console.error('Error uploading avatar:', error);
        showError(translations[currentLanguage].error_general);
        return null;
      }
    }

    // Form submission
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      showShimmer();
      errorMessage.style.display = 'none';

      const email = emailInput.value.trim();
      const password = passwordInput.value;
      const t = translations[currentLanguage] || translations['en'];

      try {
        if (isSignUp) {
          // Signup
          const name = nameInput.value.trim();
          const avatarFile = avatarInput.files[0];
          const language = languageSelect.value || 'en';

          if (!name) {
            hideShimmer();
            showError('Please enter your name');
            return;
          }

          const credential = await auth.createUserWithEmailAndPassword(email, password);
          const avatarUrl = await uploadAvatar(avatarFile);

          await db.ref(`users/${credential.user.uid}`).set({
            name,
            avatar: avatarUrl || null,
            language
          });

          window.location.href = 'index.html';
        } else {
          // Signin
          await auth.signInWithEmailAndPassword(email, password);
          window.location.href = 'index.html';
        }
      } catch (error) {
        hideShimmer();
        let errorMsg = t.error_general;
        switch (error.code) {
          case 'auth/invalid-email':
            errorMsg = t.error_invalid_email;
            break;
          case 'auth/weak-password':
            errorMsg = t.error_weak_password;
            break;
          case 'auth/email-already-in-use':
            errorMsg = t.error_email_already_in_use;
            break;
          case 'auth/wrong-password':
            errorMsg = t.error_wrong_password;
            break;
          case 'auth/user-not-found':
            errorMsg = t.error_user_not_found;
            break;
        }
        showError(errorMsg);
      }
    });

    // Initialize localization
    applyLocalization();

    // Redirect if already signed in
    auth.onAuthStateChanged((user) => {
      if (user) {
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>
