<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vynix Max • Music</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet"/>

  <!-- Firebase compat (same as admin) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg-main: #000000;
      --bg-panel: #121212;
      --bg-hover: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --accent: #e50914;
      --accent-hover: #f40613;
      --mood-accent: #1db954; /* Spotify green-ish for moods */
      --card-bg: rgba(255,255,255,0.05);
      --radius: 8px;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg-main);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .app {
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 1fr auto;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background: var(--bg-panel);
      padding: 1.5rem;
      border-right: 1px solid #282828;
      overflow-y: auto;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 900;
      letter-spacing: -1px;
      margin-bottom: 2rem;
      color: var(--accent);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem 1rem;
      border-radius: var(--radius);
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s;
      margin-bottom: 0.5rem;
    }

    .nav-item:hover, .nav-item.active {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .nav-item .material-symbols-rounded {
      font-size: 1.6rem;
    }

    /* Main Content */
    .main-content {
      overflow-y: auto;
      padding: 2rem 3rem;
      background: linear-gradient(to bottom, rgba(229,9,20,0.08), transparent 30%);
    }

    .section {
      margin-bottom: 3.5rem;
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.25s;
      cursor: pointer;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .card:hover {
      transform: translateY(-6px);
      background: rgba(255,255,255,0.08);
    }

    .card img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
    }

    .card-info {
      padding: 1rem;
      text-align: center;
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .card-subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin-top: 0.6rem;
      font-size: 0.8rem;
    }

    .genre-tag {
      background: rgba(229,9,20,0.3);
      color: var(--accent);
      padding: 0.2rem 0.7rem;
      border-radius: 20px;
    }

    .mood-tag {
      background: rgba(29,185,84,0.3);
      color: #1db954;
      padding: 0.2rem 0.7rem;
      border-radius: 20px;
    }

    /* Bottom Player */
    .player {
      grid-column: 1 / -1;
      background: var(--bg-panel);
      border-top: 1px solid #282828;
      padding: 0.8rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
    }

    .player-track-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      min-width: 200px;
    }

    .player-cover {
      width: 56px;
      height: 56px;
      border-radius: 4px;
      object-fit: cover;
    }

    .player-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.4rem;
      flex: 1;
      max-width: 500px;
    }

    .control-btns {
      display: flex;
      gap: 1.5rem;
      font-size: 1.8rem;
      color: var(--text-secondary);
    }

    .control-btns .material-symbols-rounded {
      cursor: pointer;
      transition: color 0.2s;
    }

    .control-btns .material-symbols-rounded:hover {
      color: var(--text-primary);
    }

    .progress-container {
      width: 100%;
      height: 5px;
      background: #535353;
      border-radius: 5px;
      cursor: pointer;
    }

    .progress {
      height: 100%;
      width: 0%;
      background: var(--accent);
      border-radius: 5px;
      transition: width 0.1s linear;
    }

    .time {
      font-size: 0.8rem;
      color: var(--text-secondary);
      width: 80px;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .app { grid-template-columns: 80px 1fr; }
      .sidebar { padding: 1rem 0.5rem; }
      .nav-item span:not(.material-symbols-rounded) { display: none; }
    }
  </style>
</head>
<body>

<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">VYNIX MAX</div>

    <a href="#" class="nav-item active">
      <span class="material-symbols-rounded">home</span>
      <span>Home</span>
    </a>
    <a href="#" class="nav-item">
      <span class="material-symbols-rounded">search</span>
      <span>Search</span>
    </a>
    <a href="#" class="nav-item">
      <span class="material-symbols-rounded">library_music</span>
      <span>Your Library</span>
    </a>

    <div style="margin-top: 2rem; font-size:0.9rem; color:var(--text-secondary);">
      <p>Created Playlists</p>
      <!-- Could be dynamic in future -->
      <p style="margin-top:0.5rem;">Amapiano Nights</p>
      <p>Chill Afrobeats</p>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">

    <h1 class="section-title" style="margin-bottom:2rem;">Welcome back</h1>

    <!-- Quick filters / moods -->
    <div class="section">
      <h2 class="section-title">Moods & Activities</h2>
      <div class="grid" id="moodsGrid"></div>
    </div>

    <!-- New Releases -->
    <div class="section">
      <h2 class="section-title">New Releases</h2>
      <div class="grid" id="newReleasesGrid"></div>
    </div>

    <!-- Trending -->
    <div class="section">
      <h2 class="section-title">Trending Now</h2>
      <div class="grid" id="trendingGrid"></div>
    </div>

    <!-- Search input (basic) -->
    <div style="margin:2rem 0;">
      <input type="text" id="searchInput" placeholder="Search tracks, artists..." 
        style="width:100%; padding:1rem; background:var(--bg-hover); border:none; border-radius:var(--radius); color:white; font-size:1.1rem;"/>
    </div>

  </main>

  <!-- Bottom Player -->
  <footer class="player">
    <div class="player-track-info">
      <img id="playerCover" src="https://via.placeholder.com/56?text=Cover" alt="Now Playing" />
      <div>
        <div id="playerTitle">Select a track</div>
        <div id="playerArtist" style="color:var(--text-secondary); font-size:0.9rem;">—</div>
      </div>
    </div>

    <div class="player-controls">
      <div class="control-btns">
        <span class="material-symbols-rounded">shuffle</span>
        <span class="material-symbols-rounded">skip_previous</span>
        <span id="playPauseBtn" class="material-symbols-rounded" style="font-size:2.8rem; color:white;">play_circle</span>
        <span class="material-symbols-rounded">skip_next</span>
        <span class="material-symbols-rounded">repeat</span>
      </div>

      <div style="width:100%; display:flex; align-items:center; gap:1rem;">
        <span id="currentTime" class="time">0:00</span>
        <div class="progress-container" id="progressContainer">
          <div class="progress" id="progressBar"></div>
        </div>
        <span id="duration" class="time">0:00</span>
      </div>
    </div>

    <div style="min-width:180px;"></div> <!-- spacer -->
  </footer>

</div>

<audio id="audioPlayer"></audio>

<script>
// Firebase config (same as admin!)
const firebaseConfig = {
  apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
  authDomain: "fire-b-a8878.firebaseapp.com",
  databaseURL: "https://fire-b-a8878.firebaseio.com",
  projectId: "fire-b-a8878",
  storageBucket: "fire-b-a8878.appspot.com",
  appId: "1:658673187627:web:6e4c29af661785f0afa36e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Audio player elements
const audio = document.getElementById('audioPlayer');
const playPauseBtn = document.getElementById('playPauseBtn');
const progressBar = document.getElementById('progressBar');
const currentTimeEl = document.getElementById('currentTime');
const durationEl = document.getElementById('duration');
const playerTitle = document.getElementById('playerTitle');
const playerArtist = document.getElementById('playerArtist');
const playerCover = document.getElementById('playerCover');

let currentTrack = null;
let allTracks = [];

// Format time
function formatTime(seconds) {
  const min = Math.floor(seconds / 60);
  const sec = Math.floor(seconds % 60);
  return `${min}:${sec < 10 ? '0' : ''}${sec}`;
}

// Load all tracks
db.ref("/content/music").orderByChild("order").on("value", snap => {
  allTracks = [];
  snap.forEach(child => {
    allTracks.push({ id: child.key, ...child.val() });
  });
  renderSection('newReleasesGrid', allTracks.slice(0, 8)); // example - newest first
  renderSection('trendingGrid', allTracks.slice(0, 8));   // placeholder
  // In real app you'd use different sorting / filtering
});

// Render tracks grid
function renderSection(containerId, tracks) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';

  tracks.forEach(track => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${track.cover || 'https://via.placeholder.com/180?text=No+Cover'}" alt="${track.title}">
      <div class="card-info">
        <div class="card-title">${track.title}</div>
        <div class="card-subtitle">${track.artist}</div>
        <div class="tag-container">
          ${track.genres?.map(g => `<span class="genre-tag">${g}</span>`).join('') || ''}
          ${track.moods?.map(m => `<span class="mood-tag">${m}</span>`).join('') || ''}
        </div>
      </div>
    `;

    card.onclick = () => playTrack(track);
    container.appendChild(card);
  });
}

// Play selected track
function playTrack(track) {
  currentTrack = track;

  audio.src = track.audio;
  audio.play().catch(e => console.log("Autoplay prevented:", e));

  playerTitle.textContent = track.title;
  playerArtist.textContent = track.artist;
  playerCover.src = track.cover || 'https://via.placeholder.com/56?text=Cover';

  playPauseBtn.textContent = 'pause_circle';
}

// Player controls
playPauseBtn.onclick = () => {
  if (audio.paused) {
    audio.play();
    playPauseBtn.textContent = 'pause_circle';
  } else {
    audio.pause();
    playPauseBtn.textContent = 'play_circle';
  }
};

audio.ontimeupdate = () => {
  if (!audio.duration) return;
  const progress = (audio.currentTime / audio.duration) * 100;
  progressBar.style.width = progress + '%';
  currentTimeEl.textContent = formatTime(audio.currentTime);
  durationEl.textContent = formatTime(audio.duration);
};

document.getElementById('progressContainer').onclick = e => {
  const rect = e.currentTarget.getBoundingClientRect();
  const pos = (e.clientX - rect.left) / rect.width;
  audio.currentTime = pos * audio.duration;
};

// Basic search filter (client-side)
document.getElementById('searchInput').oninput = e => {
  const term = e.target.value.toLowerCase();
  const filtered = allTracks.filter(t =>
    t.title.toLowerCase().includes(term) ||
    t.artist.toLowerCase().includes(term)
  );

  // For simplicity - update one section
  renderSection('newReleasesGrid', filtered.slice(0,8));
};

// Initial load of moods (optional visual filter)
db.ref("/content/musicMoods").once("value", snap => {
  const container = document.getElementById('moodsGrid');
  snap.forEach(child => {
    const name = child.val().name;
    const chip = document.createElement('div');
    chip.className = 'card';
    chip.style.padding = '1rem';
    chip.style.textAlign = 'center';
    chip.style.fontWeight = '600';
    chip.textContent = name;
    chip.onclick = () => alert(`Filter by ${name} - to be implemented`);
    container.appendChild(chip);
  });
});

</script>
</body>
</html>
