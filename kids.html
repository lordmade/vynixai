<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AlphaPal • ABC, 123, Trace & Color!</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"AlphaPal – Learn & Color\",
    \"short_name\":\"AlphaPal\",
    \"description\":\"Letters, numbers, tracing & coloring fun!\",
    \"start_url\":\"./index.html\",
    \"display\":\"standalone\",
    \"background_color\":\"#fff0f8\",
    \"theme_color\":\"#ff6bcb\",
    \"icons\":[
      {\"src\":\"https://api.dicebear.com/7.x/shapes/svg?seed=AlphaPal&backgroundColor=ff6bcb&size=192\",\"sizes\":\"192x192\",\"type\":\"image/svg+xml\"},
      {\"src\":\"https://api.dicebear.com/7.x/shapes/svg?seed=AlphaPal&backgroundColor=ff6bcb&size=512\",\"sizes\":\"512x512\",\"type\":\"image/svg+xml\"}
    ]
  }">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    *,*::before,*::after{
      -webkit-touch-callout:none;
      -webkit-user-select:none;
      -khtml-user-select:none;
      -moz-user-select:none;
      -ms-user-select:none;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }
    body{font-family:'Comic Neue',cursive;background:linear-gradient(135deg,#fffbe6,#e6f9ff);margin:0;height:100dvh;overflow:hidden;}
    h1{font-family:'Fredoka One',cursive;}
    .rainbow{background:linear-gradient(90deg,#ff6bcb,#ffaecb,#a0e7ff,#9fffcb,#ffd580,#ff9f9f);-webkit-background-clip:text;color:transparent;}
    .sparkle{animation:sparkle 2s infinite;}
    @keyframes sparkle{0%,100%{transform:scale(1)}50%{transform:scale(1.18) rotate(6deg)}}
    .float{animation:float 3s infinite ease-in-out;}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    #mobileNav{
      position:fixed;bottom:0;left:0;right:0;
      background:linear-gradient(to top,rgba(255,255,255,0.95),rgba(255,255,255,0.8));
      backdrop-filter:blur(12px);padding:12px 0;border-top:4px solid #ff6bcb;
      box-shadow:0 -10px 30px rgba(0,0,0,0.15);z-index:50;
    }
    .nav-btn{
      width:90px;height:90px;border-radius:50%;font-size:3682px;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 20px rgba(0,0,0,0.25);
      transition:all .25s cubic-bezier(.4,0,.2,1);
    }
    .nav-btn:active,.nav-btn.tapped{transform:scale(0.88)!important;box-shadow:0 4px 10px rgba(0,0,0,0.3);}
    .crayon{
      width:80px;height:80px;border-radius:50%;
      box-shadow:0 8px 20px rgba(0,0,0,0.3);
      transition:all .2s;
    }
    .crayon:active{transform:scale(0.9);}
    .crayon.selected{border:8px solid white;transform:scale(1.2);}
    @media (max-width:1023px){#main{padding-bottom:120px}}
    @media (min-width:1024px){#mobileNav{display:none;}#main{padding-left:160px;}}
  </style>
</head>
<body class="flex flex-col">

  <!-- Header + Mode Switch -->
  <div class="text-center py-6 bg-gradient-to-b from-pink-200 to-transparent relative z-30">
    <h1 class="text-6xl rainbow sparkle">AlphaPal</h1>
    <p class="text-3xl text-purple-700 mt-2">ABC • 123 • Trace • Color</p>
    <div class="mt-6 flex justify-center gap-8">
      <button id="modeABC" class="px-10 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-4xl rounded-full shadow-xl">ABC</button>
      <button id="mode123" class="px-10 py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-4xl rounded-full shadow-xl opacity-60">123</button>
    </div>
  </div>

  <!-- Main Screen -->
  <div id="main" class="flex-1 flex flex-col items-center justify-center gap-10 px-6 relative z-20">
    <div id="display" class="sparkle text-28vw md:text-24vw font-black text-center leading-none" style="color:hsl(0,90%,60%)">A</div>
    <div class="text-center">
      <div id="word" class="text-6xl md:text-8xl font-bold text-purple-800 mb-6 drop-shadow-lg">apple</div>
      <img id="image" src="" alt="" class="float w-64 h-64 md:w-80 md:h-80 mx-auto">
    </div>
  </div>

  <!-- Mobile Bottom Bar -->
  <div id="mobileNav" class="flex justify-around items-center">
    <button id="soundBtn" class="nav-btn bg-gradient-to-br from-red-400 to-pink-500 text-white">Sound</button>
    <button id="singBtn" class="nav-btn bg-gradient-to-br from-purple-400 to-indigo-600 text-white">Sing</button>
    <button id="drawBtn" class="nav-btn bg-gradient-to-br from-green-400 to-teal-500 text-white">Draw</button>
    <button id="nextBtn" class="nav-btn bg-gradient-to-br from-yellow-400 to-orange-500 text-white">Next</button>
  </div>

  <!-- DRAWING / COLORING SCREEN -->
  <div id="drawScreen" class="hidden fixed inset-0 bg-gradient-to-br from-sky-200 via-pink-200 to-purple-200 flex flex-col items-center justify-center z-50">
    <canvas id="canvas" class="w-full max-w-2xl h-96 md:h-[600px] bg-white rounded-3xl shadow-2xl border-8 border-white"></canvas>

    <!-- Crayon Palette -->
    <div class="mt-8 flex flex-wrap justify-center gap-6 px-4">
      <button class="crayon selected" data-color="#ff1493" style="background:#ff1493"></button>
      <button class="crayon" data-color="#ff6bcb" style="background:#ff6bcb"></button>
      <button class="crayon" data-color="#ff9d00" style="background:#ff9d00"></button>
      <button class="crayon" data-color="#ffed4e" style="background:#ffed4e"></button>
      <button class="crayon" data-color="#4eff7b" style="background:#4eff7b"></button>
      <button class="crayon" data-color="#4e9fff" style="background:#4e9fff"></button>
      <button class="crayon" data-color="#9c4eff" style="background:#9c4eff"></button>
      <button class="crayon" data-color="#000000" style="background:#000000"></button>
    </div>

    <!-- Controls -->
    <div class="mt-8 flex flex-wrap justify-center gap-4 items-center px-4">
      <button id="modeTrace" class="px-10 py-5 bg-purple-600 text-white text-3xl rounded-full shadow-xl">Trace</button>
      <button id="modeColor" class="px-10 py-5 bg-pink-600 text-white text-3xl rounded-full shadow-xl opacity-60">Color</button>
      <button id="clearBtn" class="px-12 py-5 bg-red-600 text-white text-3xl rounded-full shadow-xl">Clear</button>
      <button id="backBtn" class="px-12 py-5 bg-indigo-600 text-white text-3xl rounded-full shadow-xl">Back</button>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="pop" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
  <audio id="sparkleSound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-magical-coin-win-1937.mp3"></audio>
  <audio id="scribble" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-pencil-writing-fast-3343.mp3"></audio>

  <script>
    function playSound(id){const a=document.getElementById(id);a.currentTime=0;a.play().catch(()=>{});}
    function tapEffect(b){b.classList.add('tapped');setTimeout(()=>b.classList.remove('tapped'),300);}

    const letters=[
      {l:"A",s:"ă",w:"apple",e:"1f34e"},{l:"B",s:"b",w:"ball",e:"26bd"},{l:"C",s:"k",w:"cat",e:"1f408"},
      {l:"D",s:"d",w:"dog",e:"1f436"},{l:"E",s:"ĕ",w:"elephant",e:"1f418"},{l:"F",s:"f",w:"fish",e:"1f41f"},
      {l:"G",s:"g",w:"giraffe",e:"1f992"},{l:"H",s:"h",w:"hat",e:"1f3a9"},{l:"I",s:"ĭ",w:"igloo",e:"1f6c4"},
      {l:"J",s:"j",w:"jam",e:"1f370"},{l:"K",s:"k",w:"kite",e:"1fa81"},{l:"L",s:"l",w:"lion",e:"1f981"},
      {l:"M",s:"m",w:"monkey",e:"1f412"},{l:"N",s:"n",w:"nest",e:"1faba"},{l:"O",s:"ŏ",w:"octopus",e:"1f419"},
      {l:"P",s:"p",w:"penguin",e:"1f427"},{l:"Q",s:"kw",w:"queen",e:"1f451"},{l:"R",s:"r",w:"rainbow",e:"1f308"},
      {l:"S",s:"s",w:"sun",e:"2600"},{l:"T",s:"t",w:"tiger",e:"1f405"},{l:"U",s:"ŭ",w:"umbrella",e:"2602"},
      {l:"V",s:"v",w:"violin",e:"1f3bb"},{l:"W",s:"w",w:"watermelon",e:"1f349"},{l:"X",s:"ks",w:"box",e:"1f4e6"},
      {l:"Y",s:"y",w:"yak",e:"1f402"},{l:"Z",s:"z",w:"zebra",e:"1f993"}
    ];

    const numbers=[
      {n:"1",w:"one",e:"1f44d",c:"#ff6bcb"},{n:"2",w:"two",e:"1f44c",c:"#ff9d9d"},
      {n:"3",w:"three",e:"1f64c",c:"#ffb380"},{n:"4",w:"four",e:"1f919",c:"#ffed80"},
      {n:"5",w:"five",e:"1f44c",c:"#bfff80"},{n:"6",w:"six",e:"1f44a",c:"#80ffea"},
      {n:"7",w:"seven",e:"1f44b",c:"#80d4ff"},{n:"8",w:"eight",e:"1f44f",c:"#c780ff"},
      {n:"9",w:"nine",e:"1f44f",c:"#ff80c7"},{n:"10",w:"ten",e:"1f389",c:"#ffd580"}
    ];

    let mode="abc", i=0, drawMode="color", currentColor="#ff1493";

    const displayEl=document.getElementById('display');
    const wordEl=document.getElementById('word');
    const imgEl=document.getElementById('image');

    function showCurrent(){
      playSound('sparkleSound');
      if(mode==="abc"){
        const p=letters[i];
        displayEl.textContent=p.l;
        wordEl.textContent=p.w;
        imgEl.src=`https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${p.e}.svg`;
        displayEl.style.color=`hsl(${i*360/26},90%,60%)`;
      }else{
        const p=numbers[i];
        displayEl.textContent=p.n;
        wordEl.textContent=p.w;
        imgEl.src=`https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${p.e}.svg`;
        displayEl.style.color=p.c;
      }
    }

    function speak(text,rate=0.8,pitch=1.4){
      const u=new SpeechSynthesisUtterance(text);
      u.rate=rate; u.pitch=pitch;
      const voices=speechSynthesis.getVoices();
      u.voice=voices.find(v=>v.lang.startsWith('en'))||voices[0];
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    function addBtn(id,action){
      const b=document.getElementById(id);
      if(b) b.onclick=()=>{playSound('pop');tapEffect(b);action();}
    }

    // Mode switch
    document.getElementById('modeABC').onclick=()=>{
      mode="abc";i=0;showCurrent();
      document.getElementById('modeABC').style.opacity=1;
      document.getElementById('mode123').style.opacity=0.6;
    };
    document.getElementById('mode123').onclick=()=>{
      mode="123";i=0;showCurrent();
      document.getElementById('mode123').style.opacity=1;
      document.getElementById('modeABC').style.opacity=0.6;
    };

    addBtn('soundBtn',()=>{mode==="abc"?speak(letters[i].l==="A"?"ă as in apple … A … apple":`${letters[i].s} … ${letters[i].l} … ${letters[i].w}`,0.75,1.3):speak(`${numbers[i].n} … ${numbers[i].w}!`);});
    addBtn('singBtn',()=>{mode==="abc"?speak(`A B C D E F G … H I J K L M N O P … Q R S … T U V … W X Y and Z! Yay, letter ${letters[i].l} is for ${letters[i].w}!`,0.8,1.3):speak(`One two three four five, six seven eight nine ten! Yay, we counted to ${numbers[i].w}!`);});
    addBtn('nextBtn',()=>{i=(i+1)%(mode==="abc"?letters.length:numbers.length);showCurrent();if(i===0)setTimeout(()=>speak(mode==="abc"?"You finished the alphabet! Amazing!":"You counted to ten! Super star!"),800);});

    // === SMOOTH DRAWING ===
    const canvas=document.getElementById('canvas');
    const ctx=canvas.getContext('2d');
    let drawing=false,lastX=0,lastY=0,lastTime=0;

    function resizeCanvas(){
      canvas.width=canvas.offsetWidth*devicePixelRatio;
      canvas.height=canvas.offsetHeight*devicePixelRatio;
      ctx.scale(devicePixelRatio,devicePixelRatio);
      drawGuide();
    }
    window.addEventListener('resize',resizeCanvas);

    function drawGuide(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if(drawMode==="trace"){
        const text=mode==="abc"?letters[i].l:numbers[i].n;
        ctx.font=`bold ${canvas.height*0.7}px Comic Neue`;
        ctx.fillStyle='#00000011';
        ctx.textAlign='center';
        ctx.textBaseline='middle';
        ctx.fillText(text,canvas.width/(2*devicePixelRatio),canvas.height/(2*devicePixelRatio)+20);
      }
    }

    function startDraw(e){
      drawing=true;
      const rect=canvas.getBoundingClientRect();
      lastX=e.touches?e.touches[0].clientX-rect.left:e.offsetX;
      lastY=e.touches?e.touches[0].clientY-rect.top:e.offsetY;
      lastTime=performance.now();
      ctx.beginPath();
      ctx.moveTo(lastX,lastY);
    }
    function draw(e){
      if(!drawing) return;
      const rect=canvas.getBoundingClientRect();
      const x=e.touches?e.touches[0].clientX-rect.left:e.offsetX;
      const y=e.touches?e.touches[0].clientY-rect.top:e.offsetY;
      const now=performance.now();
      const dist=Math.hypot(x-lastX,y-lastY);
      const time=Math.max(1,now-lastTime);
      const speed=dist/time;
      const width=Math.max(4,Math.min(40,120/speed));

      ctx.lineWidth=width;
      ctx.lineCap='round';
      ctx.lineJoin='round';
      ctx.strokeStyle=currentColor;
      ctx.lineTo(x,y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x,y);

      lastX=x; lastY=y; lastTime=now;
      if(speed>0.5) playSound('scribble');
    }
    function stopDraw(){drawing=false;ctx.beginPath();}

    canvas.addEventListener('pointerdown',startDraw);
    canvas.addEventListener('pointermove',draw);
    canvas.addEventListener('pointerup',stopDraw);
    canvas.addEventListener('pointerleave',stopDraw);

    // Crayons
    document.querySelectorAll('.crayon').forEach(btn=>{
      btn.onclick=()=>{
        document.querySelectorAll('.crayon').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        currentColor=btn.dataset.color;
        playSound('pop');
      };
    });

    // Open drawing screen
    addBtn('drawBtn',()=>{
      document.getElementById('drawScreen').classList.remove('hidden');
      document.getElementById('main').classList.add('hidden');
      document.getElementById('mobileNav').classList.add('hidden');
      resizeCanvas();
    });

    // Trace / Color toggle
    document.getElementById('modeTrace').onclick=()=>{drawMode="trace";drawGuide();document.getElementById('modeTrace').style.opacity=1;document.getElementById('modeColor').style.opacity=0.6;};
    document.getElementById('modeColor').onclick=()=>{drawMode="color";drawGuide();document.getElementById('modeColor').style.opacity=1;document.getElementById('modeTrace').style.opacity=0.6;};

    addBtn('clearBtn',()=>{playSound('click');drawGuide();});
    addBtn('backBtn',()=>{
      playSound('click');
      document.getElementById('drawScreen').classList.add('hidden');
      document.getElementById('main').classList.remove('hidden');
      document.getElementById('mobileNav').classList.remove('hidden');
    });

    // Init
    resizeCanvas();
    showCurrent();
    speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices();
  </script>
</body>
</html>
