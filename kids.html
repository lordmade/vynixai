<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AlphaPal • ABC, 123 & Shapes!</title>

  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"AlphaPal – Learn & Draw\",
    \"short_name\":\"AlphaPal\",
    \"description\":\"Tap to trace letters, numbers & shapes!\",
    \"start_url\":\"./index.html\",
    \"display\":\"standalone\",
    \"background_color\":\"#fffbe6\",
    \"theme_color\":\"#ff6bcb\",
    \"icons\":[
      {\"src\":\"https://api.dicebear.com/7.x/shapes/svg?seed=AlphaPal&backgroundColor=ff6bcb&size=192\",\"sizes\":\"192x192\",\"type\":\"image/svg+xml\"},
      {\"src\":\"https://api.dicebear.com/7.x/shapes/svg?seed=AlphaPal&backgroundColor=ff6bcb&size=512\",\"sizes\":\"512x512\",\"type\":\"image/svg+xml\"}
    ]
  }">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    *,*::before,*::after{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;}
    body{font-family:'Comic Neue',cursive;background:linear-gradient(135deg,#fffbe6,#e6f9ff);margin:0;height:100dvh;overflow:hidden;}
    h1{font-family:'Fredoka One',cursive;}
    .rainbow{background:linear-gradient(90deg,#ff6bcb,#ffaecb,#a0e7ff,#9fffcb,#ffd580,#ff9f9f);-webkit-background-clip:text;color:transparent;}
    .sparkle{animation:sparkle 2s infinite;}@keyframes sparkle{0%,100%{transform:scale(1)}50%{transform:scale(1.18) rotate(6deg)}}
    .float{animation:float 3s infinite ease-in-out;}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    #mobileNav{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(255,255,255,0.95),rgba(255,255,255,0.8));
      backdrop-filter:blur(12px);padding:12px 0;border-top:4px solid #ff6bcb;box-shadow:0 -10px 30px rgba(0,0,0,0.15);z-index:50;}
    .nav-btn{width:90px;height:90px;border-radius:50%;font-size:36px;display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 20px rgba(0,0,0,0.25);transition:all .25s cubic-bezier(.4,0,.2,1);}
    .nav-btn:active,.nav-btn.tapped{transform:scale(0.88)!important;box-shadow:0 4px 10px rgba(0,0,0,0.3);}
    .crayon{width:80px;height:80px;border-radius:50%;box-shadow:0 8px 20px rgba(0,0,0,0.3);transition:all .2s;}
    .crayon:active{transform:scale(0.9);}
    .crayon.selected{border:8px solid white;transform:scale(1.2);}
    .tappable{cursor:pointer;transform:scale(1);transition:transform .2s;}
    .tappable:active{transform:scale(0.94);}
    @media (max-width:1023px){#main{padding-bottom:120px}}
  </style>
</head>
<body class="flex flex-col">

  <!-- Header -->
  <div class="text-center py-6 bg-gradient-to-b from-pink-200 to-transparent relative z-30">
    <h1 class="text-6xl rainbow sparkle">AlphaPal</h1>
    <p class="text-3xl text-purple-700 mt-2">ABC • 123 • Shapes</p>
    <div class="mt-6 flex flex-wrap justify-center gap-6 px-4">
      <button id="modeABC" class="px-10 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-4xl rounded-full shadow-xl">ABC</button>
      <button id="mode123" class="px-10 py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-4xl rounded-full shadow-xl opacity-60">123</button>
      <button id="modeShapes" class="px-10 py-4 bg-gradient-to-r from-green-500 to-teal-500 text-white text-4xl rounded-full shadow-xl opacity-60">Shapes</button>
    </div>
  </div>

  <!-- Main Screen - NOW TAPPABLE! -->
  <div id="main" class="flex-1 flex flex-col items-center justify-center gap-10 px-6 relative z-20">
    <div id="display" class="sparkle tappable text-28vw md:text-24vw font-black text-center leading-none" style="color:hsl(0,90%,60%)">A</div>
    <div class="text-center">
      <div id="word" class="text-6xl md:text-8xl font-bold text-purple-800 mb-6 drop-shadow-lg">apple</div>
      <img id="image" src="" alt="" class="float tappable w-64 h-64 md:w-80 md:h-80 mx-auto">
    </div>
  </div>

  <!-- Bottom Bar -->
  <div id="mobileNav" class="flex justify-around items-center">
    <button id="soundBtn" class="nav-btn bg-gradient-to-br from-red-400 to-pink-500 text-white">Sound</button>
    <button id="singBtn" class="nav-btn bg-gradient-to-br from-purple-400 to-indigo-600 text-white">Sing</button>
    <button id="drawBtn" class="nav-btn bg-gradient-to-br from-green-400 to-teal-500 text-white">Draw</button>
    <button id="nextBtn" class="nav-btn bg-gradient-to-br from-yellow-400 to-orange-500 text-white">Next</button>
  </div>

  <!-- DRAWING SCREEN -->
  <div id="drawScreen" class="hidden fixed inset-0 bg-gradient-to-br from-sky-200 via-pink-200 to-purple-200 flex flex-col items-center justify-center z-50">
    <canvas id="canvas" class="w-full max-w-2xl h-96 md:h-[600px] bg-white rounded-3xl shadow-2xl border-8 border-white"></canvas>

    <div class="mt-8 flex flex-wrap justify-center gap-6 px-4">
      <button class="crayon selected" data-color="#ff1493" style="background:#ff1493"></button>
      <button class="crayon" data-color="#ff6bcb" style="background:#ff6bcb"></button>
      <button class="crayon" data-color="#ff9d00" style="background:#ff9d00"></button>
      <button class="crayon" data-color="#ffed4e" style="background:#ffed4e"></button>
      <button class="crayon" data-color="#4eff7b" style="background:#4eff7b"></button>
      <button class="crayon" data-color="#4e9fff" style="background:#4e9fff"></button>
      <button class="crayon" data-color="#9c4eff" style="background:#9c4eff"></button>
      <button class="crayon" data-color="#000000" style="background:#000000"></button>
    </div>

    <div class="mt-8 flex flex-wrap justify-center gap-4 items-center px-4">
      <button id="modeTrace" class="px-10 py-5 bg-purple-600 text-white text-3xl rounded-full shadow-xl">Trace</button>
      <button id="modeColor" class="px-10 py-5 bg-pink-600 text-white text-3xl rounded-full shadow-xl opacity-60">Color</button>
      <button id="clearBtn" class="px-12 py-5 bg-red-600 text-white text-3xl rounded-full shadow-xl">Clear</button>
      <button id="backBtn" class="px-12 py-5 bg-indigo-600 text-white text-3xl rounded-full shadow-xl">Back</button>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="pop" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
  <audio id="sparkleSound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-magical-coin-win-1937.mp3"></audio>
  <audio id="scribble" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-pencil-writing-fast-3343.mp3"></audio>

  <script>
    const playSound = id => { const a = document.getElementById(id); a.currentTime = 0; a.play().catch(() => {}); };
    const tapEffect = b => { b.classList.add('tapped'); setTimeout(() => b.classList.remove('tapped'), 300); };

    const letters = [{l:"A",s:"ă",w:"apple",e:"1f34e"},{l:"B",s:"b",w:"ball",e:"26bd"},{l:"C",s:"k",w:"cat",e:"1f408"},{l:"D",s:"d",w:"dog",e:"1f436"},{l:"E",s:"ĕ",w:"elephant",e:"1f418"},{l:"F",s:"f",w:"fish",e:"1f41f"},{l:"G",s:"g",w:"giraffe",e:"1f992"},{l:"H",s:"h",w:"hat",e:"1f3a9"},{l:"I",s:"ĭ",w:"igloo",e:"1f6c4"},{l:"J",s:"j",w:"jam",e:"1f370"},{l:"K",s:"k",w:"kite",e:"1fa81"},{l:"L",s:"l",w:"lion",e:"1f981"},{l:"M",s:"m",w:"monkey",e:"1f412"},{l:"N",s:"n",w:"nest",e:"1faba"},{l:"O",s:"ŏ",w:"octopus",e:"1f419"},{l:"P",s:"p",w:"penguin",e:"1f427"},{l:"Q",s:"kw",w:"queen",e:"1f451"},{l:"R",s:"r",w:"rainbow",e:"1f308"},{l:"S",s:"s",w:"sun",e:"2600"},{l:"T",s:"t",w:"tiger",e:"1f405"},{l:"U",s:"ŭ",w:"umbrella",e:"2602"},{l:"V",s:"v",w:"violin",e:"1f3bb"},{l:"W",s:"w",w:"watermelon",e:"1f349"},{l:"X",s:"ks",w:"box",e:"1f4e6"},{l:"Y",s:"y",w:"yak",e:"1f402"},{l:"Z",s:"z",w:"zebra",e:"1f993"}];
    const numbers = [{n:"1",w:"one",e:"1f44d",c:"#ff6bcb"},{n:"2",w:"two",e:"1f44c",c:"#ff9d9d"},{n:"3",w:"three",e:"1f64c",c:"#ffb380"},{n:"4",w:"four",e:"1f919",c:"#ffed80"},{n:"5",w:"five",e:"1f44c",c:"#bfff80"},{n:"6",w:"six",e:"1f44a",c:"#80ffea"},{n:"7",w:"seven",e:"1f44b",c:"#80d4ff"},{n:"8",w:"eight",e:"1f44f",c:"#c780ff"},{n:"9",w:"nine",e:"1f44f",c:"#ff80c7"},{n:"10",w:"ten",e:"1f389",c:"#ffd580"}];

    const shapes = [
      {name:"Circle", speak:"This is a circle!", path:d=>`M${d} ${d} a ${d} ${d} 0 1 0 0.1 0 a ${d} ${d} 0 1 0 -0.1 0`, color:"#ff6bcb"},
      {name:"Triangle", speak:"This is a triangle!", path:d=>`M${d} ${d*0.3} L${d*1.7} ${d*1.7} L${d*0.3} ${d*1.7} Z`, color:"#4e9fff"},
      {name:"Square", speak:"This is a square!", path:d=>`M${d*0.4} ${d*0.4} h${d*1.2} v${d*1.2} h-${d*1.2} Z`, color:"#ff9d00"},
      {name:"Rectangle", speak:"This is a rectangle!", path:d=>`M${d*0.3} ${d*0.6} h${d*1.4} v${d*0.8} h-${d*1.4} Z`, color:"#9c4eff"},
      {name:"Star", speak:"This is a star!", path:d=>`M${d} ${d*0.3} L${d*1.15} ${d*0.8} L${d*1.8} ${d*0.8} L${d*1.3} ${d*1.3} L${d*1.5} ${d*1.9} L${d} ${d*1.5} L${d*0.5} ${d*1.9} L${d*0.7} ${d*1.3} L${d*0.2} ${d*0.8} L${d*0.85} ${d*0.8} Z`, color:"#ffed4e"},
      {name:"Heart", speak:"This is a heart!", path:d=>`M${d} ${d*1.3} Q${d*0.3} ${d*0.6} ${d*0.6} ${d*0.4} Q${d*0.9} ${d*0.2} ${d} ${d*0.6} Q${d*1.1} ${d*0.2} ${d*1.4} ${d*0.4} Q${d*1.7} ${d*0.6} ${d} ${d*1.3} Z`, color:"#ff1493"},
      {name:"Diamond", speak:"This is a diamond!", path:d=>`M${d} ${d*0.4} L${d*1.6} ${d} L${d} ${d*1.6} L${d*0.4} ${d} Z`, color:"#4eff7b"},
      {name:"Pentagon", speak:"This is a pentagon!", path:d=>`M${d} ${d*0.4} L${d*1.55} ${d*0.75} L${d*1.35} ${d*1.5} L${d*0.65} ${d*1.5} L${d*0.45} ${d*0.75} Z`, color:"#ffaecb"},
      {name:"Hexagon", speak:"This is a hexagon!", path:d=>`M${d*1.3} ${d*0.5} L${d*1.7} ${d} L${d*1.3} ${d*1.5} L${d*0.7} ${d*1.5} L${d*0.3} ${d} L${d*0.7} ${d*0.5} Z`, color:"#80d4ff"}
    ];

    let mode = "abc", i = 0, drawMode = "color", currentColor = "#ff1493";

    const displayEl = document.getElementById('display');
    const wordEl = document.getElementById('word');
    const imgEl = document.getElementById('image');

    function showCurrent() {
      playSound('sparkleSound');
      if (mode === "abc") {
        const p = letters[i];
        displayEl.textContent = p.l; wordEl.textContent = p.w;
        imgEl.src = `https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${p.e}.svg`;
        imgEl.style.display = "block";
        displayEl.style.color = `hsl(${i * 360 / 26},90%,60%)`;
      } else if (mode === "123") {
        const p = numbers[i];
        displayEl.textContent = p.n; wordEl.textContent = p.w;
        imgEl.src = `https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${p.e}.svg`;
        imgEl.style.display = "block";
        displayEl.style.color = p.c;
      } else {
        const s = shapes[i];
        displayEl.textContent = s.name; wordEl.textContent = "Shape";
        imgEl.style.display = "none";
        displayEl.style.color = s.color;
      }
    }

    function speak(text, rate = 0.8, pitch = 1.4) {
      const u = new SpeechSynthesisUtterance(text);
      u.rate = rate; u.pitch = pitch;
      const voices = speechSynthesis.getVoices();
      u.voice = voices.find(v => v.lang.startsWith('en')) || voices[0];
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    }

    const addBtn = (id, action) => { const b = document.getElementById(id); if (b) b.onclick = () => { playSound('pop'); tapEffect(b); action(); }; };

    // MODE SWITCH
    const setMode = (m) => {
      mode = m; i = 0; showCurrent();
      document.querySelectorAll('#modeABC,#mode123,#modeShapes').forEach(b => b.style.opacity = 0.6);
      document.getElementById(m === "abc" ? "modeABC" : m === "123" ? "mode123" : "modeShapes").style.opacity = 1;
    };
    document.getElementById('modeABC').onclick = () => setMode("abc");
    document.getElementById('mode123').onclick = () => setMode("123");
    document.getElementById('modeShapes').onclick = () => setMode("shapes");

    // TAP TO TRACE! (Main feature)
    const openDrawingForTrace = () => {
      drawMode = "trace";
      document.getElementById('modeTrace').style.opacity = 1;
      document.getElementById('modeColor').style.opacity = 0.6;
      document.getElementById('drawScreen').classList.remove('hidden');
      document.getElementById('main').classList.add('hidden');
      document.getElementById('mobileNav').classList.add('hidden');
      resizeCanvas();
      playSound('pop');
    };
    displayEl.onclick = openDrawingForTrace;
    imgEl.onclick = openDrawingForTrace;

    addBtn('soundBtn', () => mode === "abc" ? speak(letters[i].l === "A" ? "ă as in apple … A … apple" : `${letters[i].s} … ${letters[i].l} … ${letters[i].w}`, 0.75, 1.3) : mode === "123" ? speak(`${numbers[i].n} … ${numbers[i].w}!`) : speak(shapes[i].speak));
    addBtn('singBtn', () => mode === "abc" ? speak("A B C D E F G … Yay!") : mode === "123" ? speak("One two three … up to ten!") : speak("So many fun shapes!"));
    addBtn('nextBtn', () => { i = (i + 1) % (mode === "abc" ? letters.length : mode === "123" ? numbers.length : shapes.length); showCurrent(); });
    addBtn('drawBtn', openDrawingForTrace); // Draw button also goes straight to trace

    // DRAWING ENGINE
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false, lastX = 0, lastY = 0, lastTime = 0;

    function resizeCanvas() {
      canvas.width = canvas.offsetWidth * devicePixelRatio;
      canvas.height = canvas.offsetHeight * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
      drawGuide();
    }
    window.addEventListener('resize', resizeCanvas);

    function drawGuide() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (drawMode !== "trace") return;

      const size = Math.min(canvas.width, canvas.height) / (2 * devicePixelRatio) * 0.7;
      const cx = canvas.width / (2 * devicePixelRatio);
      const cy = canvas.height / (2 * devicePixelRatio);

      ctx.strokeStyle = '#00000022';
      ctx.lineWidth = 16;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      if (mode === "abc") {
        ctx.font = `bold ${size * 1.3}px Comic Neue`;
        ctx.fillStyle = '#00000011';
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.fillText(letters[i].l, cx, cy);
      } else if (mode === "123") {
        ctx.font = `bold ${size * 1.3}px Comic Neue`;
        ctx.fillStyle = '#00000011';
        ctx.fillText(numbers[i].n, cx, cy);
      } else {
        const path = new Path2D(shapes[i].path(size));
        ctx.stroke(path);
      }
    }

    function startDraw(e) { drawing = true; const r = canvas.getBoundingClientRect(); lastX = (e.touches ? e.touches[0].clientX : e.clientX) - r.left; lastY = (e.touches ? e.touches[0].clientY : e.clientY) - r.top; lastTime = performance.now(); ctx.beginPath(); ctx.moveTo(lastX, lastY); }
    function draw(e) {
      if (!drawing) return;
      const r = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
      const now = performance.now();
      const dist = Math.hypot(x - lastX, y - lastY);
      const time = Math.max(1, now - lastTime);
      const speed = dist / time;
      const width = Math.max(4, Math.min(40, 120 / speed));

      ctx.lineWidth = width;
      ctx.lineCap = 'round'; ctx.lineJoin = 'round';
      ctx.strokeStyle = currentColor;
      ctx.lineTo(x, y); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, y);

      lastX = x; lastY = y; lastTime = now;
      if (speed > 0.5) playSound('scribble');
    }
    function stopDraw() { drawing = false; ctx.beginPath(); }

    canvas.addEventListener('pointerdown', startDraw);
    canvas.addEventListener('pointermove', draw);
    canvas.addEventListener('pointerup', stopDraw);
    canvas.addEventListener('pointerleave', stopDraw);

    document.querySelectorAll('.crayon').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.crayon').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        currentColor = btn.dataset.color;
        playSound('pop');
      };
    });

    document.getElementById('modeTrace').onclick = () => { drawMode = "trace"; drawGuide(); document.getElementById('modeTrace').style.opacity = 1; document.getElementById('modeColor').style.opacity = 0.6; };
    document.getElementById('modeColor').onclick = () => { drawMode = "color"; drawGuide(); document.getElementById('modeColor').style.opacity = 1; document.getElementById('modeTrace').style.opacity = 0.6; };
    addBtn('clearBtn', () => drawGuide());
    addBtn('backBtn', () => {
      document.getElementById('drawScreen').classList.add('hidden');
      document.getElementById('main').classList.remove('hidden');
      document.getElementById('mobileNav').classList.remove('hidden');
    });

    // Start
    resizeCanvas();
    showCurrent();
    speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
  </script>
</body>
</html>
